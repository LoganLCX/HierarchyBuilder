{"version":3,"file":"builder/builder/buildSpec.js","sources":["../../../../src/builder/builder/buildSpec.ts"],"sourcesContent":["import type { Spec, VChartSpecPipeline } from 'src/types'\nimport { Builder } from './builder'\nimport type { AdvancedVSeed, SpecPipelineContext } from 'src/types'\nimport { execPipeline } from '../../pipeline'\nimport { intl } from 'src/i18n'\nimport type { ISpec } from '@visactor/vchart'\n\nexport const buildSpec = (builder: Builder, advancedVSeed: AdvancedVSeed): Spec => {\n  const start = typeof performance !== 'undefined' ? performance.now() : Date.now()\n\n  const { chartType } = builder.vseed\n\n  const pipeline = Builder.getSpecPipeline(chartType)\n  if (!pipeline) {\n    throw new Error(\n      `please invoke registerAll or register ${chartType} before build, no spec pipeline for chartType ${chartType}`,\n    )\n  }\n\n  const context: SpecPipelineContext = {\n    vseed: builder.vseed,\n    advancedVSeed,\n  }\n  if (builder.locale) {\n    intl.setLocale(builder.locale)\n  }\n\n  try {\n    const spec = execPipeline<ISpec, SpecPipelineContext>(pipeline as VChartSpecPipeline, context)\n    builder.spec = spec\n    return spec\n  } catch (e) {\n    console.error(e)\n    throw new Error(`buildSpec error: ${(e as Error).message}.\\ndetails info in console`)\n  } finally {\n    const end = typeof performance !== 'undefined' ? performance.now() : Date.now()\n    builder.performance['buildSpec'] = `${(end - start).toFixed(4)}ms`\n  }\n}\n"],"names":["buildSpec","builder","advancedVSeed","start","performance","Date","chartType","pipeline","Builder","Error","context","intl","spec","execPipeline","e","console","end"],"mappings":";;;AAOO,MAAMA,YAAY,CAACC,SAAkBC;IAC1C,MAAMC,QAAQ,AAAuB,eAAvB,OAAOC,cAA8BA,YAAY,GAAG,KAAKC,KAAK,GAAG;IAE/E,MAAM,EAAEC,SAAS,EAAE,GAAGL,QAAQ,KAAK;IAEnC,MAAMM,WAAWC,QAAQ,eAAe,CAACF;IACzC,IAAI,CAACC,UACH,MAAM,IAAIE,MACR,CAAC,sCAAsC,EAAEH,UAAU,8CAA8C,EAAEA,WAAW;IAIlH,MAAMI,UAA+B;QACnC,OAAOT,QAAQ,KAAK;QACpBC;IACF;IACA,IAAID,QAAQ,MAAM,EAChBU,KAAK,SAAS,CAACV,QAAQ,MAAM;IAG/B,IAAI;QACF,MAAMW,OAAOC,aAAyCN,UAAgCG;QACtFT,QAAQ,IAAI,GAAGW;QACf,OAAOA;IACT,EAAE,OAAOE,GAAG;QACVC,QAAQ,KAAK,CAACD;QACd,MAAM,IAAIL,MAAM,CAAC,iBAAiB,EAAGK,EAAY,OAAO,CAAC,0BAA0B,CAAC;IACtF,SAAU;QACR,MAAME,MAAM,AAAuB,eAAvB,OAAOZ,cAA8BA,YAAY,GAAG,KAAKC,KAAK,GAAG;QAC7EJ,QAAQ,WAAW,CAAC,YAAY,GAAG,GAAIe,AAAAA,CAAAA,MAAMb,KAAI,EAAG,OAAO,CAAC,GAAG,EAAE,CAAC;IACpE;AACF"}