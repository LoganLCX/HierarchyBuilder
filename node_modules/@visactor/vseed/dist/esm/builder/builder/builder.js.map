{"version":3,"file":"builder/builder/builder.js","sources":["../../../../src/builder/builder/builder.ts"],"sourcesContent":["import type {\n  AdvancedPipe,\n  AdvancedPipeline,\n  AdvancedVSeed,\n  ChartType,\n  CustomThemeConfig,\n  Locale,\n  Spec,\n  SpecPipe,\n  SpecPipeline,\n  VSeed,\n  VSeedBuilder,\n} from 'src/types'\nimport { buildAdvanced } from './buildAdvanced'\nimport { buildSpec } from './buildSpec'\nimport { build } from './build'\nimport { intl } from 'src/i18n'\nimport { getColorIdMap, getColorItems } from './advanced'\n\nexport class Builder implements VSeedBuilder {\n  private _vseed: VSeed\n  private _advancedVSeed: AdvancedVSeed | null = null\n  private _spec: Spec | null = null\n  private _performance: Record<string, string | number> = {}\n\n  private _locale: Locale\n\n  constructor(vseed: VSeed) {\n    this._vseed = vseed\n    this._locale = vseed.locale || intl.getLocale()\n  }\n\n  get locale() {\n    return this._locale\n  }\n\n  /**\n   * @description 构建spec\n   * @returns spec\n   */\n  build = <T extends Spec>(): T => build(this) as T\n\n  /**\n   * @description 构建spec\n   * @param advanced 高级配置\n   * @returns spec\n   */\n  buildSpec = (advanced: AdvancedVSeed): Spec => buildSpec(this, advanced)\n\n  /**\n   * @description 构建spec\n   * @returns AdvancedVSeed | null\n   */\n  buildAdvanced = (): AdvancedVSeed | null => buildAdvanced(this)\n\n  /**\n   * @description 获取颜色项, 颜色项可以重复,\n   * @returns 颜色项\n   */\n  getColorItems = () => getColorItems(this)\n\n  /**\n   * @description 获取颜色id映射\n   * @returns 颜色id映射\n   */\n  getColorIdMap = () => getColorIdMap(this)\n\n  /**\n   * @description 获取vseed\n   * @returns vseed\n   */\n  get vseed() {\n    return this._vseed\n  }\n\n  /**\n   * @description 设置vseed\n   * @param value vseed\n   */\n  set vseed(value) {\n    this._vseed = value\n  }\n\n  /**\n   * @description 获取advancedVSeed\n   * @returns advancedVSeed\n   */\n  get advancedVSeed() {\n    return this._advancedVSeed\n  }\n\n  /**\n   *\n   * @description 设置advancedVSeed\n   * @param value advancedVSeed\n   */\n  set advancedVSeed(value) {\n    this._advancedVSeed = value\n  }\n\n  /**\n   * @description 获取spec\n   * @returns spec\n   */\n  get spec() {\n    return this._spec\n  }\n\n  /**\n   * @description 设置spec\n   * @param value spec\n   */\n  set spec(value) {\n    this._spec = value\n  }\n\n  /**\n   * @description 获取performance, 统计了构建spec和advancedVSeed的时间\n   * @returns performance\n   */\n  get performance() {\n    return this._performance\n  }\n\n  /**\n   * @description 设置performance\n   * @param value performance\n   */\n  set performance(value) {\n    this._performance = value\n  }\n\n  /**\n   * @description 获取advancedPipeline\n   * @param chartType 图表类型\n   * @returns advancedPipeline\n   */\n  static getAdvancedPipeline = (chartType: ChartType) => {\n    const customPipe = Builder._customAdvancedPipe[chartType] as AdvancedPipe\n    const pipeline = Builder._advancedPipelineMap[chartType] as AdvancedPipeline\n    if (customPipe) {\n      pipeline.push(customPipe)\n    }\n    return pipeline\n  }\n\n  /**\n   * @description 获取specPipeline\n   * @param chartType 图表类型\n   * @returns specPipeline\n   */\n\n  static getSpecPipeline = (chartType: ChartType) => {\n    const customPipe = Builder._customSpecPipe[chartType] as SpecPipe\n    const pipeline = Builder._specPipelineMap[chartType] as SpecPipeline\n    if (customPipe) {\n      pipeline.push(customPipe)\n    }\n    return pipeline\n  }\n\n  /**\n   * @description 根据主题key获取主题配置\n   * @param themeKey 主题key\n   * @example Builder.getTheme('light'), 获取浅色主题\n   * @returns 主题配置\n   */\n  static getTheme = (themeKey?: string) => Builder._themeMap[themeKey || 'light']\n\n  /**\n   * @description 获取主题配置映射表\n   * @example Builder.getThemeMap()\n   * @returns 主题配置映射表\n   */\n  static getThemeMap = () => Builder._themeMap\n\n  /**\n   * @description 从vseed创建builder\n   * @param vseed 完整的vseed DSL\n   * @returns builder\n   */\n  static from = (vseed: VSeed) => new Builder(vseed)\n\n  static _advancedPipelineMap: Partial<Record<ChartType, AdvancedPipeline>> = {}\n  static _specPipelineMap: Partial<Record<ChartType, SpecPipeline>> = {}\n  static _customAdvancedPipe: Partial<Record<ChartType, AdvancedPipe>> = {}\n  static _customSpecPipe: Partial<Record<ChartType, SpecPipe>> = {}\n  static _themeMap: Record<string, CustomThemeConfig> = {}\n}\n"],"names":["Builder","vseed","intl","build","advanced","buildSpec","buildAdvanced","getColorItems","getColorIdMap","value","chartType","customPipe","pipeline","themeKey"],"mappings":";;;;;AAmBO,MAAMA;IACH,OAAa;IACb,iBAAuC,KAAI;IAC3C,QAAqB,KAAI;IACzB,eAAgD,CAAC,EAAC;IAElD,QAAe;IAEvB,YAAYC,KAAY,CAAE;QACxB,IAAI,CAAC,MAAM,GAAGA;QACd,IAAI,CAAC,OAAO,GAAGA,MAAM,MAAM,IAAIC,KAAK,SAAS;IAC/C;IAEA,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,OAAO;IACrB;IAMA,QAAQ,IAAyBC,MAAM,IAAI,EAAM;IAOjD,YAAY,CAACC,WAAkCC,UAAU,IAAI,EAAED,UAAS;IAMxE,gBAAgB,IAA4BE,cAAc,IAAI,EAAC;IAM/D,gBAAgB,IAAMC,cAAc,IAAI,EAAC;IAMzC,gBAAgB,IAAMC,cAAc,IAAI,EAAC;IAMzC,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,MAAM;IACpB;IAMA,IAAI,MAAMC,KAAK,EAAE;QACf,IAAI,CAAC,MAAM,GAAGA;IAChB;IAMA,IAAI,gBAAgB;QAClB,OAAO,IAAI,CAAC,cAAc;IAC5B;IAOA,IAAI,cAAcA,KAAK,EAAE;QACvB,IAAI,CAAC,cAAc,GAAGA;IACxB;IAMA,IAAI,OAAO;QACT,OAAO,IAAI,CAAC,KAAK;IACnB;IAMA,IAAI,KAAKA,KAAK,EAAE;QACd,IAAI,CAAC,KAAK,GAAGA;IACf;IAMA,IAAI,cAAc;QAChB,OAAO,IAAI,CAAC,YAAY;IAC1B;IAMA,IAAI,YAAYA,KAAK,EAAE;QACrB,IAAI,CAAC,YAAY,GAAGA;IACtB;IAOA,OAAO,sBAAsB,CAACC;QAC5B,MAAMC,aAAaX,QAAQ,mBAAmB,CAACU,UAAU;QACzD,MAAME,WAAWZ,QAAQ,oBAAoB,CAACU,UAAU;QACxD,IAAIC,YACFC,SAAS,IAAI,CAACD;QAEhB,OAAOC;IACT,EAAC;IAQD,OAAO,kBAAkB,CAACF;QACxB,MAAMC,aAAaX,QAAQ,eAAe,CAACU,UAAU;QACrD,MAAME,WAAWZ,QAAQ,gBAAgB,CAACU,UAAU;QACpD,IAAIC,YACFC,SAAS,IAAI,CAACD;QAEhB,OAAOC;IACT,EAAC;IAQD,OAAO,WAAW,CAACC,WAAsBb,QAAQ,SAAS,CAACa,YAAY,QAAQ;IAO/E,OAAO,cAAc,IAAMb,QAAQ,SAAS;IAO5C,OAAO,OAAO,CAACC,QAAiB,IAAID,QAAQC,OAAM;IAElD,OAAO,uBAAqE,CAAC,EAAC;IAC9E,OAAO,mBAA6D,CAAC,EAAC;IACtE,OAAO,sBAAgE,CAAC,EAAC;IACzE,OAAO,kBAAwD,CAAC,EAAC;IACjE,OAAO,YAA+C,CAAC,EAAC;AAC1D"}