{"version":3,"file":"pipeline/advanced/table/pipes/encoding/pivotTable.js","sources":["../../../../../../../src/pipeline/advanced/table/pipes/encoding/pivotTable.ts"],"sourcesContent":["import { unique } from 'remeda'\nimport { findAllMeasures } from 'src/pipeline/utils'\nimport type { AdvancedPipe, Dimension, Dimensions, Encoding, Measure, Measures } from 'src/types'\n\nexport const encodingForPivotTable: AdvancedPipe = (advancedVSeed) => {\n  const { measures: vseedMeasures = [], dimensions = [] } = advancedVSeed\n  const measures = findAllMeasures(vseedMeasures)\n\n  const hasDimensionEncoding = dimensions.some((item: Dimension) => item.encoding)\n  const hasMeasureEncoding = measures.some((item: Measure) => item.encoding)\n  const encoding: Encoding = {}\n\n  if (hasDimensionEncoding) {\n    generateDimensionEncoding(dimensions, encoding)\n  } else {\n    generateDefaultDimensionEncoding(dimensions, encoding)\n  }\n\n  if (hasMeasureEncoding) {\n    generateMeasureEncoding(measures, encoding)\n  } else {\n    generateDefaultMeasureEncoding(measures, encoding)\n  }\n\n  return { ...advancedVSeed, encoding }\n}\n\n/**\n * --------------------维度--------------------\n */\nconst generateDefaultDimensionEncoding = (dimensions: Dimensions, encoding: Encoding) => {\n  const uniqueDimIds = unique(dimensions.map((d) => d.id))\n  encoding.tooltip = uniqueDimIds\n  encoding.row = []\n  encoding.column = []\n\n  uniqueDimIds.forEach((item, index) => {\n    if (index % 2 === 0) {\n      encoding.column!.push(item)\n    } else {\n      encoding.row!.push(item)\n    }\n  })\n}\nconst generateDimensionEncoding = (dimensions: Dimensions, encoding: Encoding) => {\n  const uniqueDimIds = unique(dimensions.map((d) => d.id))\n  encoding.tooltip = uniqueDimIds\n  encoding.row = []\n  encoding.column = []\n\n  dimensions.forEach((dim, index) => {\n    const id = dim.id\n    if (dim.encoding === 'row') {\n      encoding.row!.push(id)\n    } else if (dim.encoding === 'column') {\n      encoding.column!.push(id)\n    } else {\n      if (index % 2 === 0) {\n        encoding.column!.push(id)\n      } else {\n        encoding.row!.push(id)\n      }\n    }\n  })\n}\n\n/**\n * --------------------指标--------------------\n */\nconst generateDefaultMeasureEncoding = (measures: Measures, encoding: Encoding) => {\n  encoding.tooltip = unique(measures.map((item) => item.id))\n  encoding.detail = unique(\n    measures.filter((item) => item.encoding === 'detail' || !item.encoding).map((item) => item.id),\n  )\n}\nconst generateMeasureEncoding = (measures: Measures, encoding: Encoding) => {\n  encoding.tooltip = measures.map((item) => item.id)\n  encoding.detail = unique(\n    measures.filter((item) => item.encoding === 'detail' || !item.encoding).map((item) => item.id),\n  )\n}\n"],"names":["encodingForPivotTable","advancedVSeed","vseedMeasures","dimensions","measures","findAllMeasures","hasDimensionEncoding","item","hasMeasureEncoding","encoding","generateDimensionEncoding","generateDefaultDimensionEncoding","generateMeasureEncoding","generateDefaultMeasureEncoding","uniqueDimIds","unique","d","index","dim","id"],"mappings":";;AAIO,MAAMA,wBAAsC,CAACC;IAClD,MAAM,EAAE,UAAUC,gBAAgB,EAAE,EAAEC,aAAa,EAAE,EAAE,GAAGF;IAC1D,MAAMG,WAAWC,gBAAgBH;IAEjC,MAAMI,uBAAuBH,WAAW,IAAI,CAAC,CAACI,OAAoBA,KAAK,QAAQ;IAC/E,MAAMC,qBAAqBJ,SAAS,IAAI,CAAC,CAACG,OAAkBA,KAAK,QAAQ;IACzE,MAAME,WAAqB,CAAC;IAE5B,IAAIH,sBACFI,0BAA0BP,YAAYM;SAEtCE,iCAAiCR,YAAYM;IAG/C,IAAID,oBACFI,wBAAwBR,UAAUK;SAElCI,+BAA+BT,UAAUK;IAG3C,OAAO;QAAE,GAAGR,aAAa;QAAEQ;IAAS;AACtC;AAKA,MAAME,mCAAmC,CAACR,YAAwBM;IAChE,MAAMK,eAAeC,OAAOZ,WAAW,GAAG,CAAC,CAACa,IAAMA,EAAE,EAAE;IACtDP,SAAS,OAAO,GAAGK;IACnBL,SAAS,GAAG,GAAG,EAAE;IACjBA,SAAS,MAAM,GAAG,EAAE;IAEpBK,aAAa,OAAO,CAAC,CAACP,MAAMU;QAC1B,IAAIA,QAAQ,MAAM,GAChBR,SAAS,MAAM,CAAE,IAAI,CAACF;aAEtBE,SAAS,GAAG,CAAE,IAAI,CAACF;IAEvB;AACF;AACA,MAAMG,4BAA4B,CAACP,YAAwBM;IACzD,MAAMK,eAAeC,OAAOZ,WAAW,GAAG,CAAC,CAACa,IAAMA,EAAE,EAAE;IACtDP,SAAS,OAAO,GAAGK;IACnBL,SAAS,GAAG,GAAG,EAAE;IACjBA,SAAS,MAAM,GAAG,EAAE;IAEpBN,WAAW,OAAO,CAAC,CAACe,KAAKD;QACvB,MAAME,KAAKD,IAAI,EAAE;QACjB,IAAIA,AAAiB,UAAjBA,IAAI,QAAQ,EACdT,SAAS,GAAG,CAAE,IAAI,CAACU;aACd,IAAID,AAAiB,aAAjBA,IAAI,QAAQ,EACrBT,SAAS,MAAM,CAAE,IAAI,CAACU;aAEtB,IAAIF,QAAQ,MAAM,GAChBR,SAAS,MAAM,CAAE,IAAI,CAACU;aAEtBV,SAAS,GAAG,CAAE,IAAI,CAACU;IAGzB;AACF;AAKA,MAAMN,iCAAiC,CAACT,UAAoBK;IAC1DA,SAAS,OAAO,GAAGM,OAAOX,SAAS,GAAG,CAAC,CAACG,OAASA,KAAK,EAAE;IACxDE,SAAS,MAAM,GAAGM,OAChBX,SAAS,MAAM,CAAC,CAACG,OAASA,AAAkB,aAAlBA,KAAK,QAAQ,IAAiB,CAACA,KAAK,QAAQ,EAAE,GAAG,CAAC,CAACA,OAASA,KAAK,EAAE;AAEjG;AACA,MAAMK,0BAA0B,CAACR,UAAoBK;IACnDA,SAAS,OAAO,GAAGL,SAAS,GAAG,CAAC,CAACG,OAASA,KAAK,EAAE;IACjDE,SAAS,MAAM,GAAGM,OAChBX,SAAS,MAAM,CAAC,CAACG,OAASA,AAAkB,aAAlBA,KAAK,QAAQ,IAAiB,CAACA,KAAK,QAAQ,EAAE,GAAG,CAAC,CAACA,OAASA,KAAK,EAAE;AAEjG"}