{"version":3,"file":"pipeline/advanced/table/pipes/default/defaultMeasures.js","sources":["../../../../../../../src/pipeline/advanced/table/pipes/default/defaultMeasures.ts"],"sourcesContent":["import { clone } from 'remeda'\nimport { isMeasure, preorderTraverse } from 'src/pipeline/utils'\nimport type { AdvancedPipe, Datum } from 'src/types'\n\n/**\n * @description 如果用户没有配置 measures, 则基于 dataset 构建默认的 measures\n */\nexport const defaultMeasures: AdvancedPipe = (advancedVSeed, context) => {\n  const { vseed } = context\n  const { measures, dataset } = vseed\n\n  if (measures && measures.length > 0) {\n    const clonedMeasures = clone(measures)\n    preorderTraverse(clonedMeasures, (node) => {\n      if (isMeasure(node)) {\n        node.alias = node.alias || node.id\n      }\n      return false\n    })\n    return {\n      ...advancedVSeed,\n      measures: clonedMeasures,\n    }\n  }\n\n  const top100dataset = dataset.slice(0, 100)\n  const sample = top100dataset.reduce<Datum>((prev, cur) => {\n    return { ...prev, ...cur }\n  }, {})\n  const defaultMeasures = Object.keys(sample)\n    .filter((key) => {\n      return top100dataset.some((item) => typeof item[key] === 'number') && !['', null, undefined].includes(key)\n    })\n    .map((measure) => ({\n      id: measure,\n      alias: measure,\n    }))\n\n  return {\n    ...advancedVSeed,\n    measures: defaultMeasures,\n  }\n}\n"],"names":["defaultMeasures","advancedVSeed","context","vseed","measures","dataset","clonedMeasures","clone","preorderTraverse","node","isMeasure","top100dataset","sample","prev","cur","Object","key","item","undefined","measure"],"mappings":";;AAOO,MAAMA,kCAAgC,CAACC,eAAeC;IAC3D,MAAM,EAAEC,KAAK,EAAE,GAAGD;IAClB,MAAM,EAAEE,QAAQ,EAAEC,OAAO,EAAE,GAAGF;IAE9B,IAAIC,YAAYA,SAAS,MAAM,GAAG,GAAG;QACnC,MAAME,iBAAiBC,MAAMH;QAC7BI,iBAAiBF,gBAAgB,CAACG;YAChC,IAAIC,UAAUD,OACZA,KAAK,KAAK,GAAGA,KAAK,KAAK,IAAIA,KAAK,EAAE;YAEpC,OAAO;QACT;QACA,OAAO;YACL,GAAGR,aAAa;YAChB,UAAUK;QACZ;IACF;IAEA,MAAMK,gBAAgBN,QAAQ,KAAK,CAAC,GAAG;IACvC,MAAMO,SAASD,cAAc,MAAM,CAAQ,CAACE,MAAMC,MACzC;YAAE,GAAGD,IAAI;YAAE,GAAGC,GAAG;QAAC,IACxB,CAAC;IACJ,MAAMd,kBAAkBe,OAAO,IAAI,CAACH,QACjC,MAAM,CAAC,CAACI,MACAL,cAAc,IAAI,CAAC,CAACM,OAAS,AAAqB,YAArB,OAAOA,IAAI,CAACD,IAAI,KAAkB,CAAC;YAAC;YAAI;YAAME;SAAU,CAAC,QAAQ,CAACF,MAEvG,GAAG,CAAC,CAACG,UAAa;YACjB,IAAIA;YACJ,OAAOA;QACT;IAEF,OAAO;QACL,GAAGlB,aAAa;QAChB,UAAUD;IACZ;AACF"}