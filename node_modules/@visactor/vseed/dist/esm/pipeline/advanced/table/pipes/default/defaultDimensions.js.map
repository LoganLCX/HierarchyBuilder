{"version":3,"file":"pipeline/advanced/table/pipes/default/defaultDimensions.js","sources":["../../../../../../../src/pipeline/advanced/table/pipes/default/defaultDimensions.ts"],"sourcesContent":["import { clone } from 'remeda'\nimport { findAllMeasures, isDimension, preorderTraverse } from 'src/pipeline/utils'\nimport type { AdvancedPipe, Datum, Dimensions, DimensionTree } from 'src/types'\n\nexport const defaultDimensions: AdvancedPipe = (advancedVSeed, context) => {\n  const result = { ...advancedVSeed }\n  const { vseed } = context\n  const { dimensions, dataset } = vseed\n\n  if (dimensions && dimensions.length > 0) {\n    const clonedDimensions = clone(dimensions)\n    preorderTraverse(clonedDimensions, (node) => {\n      if (isDimension(node)) {\n        node.alias = node.alias || node.id\n      }\n      return false\n    })\n    return {\n      ...advancedVSeed,\n      dimensions: clonedDimensions,\n    }\n  }\n\n  const measures = findAllMeasures(advancedVSeed.measures as DimensionTree)\n\n  const top100dataset = dataset.slice(0, 100)\n\n  const sample = top100dataset.reduce<Datum>((prev, cur) => {\n    return { ...prev, ...cur }\n  }, {})\n\n  const newDimensions = Object.keys(sample)\n    .filter(\n      (key) =>\n        top100dataset.some((item) => typeof item[key] === 'string') &&\n        !['', null, undefined].includes(key) &&\n        !measures.some((measure) => measure.id === key),\n    )\n    .map((dim) => ({\n      id: dim,\n      alias: dim,\n    })) as Dimensions\n\n  return {\n    ...result,\n    dimensions: newDimensions,\n  }\n}\n"],"names":["defaultDimensions","advancedVSeed","context","result","vseed","dimensions","dataset","clonedDimensions","clone","preorderTraverse","node","isDimension","measures","findAllMeasures","top100dataset","sample","prev","cur","newDimensions","Object","key","item","undefined","measure","dim"],"mappings":";;AAIO,MAAMA,oBAAkC,CAACC,eAAeC;IAC7D,MAAMC,SAAS;QAAE,GAAGF,aAAa;IAAC;IAClC,MAAM,EAAEG,KAAK,EAAE,GAAGF;IAClB,MAAM,EAAEG,UAAU,EAAEC,OAAO,EAAE,GAAGF;IAEhC,IAAIC,cAAcA,WAAW,MAAM,GAAG,GAAG;QACvC,MAAME,mBAAmBC,MAAMH;QAC/BI,iBAAiBF,kBAAkB,CAACG;YAClC,IAAIC,YAAYD,OACdA,KAAK,KAAK,GAAGA,KAAK,KAAK,IAAIA,KAAK,EAAE;YAEpC,OAAO;QACT;QACA,OAAO;YACL,GAAGT,aAAa;YAChB,YAAYM;QACd;IACF;IAEA,MAAMK,WAAWC,gBAAgBZ,cAAc,QAAQ;IAEvD,MAAMa,gBAAgBR,QAAQ,KAAK,CAAC,GAAG;IAEvC,MAAMS,SAASD,cAAc,MAAM,CAAQ,CAACE,MAAMC,MACzC;YAAE,GAAGD,IAAI;YAAE,GAAGC,GAAG;QAAC,IACxB,CAAC;IAEJ,MAAMC,gBAAgBC,OAAO,IAAI,CAACJ,QAC/B,MAAM,CACL,CAACK,MACCN,cAAc,IAAI,CAAC,CAACO,OAAS,AAAqB,YAArB,OAAOA,IAAI,CAACD,IAAI,KAC7C,CAAC;YAAC;YAAI;YAAME;SAAU,CAAC,QAAQ,CAACF,QAChC,CAACR,SAAS,IAAI,CAAC,CAACW,UAAYA,QAAQ,EAAE,KAAKH,MAE9C,GAAG,CAAC,CAACI,MAAS;YACb,IAAIA;YACJ,OAAOA;QACT;IAEF,OAAO;QACL,GAAGrB,MAAM;QACT,YAAYe;IACd;AACF"}