{"version":3,"file":"pipeline/advanced/chart/pipes/analysis/sortLegend.js","sources":["../../../../../../../src/pipeline/advanced/chart/pipes/analysis/sortLegend.ts"],"sourcesContent":["import type { AdvancedPipe, Line } from 'src/types'\nimport { calcOrder } from './common'\n\nexport const sortLegend: AdvancedPipe = (advancedVSeed, context) => {\n  const result = { ...advancedVSeed }\n  const { vseed } = context\n  const { sortLegend } = vseed as Line\n  const { datasetReshapeInfo, dataset } = advancedVSeed\n  const colorId = datasetReshapeInfo?.[0]?.unfoldInfo?.encodingColorId\n  const colorIdMap = datasetReshapeInfo?.[0]?.unfoldInfo?.colorIdMap ?? {}\n  const colorItems = datasetReshapeInfo?.[0]?.unfoldInfo?.colorItems\n  if (!sortLegend || !colorId || !colorIdMap || !colorItems) {\n    return advancedVSeed\n  }\n\n  if (!result.analysis) result.analysis = {}\n  if (!result.analysis.orderMapping) result.analysis.orderMapping = {}\n\n  if (sortLegend.customOrder) {\n    const colorIds = Object.keys(colorIdMap)\n    // 先根据名称匹配, 若名称不存在, 则根据id匹配, 从而兼容名称和id的两种情况\n    const orderRes = sortLegend.customOrder.map((itemNameOrId) => {\n      return colorIds.find((id) => {\n        return colorIdMap[id]?.alias === itemNameOrId || colorIdMap[id]?.id === itemNameOrId || id === itemNameOrId\n      }) as string\n    })\n    result.analysis.orderMapping[colorId] = orderRes\n    return result\n  }\n\n  const orderRes = calcOrder(sortLegend, colorId, dataset?.flat(2) || [])\n  result.analysis.orderMapping[colorId] = orderRes\n\n  return result\n}\n"],"names":["sortLegend","advancedVSeed","context","result","vseed","datasetReshapeInfo","dataset","colorId","colorIdMap","colorItems","colorIds","Object","orderRes","itemNameOrId","id","calcOrder"],"mappings":";AAGO,MAAMA,wBAA2B,CAACC,eAAeC;IACtD,MAAMC,SAAS;QAAE,GAAGF,aAAa;IAAC;IAClC,MAAM,EAAEG,KAAK,EAAE,GAAGF;IAClB,MAAM,EAAEF,UAAU,EAAE,GAAGI;IACvB,MAAM,EAAEC,kBAAkB,EAAEC,OAAO,EAAE,GAAGL;IACxC,MAAMM,UAAUF,oBAAoB,CAAC,EAAE,EAAE,YAAY;IACrD,MAAMG,aAAaH,oBAAoB,CAAC,EAAE,EAAE,YAAY,cAAc,CAAC;IACvE,MAAMI,aAAaJ,oBAAoB,CAAC,EAAE,EAAE,YAAY;IACxD,IAAI,CAACL,cAAc,CAACO,WAAW,CAACC,cAAc,CAACC,YAC7C,OAAOR;IAGT,IAAI,CAACE,OAAO,QAAQ,EAAEA,OAAO,QAAQ,GAAG,CAAC;IACzC,IAAI,CAACA,OAAO,QAAQ,CAAC,YAAY,EAAEA,OAAO,QAAQ,CAAC,YAAY,GAAG,CAAC;IAEnE,IAAIH,WAAW,WAAW,EAAE;QAC1B,MAAMU,WAAWC,OAAO,IAAI,CAACH;QAE7B,MAAMI,WAAWZ,WAAW,WAAW,CAAC,GAAG,CAAC,CAACa,eACpCH,SAAS,IAAI,CAAC,CAACI,KACbN,UAAU,CAACM,GAAG,EAAE,UAAUD,gBAAgBL,UAAU,CAACM,GAAG,EAAE,OAAOD,gBAAgBC,OAAOD;QAGnGV,OAAO,QAAQ,CAAC,YAAY,CAACI,QAAQ,GAAGK;QACxC,OAAOT;IACT;IAEA,MAAMS,WAAWG,UAAUf,YAAYO,SAASD,SAAS,KAAK,MAAM,EAAE;IACtEH,OAAO,QAAQ,CAAC,YAAY,CAACI,QAAQ,GAAGK;IAExC,OAAOT;AACT"}