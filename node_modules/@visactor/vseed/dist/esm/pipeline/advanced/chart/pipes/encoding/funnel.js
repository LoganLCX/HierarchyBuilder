import { unique } from "remeda";
import { MeasureId } from "../../../../../dataReshape/index.js";
import { findAllMeasures } from "../../../../utils/index.js";
import { addColorToEncoding } from "./color/index.js";
const defaultEncodingForFunnel = (advancedVSeed)=>{
    const { measures: vseedMeasures = [], dimensions = [] } = advancedVSeed;
    const measures = findAllMeasures(vseedMeasures);
    const encoding = {};
    generateDefaultDimensionEncoding(dimensions, encoding);
    generateDefaultMeasureEncoding(measures, encoding);
    return {
        ...advancedVSeed,
        encoding
    };
};
const encodingForFunnel = (advancedVSeed)=>{
    const { measures: vseedMeasures = [], dimensions = [] } = advancedVSeed;
    const measures = findAllMeasures(vseedMeasures);
    const hasDimensionEncoding = dimensions.some((item)=>item.encoding);
    const hasMeasureEncoding = measures.some((item)=>item.encoding);
    const encoding = {};
    if (hasDimensionEncoding) generateDimensionEncoding(dimensions, encoding, measures.length > 1);
    else generateDefaultDimensionEncoding(dimensions, encoding);
    if (hasMeasureEncoding) generateMeasureEncoding(measures, encoding);
    else generateDefaultMeasureEncoding(measures, encoding);
    return {
        ...advancedVSeed,
        encoding
    };
};
const generateDefaultDimensionEncoding = (dimensions, encoding)=>{
    const uniqueDimIds = unique(dimensions.map((d)=>d.id));
    encoding.color = uniqueDimIds.slice(0);
    encoding.detail = encoding.color;
    encoding.tooltip = uniqueDimIds.filter((d)=>d !== MeasureId);
    encoding.label = [];
    encoding.row = [];
    encoding.column = [];
};
const generateDimensionEncoding = (dimensions, encoding, isMultiMeasure)=>{
    addColorToEncoding(dimensions, encoding, isMultiMeasure);
    encoding.detail = unique(dimensions.filter((item)=>'detail' === item.encoding).map((item)=>item.id));
    if (0 === encoding.detail.length) encoding.detail = [
        MeasureId
    ];
    encoding.tooltip = unique(dimensions.map((item)=>item.id));
    encoding.tooltip = encoding.tooltip.filter((d)=>d !== MeasureId);
    encoding.label = unique(dimensions.filter((item)=>'label' === item.encoding).map((item)=>item.id));
    encoding.label = encoding.label.filter((d)=>d !== MeasureId);
};
const generateDefaultMeasureEncoding = (measures, encoding)=>{
    encoding.size = unique(measures.filter((item)=>'size' === item.encoding || !item.encoding).map((item)=>item.id));
};
const generateMeasureEncoding = (measures, encoding)=>{
    encoding.size = unique(measures.filter((item)=>'size' === item.encoding || !item.encoding).map((item)=>item.id));
    const color = unique(measures.filter((item)=>'color' === item.encoding).map((item)=>item.id));
    if (color.length > 0) encoding.color = [
        color[0]
    ];
    const label = unique(measures.filter((item)=>'label' === item.encoding).map((item)=>item.id));
    encoding.label = unique([
        ...encoding.label || [],
        ...label
    ]);
    const tooltip = unique(measures.filter((item)=>'tooltip' === item.encoding).map((item)=>item.id));
    encoding.tooltip = unique([
        ...encoding.tooltip || [],
        ...label,
        ...tooltip
    ]);
};
export { defaultEncodingForFunnel, encodingForFunnel };

//# sourceMappingURL=funnel.js.map