{"version":3,"file":"pipeline/advanced/chart/pipes/theme/theme.js","sources":["../../../../../../../src/pipeline/advanced/chart/pipes/theme/theme.ts"],"sourcesContent":["import { clone, isNullish, isNumber, isObjectType, isString, merge, mergeDeep } from 'remeda'\nimport type { AdvancedPipe, AdvancedVSeed } from 'src/types'\n\nexport const theme: AdvancedPipe = (advancedVSeed, context) => {\n  const { customTheme, vseed } = context\n  const { theme = 'light', chartType } = vseed\n  const result = {\n    ...advancedVSeed,\n  } as AdvancedVSeed\n\n  if (!customTheme || !customTheme[theme]) {\n    return result\n  }\n\n  const chartConfigTheme = customTheme?.[theme].config?.[chartType]\n  if (chartConfigTheme) {\n    const chartConfig = result.config?.[chartType] || {}\n    const mergedConfig = mergeDeep(chartConfigTheme, clone(chartConfig))\n\n    // 数组项不会被Merge, 需要将1个主题配置, 合并到数组的每一项\n    for (const _k in mergedConfig) {\n      const key = _k as keyof typeof mergedConfig\n      // 配置的第一层, 如果是数组, 则数组的每一项目和主题配置合并\n      if (Array.isArray(mergedConfig[key])) {\n        mergedConfig[key] = mergeArray(mergedConfig[key], chartConfigTheme[key])\n      }\n    }\n\n    result.config = {\n      [chartType]: mergedConfig,\n    }\n  }\n\n  const chartCustomTheme = customTheme?.[theme]?.config?.[chartType]\n\n  result.customTheme = {\n    config: {\n      [chartType]: chartCustomTheme,\n    },\n  }\n\n  return result\n}\n\nconst mergeArray = <Destination extends Array<object>, Source extends object | number | string | undefined | null>(\n  arr: Destination,\n  themeItem: Source,\n): Destination => {\n  if (isNullish(themeItem) || isString(themeItem) || isNumber(themeItem)) {\n    return arr\n  }\n\n  if (!Array.isArray(arr)) {\n    return arr\n  }\n\n  if (arr.some((d) => !isObjectType(d))) {\n    return arr\n  }\n\n  return arr.map((item) => {\n    return merge(themeItem, item)\n  }) as Destination\n}\n"],"names":["theme","advancedVSeed","context","customTheme","vseed","chartType","result","chartConfigTheme","chartConfig","mergedConfig","mergeDeep","clone","_k","key","Array","mergeArray","chartCustomTheme","arr","themeItem","isNullish","isString","isNumber","d","isObjectType","item","merge"],"mappings":";AAGO,MAAMA,cAAsB,CAACC,eAAeC;IACjD,MAAM,EAAEC,WAAW,EAAEC,KAAK,EAAE,GAAGF;IAC/B,MAAM,EAAEF,QAAQ,OAAO,EAAEK,SAAS,EAAE,GAAGD;IACvC,MAAME,SAAS;QACb,GAAGL,aAAa;IAClB;IAEA,IAAI,CAACE,eAAe,CAACA,WAAW,CAACH,MAAM,EACrC,OAAOM;IAGT,MAAMC,mBAAmBJ,aAAa,CAACH,MAAM,CAAC,QAAQ,CAACK,UAAU;IACjE,IAAIE,kBAAkB;QACpB,MAAMC,cAAcF,OAAO,MAAM,EAAE,CAACD,UAAU,IAAI,CAAC;QACnD,MAAMI,eAAeC,UAAUH,kBAAkBI,MAAMH;QAGvD,IAAK,MAAMI,MAAMH,aAAc;YAC7B,MAAMI,MAAMD;YAEZ,IAAIE,MAAM,OAAO,CAACL,YAAY,CAACI,IAAI,GACjCJ,YAAY,CAACI,IAAI,GAAGE,WAAWN,YAAY,CAACI,IAAI,EAAEN,gBAAgB,CAACM,IAAI;QAE3E;QAEAP,OAAO,MAAM,GAAG;YACd,CAACD,UAAU,EAAEI;QACf;IACF;IAEA,MAAMO,mBAAmBb,aAAa,CAACH,MAAM,EAAE,QAAQ,CAACK,UAAU;IAElEC,OAAO,WAAW,GAAG;QACnB,QAAQ;YACN,CAACD,UAAU,EAAEW;QACf;IACF;IAEA,OAAOV;AACT;AAEA,MAAMS,aAAa,CACjBE,KACAC;IAEA,IAAIC,UAAUD,cAAcE,SAASF,cAAcG,SAASH,YAC1D,OAAOD;IAGT,IAAI,CAACH,MAAM,OAAO,CAACG,MACjB,OAAOA;IAGT,IAAIA,IAAI,IAAI,CAAC,CAACK,IAAM,CAACC,aAAaD,KAChC,OAAOL;IAGT,OAAOA,IAAI,GAAG,CAAC,CAACO,OACPC,MAAMP,WAAWM;AAE5B"}