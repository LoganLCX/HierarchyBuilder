{"version":3,"file":"pipeline/advanced/chart/pipes/encoding/boxplot.js","sources":["../../../../../../../src/pipeline/advanced/chart/pipes/encoding/boxplot.ts"],"sourcesContent":["import { unique } from 'remeda'\nimport { MeasureId } from 'src/dataReshape'\nimport { findAllMeasures } from 'src/pipeline/utils'\nimport type { AdvancedPipe, Dimension, Dimensions, Encoding, Measure, Measures } from 'src/types'\nimport { addColorToEncoding } from './color'\n\nexport const defaultEncodingForBoxplot: AdvancedPipe = (advancedVSeed) => {\n  const { measures: vseedMeasures = [], dimensions = [] } = advancedVSeed\n  const measures = findAllMeasures(vseedMeasures)\n  const encoding: Encoding = {}\n  generateDefaultDimensionEncoding(dimensions, encoding)\n  generateDefaultMeasureEncoding(measures, encoding)\n  return { ...advancedVSeed, encoding }\n}\n\nexport const encodingForBoxplot: AdvancedPipe = (advancedVSeed) => {\n  const { measures: vseedMeasures = [], dimensions = [] } = advancedVSeed\n  const measures = findAllMeasures(vseedMeasures)\n\n  const hasDimensionEncoding = dimensions.some((item: Dimension) => item.encoding)\n  const hasMeasureEncoding = measures.some((item: Measure) => item.encoding)\n  const encoding: Encoding = {}\n\n  if (hasDimensionEncoding) {\n    generateDimensionEncoding(dimensions, encoding, measures.length > 1)\n  } else {\n    generateDefaultDimensionEncoding(dimensions, encoding)\n  }\n\n  if (hasMeasureEncoding) {\n    generateMeasureEncoding(measures, encoding)\n  } else {\n    generateDefaultMeasureEncoding(measures, encoding)\n  }\n\n  if ((!encoding.value || encoding.value.length <= 1) && encoding.color && encoding.color.length > 1) {\n    encoding.color = encoding.color.filter((c) => c !== MeasureId)\n  }\n\n  return { ...advancedVSeed, encoding }\n}\n\n/**\n * --------------------维度--------------------\n */\nconst generateDefaultDimensionEncoding = (dimensions: Dimensions, encoding: Encoding) => {\n  const onlyMeasureId = dimensions.length === 1 && dimensions.find((item) => item.id === MeasureId)\n  const uniqueDimIds = unique(dimensions.map((d) => d.id))\n  encoding.x = uniqueDimIds.slice(0, 1) // 第一个维度放置于X轴\n  encoding.color = uniqueDimIds.slice(onlyMeasureId ? 0 : 1) // 第二个之后的维度用于颜色\n  encoding.tooltip = uniqueDimIds.filter((d) => d !== MeasureId) // 展示指标名称之外的所有维度\n  encoding.label = [] // 默认不展示标签\n  encoding.row = [] // 默认不进行行透视\n  encoding.column = [] // 默认不进行列透视\n}\nconst generateDimensionEncoding = (dimensions: Dimensions, encoding: Encoding, isMultiMeasure: boolean) => {\n  // x\n  encoding.x = unique(dimensions.filter((item) => item.encoding === 'xAxis').map((item) => item.id))\n  if (encoding.x.length === 0) {\n    encoding.x = [dimensions[0].id]\n  }\n\n  // color\n  addColorToEncoding(dimensions, encoding, isMultiMeasure)\n\n  // tooltip\n  encoding.tooltip = unique(dimensions.map((item) => item.id))\n  encoding.tooltip = encoding.tooltip.filter((d) => d !== MeasureId)\n\n  // label\n  encoding.label = unique(dimensions.filter((item) => item.encoding === 'label').map((item) => item.id))\n  encoding.label = encoding.label.filter((d) => d !== MeasureId)\n}\n\n/**\n * --------------------指标--------------------\n */\nconst generateDefaultMeasureEncoding = (measures: Measures, encoding: Encoding) => {\n  encoding.value = unique(measures.filter((item) => item.encoding === 'value' || !item.encoding).map((item) => item.id))\n}\nconst generateMeasureEncoding = (measures: Measures, encoding: Encoding) => {\n  // y\n  encoding.value = unique(measures.filter((item) => item.encoding === 'value' || !item.encoding).map((item) => item.id))\n  encoding.q1 = unique(measures.filter((item) => item.encoding === 'q1').map((item) => item.id))\n  encoding.median = unique(measures.filter((item) => item.encoding === 'median').map((item) => item.id))\n  encoding.q3 = unique(measures.filter((item) => item.encoding === 'q3').map((item) => item.id))\n  encoding.min = unique(measures.filter((item) => item.encoding === 'min').map((item) => item.id))\n  encoding.max = unique(measures.filter((item) => item.encoding === 'max').map((item) => item.id))\n  encoding.outliers = unique(measures.filter((item) => item.encoding === 'outliers').map((item) => item.id))\n  // color\n  const color = unique(measures.filter((item) => item.encoding === 'color').map((item) => item.id))\n  if (color.length > 0) {\n    encoding.color = color\n  }\n\n  // label\n  const label = unique(measures.filter((item) => item.encoding === 'label').map((item) => item.id))\n  encoding.label = unique([...(encoding.label || []), ...label])\n\n  // tooltip\n  const tooltip = unique(measures.filter((item) => item.encoding === 'tooltip').map((item) => item.id))\n  encoding.tooltip = unique([...(encoding.tooltip || []), ...label, ...tooltip])\n}\n"],"names":["defaultEncodingForBoxplot","advancedVSeed","vseedMeasures","dimensions","measures","findAllMeasures","encoding","generateDefaultDimensionEncoding","generateDefaultMeasureEncoding","encodingForBoxplot","hasDimensionEncoding","item","hasMeasureEncoding","generateDimensionEncoding","generateMeasureEncoding","c","MeasureId","onlyMeasureId","uniqueDimIds","unique","d","isMultiMeasure","addColorToEncoding","color","label","tooltip"],"mappings":"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"}