{"version":3,"file":"pipeline/advanced/chart/pipes/config/histogram.js","sources":["../../../../../../../src/pipeline/advanced/chart/pipes/config/histogram.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-assignment */\nimport { merge } from '@visactor/vutils'\nimport { pick } from 'remeda'\nimport { BinEndMeasureId, BinStartMeasureId } from 'src/dataReshape'\nimport { replaceNullToUndefined } from 'src/pipeline/utils'\nimport type { AdvancedPipe, AdvancedVSeed, Config, Dimension } from 'src/types'\n\nexport const histogramConfig: AdvancedPipe = (advancedVSeed, context) => {\n  const { vseed } = context\n  const { chartType } = vseed\n  const result = {\n    ...advancedVSeed,\n  }\n  const hasColorEncoding = (advancedVSeed?.dimensions || []).find((field: Dimension) => field?.encoding === 'color')\n\n  const pickedConfig = pick(vseed, [\n    'backgroundColor',\n    'color',\n    'label',\n    'legend',\n    'tooltip',\n    'xAxis',\n    'yAxis',\n    'crosshairRect',\n    'binCount',\n    'binStep',\n    'binValueType',\n\n    'dimensionLinkage',\n  ]) as Config['histogram']\n\n  let config = replaceNullToUndefined(pickedConfig)\n\n  if (pickedConfig?.binValueType === 'percentage') {\n    config = merge(\n      {},\n      {\n        yAxis: {\n          autoFomat: false,\n          numFormat: {\n            type: 'percent',\n            fractionDigits: 1,\n          },\n        },\n        label: {\n          autoFormat: false,\n          numFormat: {\n            type: 'percent',\n            fractionDigits: 1,\n          },\n        },\n      },\n      config,\n    )\n  }\n  if (!hasColorEncoding && !config?.legend?.enable) {\n    config = {\n      ...config,\n      legend: {\n        ...config?.legend,\n        enable: false,\n      },\n    }\n  }\n  result.config = {\n    ...(result.config || {}),\n    [chartType]: {\n      ...config,\n    },\n  }\n\n  return result as AdvancedVSeed\n}\n\nexport const histogramXAxisConfig: AdvancedPipe = (advancedVSeed, context) => {\n  const { vseed } = context\n  const { chartType } = vseed\n  const result = {\n    ...advancedVSeed,\n  }\n  const { dataset = [] } = advancedVSeed\n  const flattenDatasert = dataset.flat()\n  const minValue = Math.min(...flattenDatasert.map((v) => +v[BinStartMeasureId]))\n  const maxValue = Math.max(...flattenDatasert.map((v) => +v[BinEndMeasureId]))\n\n  const chartConfig = result.config?.[chartType] as any\n  result.config = {\n    ...(result.config || {}),\n    [chartType]: {\n      ...chartConfig,\n      xAxis: {\n        min: Number.isNaN(minValue) ? undefined : minValue,\n        max: Number.isNaN(maxValue) ? undefined : maxValue,\n        ...(chartConfig?.xAxis || {}),\n      },\n    },\n  }\n\n  return result as AdvancedVSeed\n}\n"],"names":["histogramConfig","advancedVSeed","context","vseed","chartType","result","hasColorEncoding","field","pickedConfig","pick","config","replaceNullToUndefined","merge","histogramXAxisConfig","dataset","flattenDatasert","minValue","Math","v","BinStartMeasureId","maxValue","BinEndMeasureId","chartConfig","Number","undefined"],"mappings":";;;;AAOO,MAAMA,kBAAgC,CAACC,eAAeC;IAC3D,MAAM,EAAEC,KAAK,EAAE,GAAGD;IAClB,MAAM,EAAEE,SAAS,EAAE,GAAGD;IACtB,MAAME,SAAS;QACb,GAAGJ,aAAa;IAClB;IACA,MAAMK,mBAAoBL,AAAAA,CAAAA,eAAe,cAAc,EAAC,EAAG,IAAI,CAAC,CAACM,QAAqBA,OAAO,aAAa;IAE1G,MAAMC,eAAeC,KAAKN,OAAO;QAC/B;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QAEA;KACD;IAED,IAAIO,SAASC,uBAAuBH;IAEpC,IAAIA,cAAc,iBAAiB,cACjCE,SAASE,MACP,CAAC,GACD;QACE,OAAO;YACL,WAAW;YACX,WAAW;gBACT,MAAM;gBACN,gBAAgB;YAClB;QACF;QACA,OAAO;YACL,YAAY;YACZ,WAAW;gBACT,MAAM;gBACN,gBAAgB;YAClB;QACF;IACF,GACAF;IAGJ,IAAI,CAACJ,oBAAoB,CAACI,QAAQ,QAAQ,QACxCA,SAAS;QACP,GAAGA,MAAM;QACT,QAAQ;YACN,GAAGA,QAAQ,MAAM;YACjB,QAAQ;QACV;IACF;IAEFL,OAAO,MAAM,GAAG;QACd,GAAIA,OAAO,MAAM,IAAI,CAAC,CAAC;QACvB,CAACD,UAAU,EAAE;YACX,GAAGM,MAAM;QACX;IACF;IAEA,OAAOL;AACT;AAEO,MAAMQ,uBAAqC,CAACZ,eAAeC;IAChE,MAAM,EAAEC,KAAK,EAAE,GAAGD;IAClB,MAAM,EAAEE,SAAS,EAAE,GAAGD;IACtB,MAAME,SAAS;QACb,GAAGJ,aAAa;IAClB;IACA,MAAM,EAAEa,UAAU,EAAE,EAAE,GAAGb;IACzB,MAAMc,kBAAkBD,QAAQ,IAAI;IACpC,MAAME,WAAWC,KAAK,GAAG,IAAIF,gBAAgB,GAAG,CAAC,CAACG,IAAM,CAACA,CAAC,CAACC,kBAAkB;IAC7E,MAAMC,WAAWH,KAAK,GAAG,IAAIF,gBAAgB,GAAG,CAAC,CAACG,IAAM,CAACA,CAAC,CAACG,gBAAgB;IAE3E,MAAMC,cAAcjB,OAAO,MAAM,EAAE,CAACD,UAAU;IAC9CC,OAAO,MAAM,GAAG;QACd,GAAIA,OAAO,MAAM,IAAI,CAAC,CAAC;QACvB,CAACD,UAAU,EAAE;YACX,GAAGkB,WAAW;YACd,OAAO;gBACL,KAAKC,OAAO,KAAK,CAACP,YAAYQ,SAAYR;gBAC1C,KAAKO,OAAO,KAAK,CAACH,YAAYI,SAAYJ;gBAC1C,GAAIE,aAAa,SAAS,CAAC,CAAC;YAC9B;QACF;IACF;IAEA,OAAOjB;AACT"}