{"version":3,"file":"pipeline/utils/tree/traverse.js","sources":["../../../../../src/pipeline/utils/tree/traverse.ts"],"sourcesContent":["/**\n * 支持泛型与可配置子节点键名的非递归前序遍历\n * @param tree 根节点数组\n * @param callback 遍历时对每个节点执行的回调，返回 true 时停止遍历\n * @param childrenKey 子节点键名（默认 'children'）\n */\ntype WithChildren<Node, K extends string> = Node & { [P in K]?: Node[] }\n\nexport const preorderTraverse = <Node, K extends string = 'children'>(\n  tree: Node[],\n  callback: (node: Node) => boolean,\n  childrenKey: K = 'children' as K,\n) => {\n  if (!tree || tree.length === 0) return\n\n  const stack: Node[] = [...tree].reverse()\n\n  while (stack.length > 0) {\n    const node = stack.pop() as Node\n    const stop = callback(node)\n    if (stop === true) {\n      return\n    }\n\n    const children = (node as WithChildren<Node, K>)[childrenKey]\n    if (Array.isArray(children) && children.length > 0) {\n      for (let i = children.length - 1; i >= 0; i--) {\n        const child = children[i]\n        stack.push(child)\n      }\n    }\n  }\n}\n\nexport const findTreeNodesBy = <Node, K extends string = 'children'>(\n  nodes: Node[] = [],\n  callback: (node: Node) => boolean,\n  childrenKey: K = 'children' as K,\n): Node[] => {\n  if (!nodes) return []\n  const result: Node[] = []\n  preorderTraverse<Node, K>(nodes, (node) => {\n    if (!(childrenKey in (node as WithChildren<Node, K>))) {\n      if (callback(node)) {\n        result.push(node)\n      }\n    }\n    return false\n  })\n  return result\n}\n"],"names":["preorderTraverse","tree","callback","childrenKey","stack","node","stop","children","Array","i","child","findTreeNodesBy","nodes","result"],"mappings":"AAQO,MAAMA,mBAAmB,CAC9BC,MACAC,UACAC,cAAiB,UAAe;IAEhC,IAAI,CAACF,QAAQA,AAAgB,MAAhBA,KAAK,MAAM,EAAQ;IAEhC,MAAMG,QAAgB;WAAIH;KAAK,CAAC,OAAO;IAEvC,MAAOG,MAAM,MAAM,GAAG,EAAG;QACvB,MAAMC,OAAOD,MAAM,GAAG;QACtB,MAAME,OAAOJ,SAASG;QACtB,IAAIC,AAAS,SAATA,MACF;QAGF,MAAMC,WAAYF,IAA8B,CAACF,YAAY;QAC7D,IAAIK,MAAM,OAAO,CAACD,aAAaA,SAAS,MAAM,GAAG,GAC/C,IAAK,IAAIE,IAAIF,SAAS,MAAM,GAAG,GAAGE,KAAK,GAAGA,IAAK;YAC7C,MAAMC,QAAQH,QAAQ,CAACE,EAAE;YACzBL,MAAM,IAAI,CAACM;QACb;IAEJ;AACF;AAEO,MAAMC,kBAAkB,CAC7BC,QAAgB,EAAE,EAClBV,UACAC,cAAiB,UAAe;IAEhC,IAAI,CAACS,OAAO,OAAO,EAAE;IACrB,MAAMC,SAAiB,EAAE;IACzBb,iBAA0BY,OAAO,CAACP;QAChC,IAAI,CAAEF,CAAAA,eAAgBE,IAAG,GACvB;YAAA,IAAIH,SAASG,OACXQ,OAAO,IAAI,CAACR;QACd;QAEF,OAAO;IACT;IACA,OAAOQ;AACT"}