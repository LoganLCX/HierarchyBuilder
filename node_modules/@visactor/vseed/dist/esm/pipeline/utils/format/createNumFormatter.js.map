{"version":3,"file":"pipeline/utils/format/createNumFormatter.js","sources":["../../../../../src/pipeline/utils/format/createNumFormatter.ts"],"sourcesContent":["import { isNumber } from 'remeda'\nimport { intl } from '../../../i18n'\nimport type { Formatter, Locale, NumFormat } from 'src/types'\n\nexport const createNumFormatter = (format?: Partial<NumFormat>, locale: Locale = intl.getLocale()): Formatter => {\n  const {\n    type = 'number',\n    ratio = 1,\n    thousandSeparator = true,\n    prefix = '',\n    suffix = '',\n    symbol = '',\n    fractionDigits = 2,\n    significantDigits,\n    roundingMode = 'halfExpand',\n    roundingPriority = 'auto',\n  } = format || {}\n\n  const numFormatterOptions: Intl.NumberFormatOptions = {\n    style: 'decimal',\n    notation: type === 'scientific' ? 'scientific' : 'standard',\n    // @ts-expect-error roundingMode is not in NumberFormatOptions\n    roundingMode,\n    roundingPriority,\n  }\n\n  if (isNumber(fractionDigits)) {\n    if (fractionDigits >= 0) {\n      numFormatterOptions.minimumFractionDigits = fractionDigits\n      numFormatterOptions.maximumFractionDigits = fractionDigits\n    }\n  }\n  if (isNumber(significantDigits) && significantDigits > 0) {\n    if (significantDigits > 0) {\n      numFormatterOptions.minimumSignificantDigits = significantDigits\n      numFormatterOptions.maximumSignificantDigits = significantDigits\n    }\n  }\n\n  const numFormatter = new Intl.NumberFormat(locale, { ...numFormatterOptions, useGrouping: thousandSeparator })\n\n  return (value?: number | string) => {\n    let num = Number(value)\n    let typeSymbol = ''\n    if (Number.isNaN(num)) {\n      return String(value)\n    }\n\n    // apply ratio for percent/permille\n    if (type === 'percent') {\n      num *= 100\n      typeSymbol = '%'\n    } else if (type === 'permille') {\n      num *= 1000\n      typeSymbol = 'â€°'\n    } else if (type === 'number') {\n      num = num / (ratio || 1)\n    }\n\n    // format value\n    let numStr = numFormatter.format(num)\n\n    // add thousand separator\n    if (thousandSeparator) {\n      const parts = numStr.split('.')\n      parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\n      numStr = parts.join('.')\n    }\n\n    const validSymbol = symbol ?? ''\n\n    // add symbol, typeSymbol, prefix and suffix\n    return `${prefix}${numStr}${typeSymbol}${validSymbol}${suffix}`\n  }\n}\n\nexport const autoNumFormatter = (value?: number | string, locale: Locale = intl.getLocale()): string => {\n  if (value === undefined || value === null) return String(value)\n  const num = Number(value)\n  if (Number.isNaN(num)) return String(value)\n\n  const numFormatterOptions: Intl.NumberFormatOptions = {\n    style: 'decimal',\n    notation: 'compact',\n    useGrouping: true,\n  }\n  numFormatterOptions.minimumFractionDigits = 0\n  numFormatterOptions.maximumFractionDigits = 2\n\n  const numFormatter = new Intl.NumberFormat(locale, { ...numFormatterOptions })\n\n  return numFormatter.format(Number(value))\n}\n"],"names":["createNumFormatter","format","locale","intl","type","ratio","thousandSeparator","prefix","suffix","symbol","fractionDigits","significantDigits","roundingMode","roundingPriority","numFormatterOptions","isNumber","numFormatter","Intl","value","num","Number","typeSymbol","String","numStr","parts","validSymbol","autoNumFormatter"],"mappings":";;AAIO,MAAMA,qBAAqB,CAACC,QAA6BC,SAAiBC,KAAK,SAAS,EAAE;IAC/F,MAAM,EACJC,OAAO,QAAQ,EACfC,QAAQ,CAAC,EACTC,oBAAoB,IAAI,EACxBC,SAAS,EAAE,EACXC,SAAS,EAAE,EACXC,SAAS,EAAE,EACXC,iBAAiB,CAAC,EAClBC,iBAAiB,EACjBC,eAAe,YAAY,EAC3BC,mBAAmB,MAAM,EAC1B,GAAGZ,UAAU,CAAC;IAEf,MAAMa,sBAAgD;QACpD,OAAO;QACP,UAAUV,AAAS,iBAATA,OAAwB,eAAe;QAEjDQ;QACAC;IACF;IAEA,IAAIE,SAASL,iBACX;QAAA,IAAIA,kBAAkB,GAAG;YACvBI,oBAAoB,qBAAqB,GAAGJ;YAC5CI,oBAAoB,qBAAqB,GAAGJ;QAC9C;IAAA;IAEF,IAAIK,SAASJ,sBAAsBA,oBAAoB,GACrD;QAAA,IAAIA,oBAAoB,GAAG;YACzBG,oBAAoB,wBAAwB,GAAGH;YAC/CG,oBAAoB,wBAAwB,GAAGH;QACjD;IAAA;IAGF,MAAMK,eAAe,IAAIC,KAAK,YAAY,CAACf,QAAQ;QAAE,GAAGY,mBAAmB;QAAE,aAAaR;IAAkB;IAE5G,OAAO,CAACY;QACN,IAAIC,MAAMC,OAAOF;QACjB,IAAIG,aAAa;QACjB,IAAID,OAAO,KAAK,CAACD,MACf,OAAOG,OAAOJ;QAIhB,IAAId,AAAS,cAATA,MAAoB;YACtBe,OAAO;YACPE,aAAa;QACf,OAAO,IAAIjB,AAAS,eAATA,MAAqB;YAC9Be,OAAO;YACPE,aAAa;QACf,OAAO,IAAIjB,AAAS,aAATA,MACTe,OAAad,SAAS;QAIxB,IAAIkB,SAASP,aAAa,MAAM,CAACG;QAGjC,IAAIb,mBAAmB;YACrB,MAAMkB,QAAQD,OAAO,KAAK,CAAC;YAC3BC,KAAK,CAAC,EAAE,GAAGA,KAAK,CAAC,EAAE,CAAC,OAAO,CAAC,yBAAyB;YACrDD,SAASC,MAAM,IAAI,CAAC;QACtB;QAEA,MAAMC,cAAchB,UAAU;QAG9B,OAAO,GAAGF,SAASgB,SAASF,aAAaI,cAAcjB,QAAQ;IACjE;AACF;AAEO,MAAMkB,mBAAmB,CAACR,OAAyBhB,SAAiBC,KAAK,SAAS,EAAE;IACzF,IAAIe,QAAAA,OAAuC,OAAOI,OAAOJ;IACzD,MAAMC,MAAMC,OAAOF;IACnB,IAAIE,OAAO,KAAK,CAACD,MAAM,OAAOG,OAAOJ;IAErC,MAAMJ,sBAAgD;QACpD,OAAO;QACP,UAAU;QACV,aAAa;IACf;IACAA,oBAAoB,qBAAqB,GAAG;IAC5CA,oBAAoB,qBAAqB,GAAG;IAE5C,MAAME,eAAe,IAAIC,KAAK,YAAY,CAACf,QAAQ;QAAE,GAAGY,mBAAmB;IAAC;IAE5E,OAAOE,aAAa,MAAM,CAACI,OAAOF;AACpC"}