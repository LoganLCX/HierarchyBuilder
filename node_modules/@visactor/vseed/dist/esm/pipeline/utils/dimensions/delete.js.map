{"version":3,"file":"pipeline/utils/dimensions/delete.js","sources":["../../../../../src/pipeline/utils/dimensions/delete.ts"],"sourcesContent":["import type { Dimension, DimensionGroup, DimensionTree } from 'src/types'\nimport { isDimension, isDimensionGroup } from './typeGuard'\n\n/**\n * @description 删除 dimensionTree 中符合 callback 条件的节点\n * @param dimensionTree 待删除的 dimensionTree\n * @param callback 回调函数，用于判断是否删除当前节点\n * @returns 删除后的 dimensionTree\n */\nexport const deleteDimensionTreeByCallback = <T extends DimensionTree>(\n  dimensionTree?: T,\n  callback?: (dimension: Dimension, index: number, dimensions: (Dimension | DimensionGroup)[]) => boolean,\n) => {\n  if (!dimensionTree) {\n    return dimensionTree\n  }\n  const stack: (Dimension | DimensionGroup)[] = [...dimensionTree].reverse()\n  const parents = new Map<Dimension | DimensionGroup, (Dimension | DimensionGroup)[]>()\n\n  dimensionTree.forEach((node) => {\n    parents.set(node, dimensionTree)\n  })\n\n  const nodesToProcess: (Dimension | DimensionGroup)[] = []\n  const visited = new Set<Dimension | DimensionGroup>()\n\n  while (stack.length > 0) {\n    const node = stack[stack.length - 1]\n\n    if (isDimensionGroup(node) && node.children && !visited.has(node)) {\n      visited.add(node)\n      const children = node.children.slice().reverse()\n      for (const child of children) {\n        parents.set(child, node.children)\n        stack.push(child)\n      }\n    } else {\n      stack.pop()\n      nodesToProcess.push(node)\n    }\n  }\n\n  for (const node of nodesToProcess) {\n    const parentList = parents.get(node)\n\n    if (parentList) {\n      const index = parentList.indexOf(node)\n      if (isDimension(node)) {\n        if (callback?.(node, index, parentList)) {\n          parentList.splice(index, 1)\n        }\n      }\n    }\n  }\n\n  return dimensionTree\n}\n"],"names":["deleteDimensionTreeByCallback","dimensionTree","callback","stack","parents","Map","node","nodesToProcess","visited","Set","isDimensionGroup","children","child","parentList","index","isDimension"],"mappings":";AASO,MAAMA,gCAAgC,CAC3CC,eACAC;IAEA,IAAI,CAACD,eACH,OAAOA;IAET,MAAME,QAAwC;WAAIF;KAAc,CAAC,OAAO;IACxE,MAAMG,UAAU,IAAIC;IAEpBJ,cAAc,OAAO,CAAC,CAACK;QACrBF,QAAQ,GAAG,CAACE,MAAML;IACpB;IAEA,MAAMM,iBAAiD,EAAE;IACzD,MAAMC,UAAU,IAAIC;IAEpB,MAAON,MAAM,MAAM,GAAG,EAAG;QACvB,MAAMG,OAAOH,KAAK,CAACA,MAAM,MAAM,GAAG,EAAE;QAEpC,IAAIO,iBAAiBJ,SAASA,KAAK,QAAQ,IAAI,CAACE,QAAQ,GAAG,CAACF,OAAO;YACjEE,QAAQ,GAAG,CAACF;YACZ,MAAMK,WAAWL,KAAK,QAAQ,CAAC,KAAK,GAAG,OAAO;YAC9C,KAAK,MAAMM,SAASD,SAAU;gBAC5BP,QAAQ,GAAG,CAACQ,OAAON,KAAK,QAAQ;gBAChCH,MAAM,IAAI,CAACS;YACb;QACF,OAAO;YACLT,MAAM,GAAG;YACTI,eAAe,IAAI,CAACD;QACtB;IACF;IAEA,KAAK,MAAMA,QAAQC,eAAgB;QACjC,MAAMM,aAAaT,QAAQ,GAAG,CAACE;QAE/B,IAAIO,YAAY;YACd,MAAMC,QAAQD,WAAW,OAAO,CAACP;YACjC,IAAIS,YAAYT,OACd;gBAAA,IAAIJ,WAAWI,MAAMQ,OAAOD,aAC1BA,WAAW,MAAM,CAACC,OAAO;YAC3B;QAEJ;IACF;IAEA,OAAOb;AACT"}