{"version":3,"file":"pipeline/utils/measures/delete.js","sources":["../../../../../src/pipeline/utils/measures/delete.ts"],"sourcesContent":["import type { Measure, MeasureGroup, MeasureTree } from 'src/types'\nimport { isMeasure, isMeasureGroup } from './typeGuard'\n\n/**\n * @description 删除 measureTree 中符合 callback 条件的节点\n * @param measureTree 待删除的 measureTree\n * @param callback 回调函数，用于判断是否删除当前节点\n * @returns 删除的度量\n */\nexport const deleteMeasureTreeByCallback = <T extends MeasureTree>(\n  measureTree?: T,\n  callback?: (measure: Measure, index: number, measures: (Measure | MeasureGroup)[]) => boolean,\n): Measure[] => {\n  if (!measureTree) {\n    return undefined as unknown as Measure[]\n  }\n  const stack: (Measure | MeasureGroup)[] = [...measureTree].reverse()\n  const parents = new Map<Measure | MeasureGroup, (Measure | MeasureGroup)[]>()\n\n  measureTree.forEach((node) => {\n    parents.set(node, measureTree)\n  })\n\n  const nodesToProcess: Measure[] = []\n  const visited = new Set<Measure | MeasureGroup>()\n\n  while (stack.length > 0) {\n    const node = stack[stack.length - 1]\n\n    if (isMeasureGroup(node) && node.children && !visited.has(node)) {\n      visited.add(node)\n      const children = node.children.slice().reverse()\n      for (const child of children) {\n        parents.set(child, node.children)\n        stack.push(child)\n      }\n    } else {\n      stack.pop()\n      nodesToProcess.push(node as Measure)\n    }\n  }\n  const deleted: Measure[] = []\n\n  for (const node of nodesToProcess) {\n    const parentList = parents.get(node)\n\n    if (parentList) {\n      const index = parentList.indexOf(node)\n      if (isMeasure(node)) {\n        if (callback?.(node, index, parentList)) {\n          parentList.splice(index, 1)\n          deleted.push(node)\n        }\n      }\n    }\n  }\n\n  return deleted\n}\n"],"names":["deleteMeasureTreeByCallback","measureTree","callback","stack","parents","Map","node","nodesToProcess","visited","Set","isMeasureGroup","children","child","deleted","parentList","index","isMeasure"],"mappings":";AASO,MAAMA,8BAA8B,CACzCC,aACAC;IAEA,IAAI,CAACD,aACH;IAEF,MAAME,QAAoC;WAAIF;KAAY,CAAC,OAAO;IAClE,MAAMG,UAAU,IAAIC;IAEpBJ,YAAY,OAAO,CAAC,CAACK;QACnBF,QAAQ,GAAG,CAACE,MAAML;IACpB;IAEA,MAAMM,iBAA4B,EAAE;IACpC,MAAMC,UAAU,IAAIC;IAEpB,MAAON,MAAM,MAAM,GAAG,EAAG;QACvB,MAAMG,OAAOH,KAAK,CAACA,MAAM,MAAM,GAAG,EAAE;QAEpC,IAAIO,eAAeJ,SAASA,KAAK,QAAQ,IAAI,CAACE,QAAQ,GAAG,CAACF,OAAO;YAC/DE,QAAQ,GAAG,CAACF;YACZ,MAAMK,WAAWL,KAAK,QAAQ,CAAC,KAAK,GAAG,OAAO;YAC9C,KAAK,MAAMM,SAASD,SAAU;gBAC5BP,QAAQ,GAAG,CAACQ,OAAON,KAAK,QAAQ;gBAChCH,MAAM,IAAI,CAACS;YACb;QACF,OAAO;YACLT,MAAM,GAAG;YACTI,eAAe,IAAI,CAACD;QACtB;IACF;IACA,MAAMO,UAAqB,EAAE;IAE7B,KAAK,MAAMP,QAAQC,eAAgB;QACjC,MAAMO,aAAaV,QAAQ,GAAG,CAACE;QAE/B,IAAIQ,YAAY;YACd,MAAMC,QAAQD,WAAW,OAAO,CAACR;YACjC,IAAIU,UAAUV,OACZ;gBAAA,IAAIJ,WAAWI,MAAMS,OAAOD,aAAa;oBACvCA,WAAW,MAAM,CAACC,OAAO;oBACzBF,QAAQ,IAAI,CAACP;gBACf;YAAA;QAEJ;IACF;IAEA,OAAOO;AACT"}