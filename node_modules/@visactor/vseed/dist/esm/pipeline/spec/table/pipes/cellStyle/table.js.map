{"version":3,"file":"pipeline/spec/table/pipes/cellStyle/table.js","sources":["../../../../../../../src/pipeline/spec/table/pipes/cellStyle/table.ts"],"sourcesContent":["import type { ListTableConstructorOptions, ColumnDefine } from '@visactor/vtable'\nimport { array } from '@visactor/vutils'\nimport { isNullish, isNumber, isPlainObject, isString } from 'remeda'\nimport { selector } from 'src/dataSelector/selector'\nimport type { BodyCellStyle, ListTableSpecPipe } from 'src/types'\nimport type { MeasureSelector, Selectors } from 'src/types/dataSelector'\nimport { pickBodyCellStyle } from './common'\nimport { preorderTraverse } from 'src/pipeline/utils/tree/traverse'\n\nexport const tableBodyCell: ListTableSpecPipe = (spec, context) => {\n  const { advancedVSeed } = context\n  const { cellStyle } = advancedVSeed\n  const bodyCellStyle = cellStyle?.bodyCellStyle\n\n  if (!bodyCellStyle) {\n    return spec as ListTableConstructorOptions\n  }\n  const bodyCellStyleList = array(bodyCellStyle) as BodyCellStyle[]\n  const columns = (spec as ListTableConstructorOptions).columns || []\n  const setStyleOfColumn = (col: ColumnDefine) => {\n    const field = col.field as string\n    const matchedStyles = bodyCellStyleList.filter((style) => {\n      if (isNullish(style.selector)) {\n        return true\n      }\n      const selectors = array(style.selector) as Selectors\n\n      return selectors.some((selector) => {\n        return isPlainObject(selector)\n          ? isNullish(selector.field) || (selector as MeasureSelector).field === field\n          : isNumber(selector) || isString(selector)\n      })\n    })\n\n    if (!matchedStyles.length) {\n      return false\n    }\n\n    col.style = (datum: any) => {\n      const originalDatum = {\n        [field]: datum.dataValue,\n      }\n\n      const mergedStyle = matchedStyles.reduce<Record<string, any>>((result, style) => {\n        if (selector(originalDatum, style.selector)) {\n          return {\n            ...result,\n            ...pickBodyCellStyle(style),\n          }\n        }\n\n        return result\n      }, {})\n\n      return mergedStyle\n    }\n    return false\n  }\n\n  preorderTraverse<ColumnDefine, 'columns'>(columns, setStyleOfColumn, 'columns')\n\n  return spec as ListTableConstructorOptions\n}\n"],"names":["tableBodyCell","spec","context","advancedVSeed","cellStyle","bodyCellStyle","bodyCellStyleList","array","columns","setStyleOfColumn","col","field","matchedStyles","style","isNullish","selectors","selector","isPlainObject","isNumber","isString","datum","originalDatum","mergedStyle","result","pickBodyCellStyle","preorderTraverse"],"mappings":";;;;;AASO,MAAMA,gBAAmC,CAACC,MAAMC;IACrD,MAAM,EAAEC,aAAa,EAAE,GAAGD;IAC1B,MAAM,EAAEE,SAAS,EAAE,GAAGD;IACtB,MAAME,gBAAgBD,WAAW;IAEjC,IAAI,CAACC,eACH,OAAOJ;IAET,MAAMK,oBAAoBC,MAAMF;IAChC,MAAMG,UAAWP,KAAqC,OAAO,IAAI,EAAE;IACnE,MAAMQ,mBAAmB,CAACC;QACxB,MAAMC,QAAQD,IAAI,KAAK;QACvB,MAAME,gBAAgBN,kBAAkB,MAAM,CAAC,CAACO;YAC9C,IAAIC,UAAUD,MAAM,QAAQ,GAC1B,OAAO;YAET,MAAME,YAAYR,MAAMM,MAAM,QAAQ;YAEtC,OAAOE,UAAU,IAAI,CAAC,CAACC,WACdC,cAAcD,YACjBF,UAAUE,SAAS,KAAK,KAAMA,SAA6B,KAAK,KAAKL,QACrEO,SAASF,aAAaG,SAASH;QAEvC;QAEA,IAAI,CAACJ,cAAc,MAAM,EACvB,OAAO;QAGTF,IAAI,KAAK,GAAG,CAACU;YACX,MAAMC,gBAAgB;gBACpB,CAACV,MAAM,EAAES,MAAM,SAAS;YAC1B;YAEA,MAAME,cAAcV,cAAc,MAAM,CAAsB,CAACW,QAAQV;gBACrE,IAAIG,qBAASK,eAAeR,MAAM,QAAQ,GACxC,OAAO;oBACL,GAAGU,MAAM;oBACT,GAAGC,kBAAkBX,MAAM;gBAC7B;gBAGF,OAAOU;YACT,GAAG,CAAC;YAEJ,OAAOD;QACT;QACA,OAAO;IACT;IAEAG,iBAA0CjB,SAASC,kBAAkB;IAErE,OAAOR;AACT"}