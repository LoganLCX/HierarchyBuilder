{"version":3,"file":"pipeline/spec/table/pipes/columns/dimensionsToColumns.js","sources":["../../../../../../../src/pipeline/spec/table/pipes/columns/dimensionsToColumns.ts"],"sourcesContent":["import type { ColumnsDefine, ListTableConstructorOptions } from '@visactor/vtable'\nimport { isMeasure } from 'src/pipeline/utils'\nimport type { Dimension, DimensionGroup, DimensionTree, ListTableSpecPipe } from 'src/types'\n\nexport const dimensionTreeToColumns: ListTableSpecPipe = (spec, context) => {\n  const { advancedVSeed } = context\n  const dimensions = (advancedVSeed as unknown as { dimensions: DimensionTree }).dimensions\n  const result = { ...spec } as ListTableConstructorOptions\n  const eachNode = (node: Dimension | DimensionGroup) => {\n    if (isMeasure(node)) {\n      return {\n        width: 'auto',\n      }\n    }\n\n    return {}\n  }\n  const columns = treeTreeToColumns<Dimension, DimensionGroup>(dimensions, eachNode)\n\n  return {\n    ...result,\n    columns: [...(result.columns || []), ...columns] as ListTableConstructorOptions['columns'],\n  }\n}\n\nconst treeTreeToColumns = <\n  T extends { id: string; alias?: string },\n  U extends { id: string; alias?: string; children?: (T | U)[] },\n>(\n  tree: (T | U)[],\n  callback?: (node: T | U) => object,\n): ColumnsDefine[] => {\n  const result = tree.map((item) => {\n    if ('children' in item && Array.isArray(item.children)) {\n      const groupNode = item as unknown as U\n      const field = groupNode.id\n      const title = groupNode.alias ?? groupNode.id\n      const props = callback?.(groupNode) || {}\n      // group\n      return {\n        field,\n        title,\n        columns: treeTreeToColumns(item.children, callback),\n        ...props,\n      }\n    } else {\n      const field = item.id\n      const title = item.alias ?? item.id\n      const props = callback?.(item) || {}\n      // leaf\n      return {\n        field,\n        title,\n        ...props,\n      }\n    }\n  }) as unknown as ColumnsDefine[]\n\n  return result || []\n}\n"],"names":["dimensionTreeToColumns","spec","context","advancedVSeed","dimensions","result","eachNode","node","isMeasure","columns","treeTreeToColumns","tree","callback","item","Array","groupNode","field","title","props"],"mappings":";AAIO,MAAMA,yBAA4C,CAACC,MAAMC;IAC9D,MAAM,EAAEC,aAAa,EAAE,GAAGD;IAC1B,MAAME,aAAcD,cAA2D,UAAU;IACzF,MAAME,SAAS;QAAE,GAAGJ,IAAI;IAAC;IACzB,MAAMK,WAAW,CAACC;QAChB,IAAIC,UAAUD,OACZ,OAAO;YACL,OAAO;QACT;QAGF,OAAO,CAAC;IACV;IACA,MAAME,UAAUC,kBAA6CN,YAAYE;IAEzE,OAAO;QACL,GAAGD,MAAM;QACT,SAAS;eAAKA,OAAO,OAAO,IAAI,EAAE;eAAMI;SAAQ;IAClD;AACF;AAEA,MAAMC,oBAAoB,CAIxBC,MACAC;IAEA,MAAMP,SAASM,KAAK,GAAG,CAAC,CAACE;QACvB,IAAI,cAAcA,QAAQC,MAAM,OAAO,CAACD,KAAK,QAAQ,GAAG;YACtD,MAAME,YAAYF;YAClB,MAAMG,QAAQD,UAAU,EAAE;YAC1B,MAAME,QAAQF,UAAU,KAAK,IAAIA,UAAU,EAAE;YAC7C,MAAMG,QAAQN,WAAWG,cAAc,CAAC;YAExC,OAAO;gBACLC;gBACAC;gBACA,SAASP,kBAAkBG,KAAK,QAAQ,EAAED;gBAC1C,GAAGM,KAAK;YACV;QACF;QAAO;YACL,MAAMF,QAAQH,KAAK,EAAE;YACrB,MAAMI,QAAQJ,KAAK,KAAK,IAAIA,KAAK,EAAE;YACnC,MAAMK,QAAQN,WAAWC,SAAS,CAAC;YAEnC,OAAO;gBACLG;gBACAC;gBACA,GAAGC,KAAK;YACV;QACF;IACF;IAEA,OAAOb,UAAU,EAAE;AACrB"}