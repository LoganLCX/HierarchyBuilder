{"version":3,"file":"pipeline/spec/chart/pipes/legend/discreteLegend.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/legend/discreteLegend.ts"],"sourcesContent":["import type { Legend, VChartSpecPipe } from 'src/types'\n\nexport const discreteLegend: VChartSpecPipe = (spec, context) => {\n  const result = { ...spec }\n  const { advancedVSeed } = context\n  const { datasetReshapeInfo, chartType } = advancedVSeed\n  const { unfoldInfo } = datasetReshapeInfo[0]\n  const baseConfig = advancedVSeed.config[chartType] as { legend: Legend }\n  if (!baseConfig || !baseConfig.legend) {\n    return result\n  }\n\n  const { legend } = baseConfig\n  const {\n    enable,\n    position = 'bottom',\n    labelFontColor,\n    labelColor,\n    labelFontSize = 12,\n    pagerIconColor,\n    pagerIconDisableColor,\n    labelFontWeight,\n    maxSize = 1,\n    border,\n    shapeType = 'rectRound',\n  } = legend || {}\n\n  const orient = ['bottom', 'bottomLeft', 'bottomRight', 'bl', 'br'].includes(position)\n    ? 'bottom'\n    : ['top', 'topLeft', 'topRight', 'tl', 'tr'].includes(position)\n      ? 'top'\n      : ['left', 'leftTop', 'leftBottom', 'lt', 'lb'].includes(position)\n        ? 'left'\n        : 'right'\n\n  const legendPosition = ['topLeft', 'bottomLeft', 'leftTop', 'rightTop', 'lt', 'rt', 'tl', 'bl'].includes(position)\n    ? 'start'\n    : ['topRight', 'bottomRight', 'leftBottom', 'rightBottom', 'lb', 'rb', 'rt', 'br'].includes(position)\n      ? 'end'\n      : 'middle'\n  const labelTextColor = labelColor || labelFontColor\n\n  result.legends = {\n    type: 'discrete',\n    visible: enable,\n    maxCol: Math.max(1, maxSize),\n    maxRow: Math.max(1, maxSize),\n    autoPage: true,\n    orient,\n    position: legendPosition,\n    item: {\n      focus: true,\n      maxWidth: '30%',\n      focusIconStyle: {\n        size: labelFontSize + 2,\n        fill: labelTextColor,\n        fontWeight: labelFontWeight,\n      },\n      shape: {\n        space: border ? 6 : 4,\n        style: (item) => {\n          return {\n            symbolType: shapeType,\n            size: border ? 8 : 10,\n            fillOpacity: 1,\n            opacity: 1,\n            stroke: false,\n            outerBorder: border\n              ? {\n                  stroke: item.shape.fill,\n                  distance: 3,\n                  lineWidth: 1,\n                }\n              : null,\n          }\n        },\n        state: {\n          unSelected: {\n            opacity: 0.2,\n            fillOpacity: 1, // 覆盖 vchart 里的默认值\n          },\n        },\n      },\n      label: {\n        formatMethod: (value) => {\n          return unfoldInfo.colorIdMap[String(value)]?.alias ?? value\n        },\n        style: {\n          fontSize: labelFontSize,\n          fill: labelColor || labelFontColor,\n          fontWeight: labelFontWeight,\n        },\n        state: {\n          unSelected: {\n            fill: labelColor || labelFontColor, // 覆盖vchart里面的默认值\n            fillOpacity: 0.8, // 覆盖 vchart 里的默认值\n          },\n        },\n      },\n      background: {\n        state: {\n          selectedHover: {\n            fill: labelColor || labelFontColor,\n            fillOpacity: 0.05,\n          },\n          unSelectedHover: {\n            fill: null,\n          },\n        },\n      },\n    },\n    pager: {\n      textStyle: {\n        fill: labelTextColor,\n      },\n      handler: {\n        style: {\n          fill: pagerIconColor,\n        },\n        state: {\n          disable: {\n            fill: pagerIconDisableColor,\n          },\n        },\n      },\n    },\n    padding: 0,\n  }\n  return result\n}\n"],"names":["discreteLegend","spec","context","result","advancedVSeed","datasetReshapeInfo","chartType","unfoldInfo","baseConfig","legend","enable","position","labelFontColor","labelColor","labelFontSize","pagerIconColor","pagerIconDisableColor","labelFontWeight","maxSize","border","shapeType","orient","legendPosition","labelTextColor","Math","item","value","String"],"mappings":"AAEO,MAAMA,iBAAiC,CAACC,MAAMC;IACnD,MAAMC,SAAS;QAAE,GAAGF,IAAI;IAAC;IACzB,MAAM,EAAEG,aAAa,EAAE,GAAGF;IAC1B,MAAM,EAAEG,kBAAkB,EAAEC,SAAS,EAAE,GAAGF;IAC1C,MAAM,EAAEG,UAAU,EAAE,GAAGF,kBAAkB,CAAC,EAAE;IAC5C,MAAMG,aAAaJ,cAAc,MAAM,CAACE,UAAU;IAClD,IAAI,CAACE,cAAc,CAACA,WAAW,MAAM,EACnC,OAAOL;IAGT,MAAM,EAAEM,MAAM,EAAE,GAAGD;IACnB,MAAM,EACJE,MAAM,EACNC,WAAW,QAAQ,EACnBC,cAAc,EACdC,UAAU,EACVC,gBAAgB,EAAE,EAClBC,cAAc,EACdC,qBAAqB,EACrBC,eAAe,EACfC,UAAU,CAAC,EACXC,MAAM,EACNC,YAAY,WAAW,EACxB,GAAGX,UAAU,CAAC;IAEf,MAAMY,SAAS;QAAC;QAAU;QAAc;QAAe;QAAM;KAAK,CAAC,QAAQ,CAACV,YACxE,WACA;QAAC;QAAO;QAAW;QAAY;QAAM;KAAK,CAAC,QAAQ,CAACA,YAClD,QACA;QAAC;QAAQ;QAAW;QAAc;QAAM;KAAK,CAAC,QAAQ,CAACA,YACrD,SACA;IAER,MAAMW,iBAAiB;QAAC;QAAW;QAAc;QAAW;QAAY;QAAM;QAAM;QAAM;KAAK,CAAC,QAAQ,CAACX,YACrG,UACA;QAAC;QAAY;QAAe;QAAc;QAAe;QAAM;QAAM;QAAM;KAAK,CAAC,QAAQ,CAACA,YACxF,QACA;IACN,MAAMY,iBAAiBV,cAAcD;IAErCT,OAAO,OAAO,GAAG;QACf,MAAM;QACN,SAASO;QACT,QAAQc,KAAK,GAAG,CAAC,GAAGN;QACpB,QAAQM,KAAK,GAAG,CAAC,GAAGN;QACpB,UAAU;QACVG;QACA,UAAUC;QACV,MAAM;YACJ,OAAO;YACP,UAAU;YACV,gBAAgB;gBACd,MAAMR,gBAAgB;gBACtB,MAAMS;gBACN,YAAYN;YACd;YACA,OAAO;gBACL,OAAOE,SAAS,IAAI;gBACpB,OAAO,CAACM,OACC;wBACL,YAAYL;wBACZ,MAAMD,SAAS,IAAI;wBACnB,aAAa;wBACb,SAAS;wBACT,QAAQ;wBACR,aAAaA,SACT;4BACE,QAAQM,KAAK,KAAK,CAAC,IAAI;4BACvB,UAAU;4BACV,WAAW;wBACb,IACA;oBACN;gBAEF,OAAO;oBACL,YAAY;wBACV,SAAS;wBACT,aAAa;oBACf;gBACF;YACF;YACA,OAAO;gBACL,cAAc,CAACC,QACNnB,WAAW,UAAU,CAACoB,OAAOD,OAAO,EAAE,SAASA;gBAExD,OAAO;oBACL,UAAUZ;oBACV,MAAMD,cAAcD;oBACpB,YAAYK;gBACd;gBACA,OAAO;oBACL,YAAY;wBACV,MAAMJ,cAAcD;wBACpB,aAAa;oBACf;gBACF;YACF;YACA,YAAY;gBACV,OAAO;oBACL,eAAe;wBACb,MAAMC,cAAcD;wBACpB,aAAa;oBACf;oBACA,iBAAiB;wBACf,MAAM;oBACR;gBACF;YACF;QACF;QACA,OAAO;YACL,WAAW;gBACT,MAAMW;YACR;YACA,SAAS;gBACP,OAAO;oBACL,MAAMR;gBACR;gBACA,OAAO;oBACL,SAAS;wBACP,MAAMC;oBACR;gBACF;YACF;QACF;QACA,SAAS;IACX;IACA,OAAOb;AACT"}