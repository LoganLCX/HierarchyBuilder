{"version":3,"file":"pipeline/spec/chart/pipes/markStyle/areaStyle.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/markStyle/areaStyle.ts"],"sourcesContent":["import type { IAreaChartSpec } from '@visactor/vchart'\nimport { selector } from '../../../../../dataSelector'\nimport type { AreaStyle, Datum, LineStyle, VChartSpecPipe } from 'src/types'\nimport { groupBy, isEmpty, isNullish } from 'remeda'\nimport { getCurveTension, getCurveType } from './curve'\n\nexport const areaStyle: VChartSpecPipe = (spec, context) => {\n  const { advancedVSeed } = context\n  const { markStyle, datasetReshapeInfo, dataset } = advancedVSeed\n  const { areaStyle, lineStyle } = markStyle\n  const { unfoldInfo } = datasetReshapeInfo[0]\n  const result = {\n    ...spec,\n    area: {\n      visible: true,\n      style: {},\n    },\n  } as IAreaChartSpec\n\n  if (isNullish(areaStyle) || isEmpty(areaStyle)) {\n    return result\n  }\n\n  const areaStyles = (Array.isArray(areaStyle) ? areaStyle : [areaStyle]) as AreaStyle[]\n  const lineStyles = (Array.isArray(lineStyle) ? lineStyle : [lineStyle]) as LineStyle[]\n\n  const group = unfoldInfo.encodingColorId\n\n  const areaGroups = groupBy(dataset, (d) => d[group ?? ''] as string)\n\n  const customMap = areaStyles.reduce<object>((result, style, index) => {\n    const { areaColor, areaColorOpacity, areaVisible = true } = style\n\n    const curveType = getCurveType(context.vseed, lineStyles[index]?.lineSmooth)\n    const curveTension = getCurveTension(context.vseed, lineStyles[index]?.lineSmooth)\n\n    return {\n      ...result,\n      [`custom${index + 1}`]: {\n        // 优先级: 后者覆盖前者\n        level: index + 1,\n        filter: (datum: Datum) => {\n          const lineData = areaGroups[datum[group ?? ''] as string]\n          for (const d of lineData) {\n            if (selector(d, style.selector)) {\n              return true\n            }\n          }\n          return false\n        },\n        style: {\n          curveType,\n          curveTension,\n          visible: areaVisible,\n          fill: areaColor,\n          fillOpacity: areaColorOpacity,\n        },\n      },\n    }\n  }, {})\n\n  return {\n    ...result,\n    area: {\n      ...result.area,\n      visible: true,\n      state: {\n        ...customMap,\n      },\n    },\n  }\n}\n"],"names":["areaStyle","spec","context","advancedVSeed","markStyle","datasetReshapeInfo","dataset","lineStyle","unfoldInfo","result","isNullish","isEmpty","areaStyles","Array","lineStyles","group","areaGroups","groupBy","d","customMap","style","index","areaColor","areaColorOpacity","areaVisible","curveType","getCurveType","curveTension","getCurveTension","datum","lineData","selector"],"mappings":";;;AAMO,MAAMA,sBAA4B,CAACC,MAAMC;IAC9C,MAAM,EAAEC,aAAa,EAAE,GAAGD;IAC1B,MAAM,EAAEE,SAAS,EAAEC,kBAAkB,EAAEC,OAAO,EAAE,GAAGH;IACnD,MAAM,EAAEH,SAAS,EAAEO,SAAS,EAAE,GAAGH;IACjC,MAAM,EAAEI,UAAU,EAAE,GAAGH,kBAAkB,CAAC,EAAE;IAC5C,MAAMI,SAAS;QACb,GAAGR,IAAI;QACP,MAAM;YACJ,SAAS;YACT,OAAO,CAAC;QACV;IACF;IAEA,IAAIS,UAAUV,cAAcW,QAAQX,YAClC,OAAOS;IAGT,MAAMG,aAAcC,MAAM,OAAO,CAACb,aAAaA,YAAY;QAACA;KAAU;IACtE,MAAMc,aAAcD,MAAM,OAAO,CAACN,aAAaA,YAAY;QAACA;KAAU;IAEtE,MAAMQ,QAAQP,WAAW,eAAe;IAExC,MAAMQ,aAAaC,QAAQX,SAAS,CAACY,IAAMA,CAAC,CAACH,SAAS,GAAG;IAEzD,MAAMI,YAAYP,WAAW,MAAM,CAAS,CAACH,QAAQW,OAAOC;QAC1D,MAAM,EAAEC,SAAS,EAAEC,gBAAgB,EAAEC,cAAc,IAAI,EAAE,GAAGJ;QAE5D,MAAMK,YAAYC,aAAaxB,QAAQ,KAAK,EAAEY,UAAU,CAACO,MAAM,EAAE;QACjE,MAAMM,eAAeC,gBAAgB1B,QAAQ,KAAK,EAAEY,UAAU,CAACO,MAAM,EAAE;QAEvE,OAAO;YACL,GAAGZ,MAAM;YACT,CAAC,CAAC,MAAM,EAAEY,QAAQ,GAAG,CAAC,EAAE;gBAEtB,OAAOA,QAAQ;gBACf,QAAQ,CAACQ;oBACP,MAAMC,WAAWd,UAAU,CAACa,KAAK,CAACd,SAAS,GAAG,CAAW;oBACzD,KAAK,MAAMG,KAAKY,SACd,IAAIC,SAASb,GAAGE,MAAM,QAAQ,GAC5B,OAAO;oBAGX,OAAO;gBACT;gBACA,OAAO;oBACLK;oBACAE;oBACA,SAASH;oBACT,MAAMF;oBACN,aAAaC;gBACf;YACF;QACF;IACF,GAAG,CAAC;IAEJ,OAAO;QACL,GAAGd,MAAM;QACT,MAAM;YACJ,GAAGA,OAAO,IAAI;YACd,SAAS;YACT,OAAO;gBACL,GAAGU,SAAS;YACd;QACF;IACF;AACF"}