{"version":3,"file":"pipeline/spec/chart/pipes/axes/xLinear.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/axes/xLinear.ts"],"sourcesContent":["import type { ISpec } from '@visactor/vchart'\nimport type { VChartSpecPipe, XLinearAxis } from 'src/types'\nimport {\n  AXIS_LABEL_SPACE,\n  createNumFormatter,\n  isAreaPercent,\n  isBarPercent,\n  isColumnPercent,\n  isPivotChart,\n  LINEAR_AXIS_INNER_OFFSET_TOP,\n} from 'src/pipeline/utils'\nimport { createLinearFormat, createLinearPercentFormat } from './format/linearFormat'\nimport { defaultTitleText } from './title/defaultTitleText'\n\nexport const xLinear: VChartSpecPipe = (spec, context) => {\n  const result = { ...spec } as ISpec\n  const { advancedVSeed, vseed } = context\n  const { encoding, dimensions, measures } = advancedVSeed\n  const { chartType } = vseed\n  const config = (advancedVSeed.config?.[chartType as 'bar']?.xAxis ?? {}) as XLinearAxis\n\n  if (!result.axes) {\n    result.axes = []\n  }\n  const isPivot = isPivotChart(vseed)\n\n  const {\n    visible = true,\n    label,\n    tick,\n    title,\n    grid,\n    line,\n\n    zero,\n    nice,\n    inverse,\n    max,\n    min,\n    log,\n    logBase = 10,\n    autoFormat,\n    numFormat = {},\n  } = config\n\n  const formatter = createNumFormatter(numFormat)\n  const percentFormatter = createNumFormatter({\n    type: 'percent',\n  })\n\n  const linearAxis = {\n    ...(isPivot\n      ? {\n          range: {\n            min,\n            max,\n          },\n        }\n      : {\n          min,\n          max,\n        }),\n    visible,\n    type: log ? 'log' : 'linear',\n    base: logBase,\n    orient: 'bottom',\n    nice,\n    zero: log ? false : zero,\n    inverse,\n    label: {\n      space: AXIS_LABEL_SPACE,\n      visible: label?.visible,\n      formatMethod: (value: string) => {\n        if (isBarPercent(vseed) || isColumnPercent(vseed) || isAreaPercent(vseed)) {\n          return createLinearPercentFormat(value, autoFormat, numFormat, formatter, percentFormatter)\n        }\n        return createLinearFormat(value, autoFormat, numFormat, formatter)\n      },\n      style: {\n        fill: label?.labelColor,\n        angle: label?.labelAngle,\n        fontSize: label?.labelFontSize,\n        fontWeight: label?.labelFontWeight,\n      },\n    },\n    title: {\n      visible: title?.visible,\n      text: title?.titleText || defaultTitleText(measures, dimensions, encoding.x as string[]),\n      style: {\n        fill: title?.titleColor,\n        fontSize: title?.titleFontSize,\n        fontWeight: title?.titleFontWeight,\n      },\n    },\n    tick: {\n      visible: tick?.visible,\n      tickSize: tick?.tickSize,\n      inside: tick?.tickInside,\n      style: {\n        stroke: tick?.tickColor,\n      },\n    },\n    grid: {\n      visible: grid?.visible,\n      style: {\n        lineWidth: grid?.gridWidth,\n        stroke: grid?.gridColor,\n        lineDash: grid?.gridLineDash,\n      },\n    },\n    domainLine: {\n      visible: line?.visible,\n      style: {\n        lineWidth: line?.lineWidth,\n        stroke: line?.lineColor,\n      },\n    },\n    innerOffset: {\n      right: LINEAR_AXIS_INNER_OFFSET_TOP,\n      // left: LINEAR_AXIS_INNER_OFFSET_TOP,\n    },\n  }\n\n  result.axes = [...result.axes, linearAxis] as ISpec['axes']\n\n  return result\n}\n"],"names":["xLinear","spec","context","result","advancedVSeed","vseed","encoding","dimensions","measures","chartType","config","isPivot","isPivotChart","visible","label","tick","title","grid","line","zero","nice","inverse","max","min","log","logBase","autoFormat","numFormat","formatter","createNumFormatter","percentFormatter","linearAxis","AXIS_LABEL_SPACE","value","isBarPercent","isColumnPercent","isAreaPercent","createLinearPercentFormat","createLinearFormat","defaultTitleText","LINEAR_AXIS_INNER_OFFSET_TOP"],"mappings":";;;AAcO,MAAMA,UAA0B,CAACC,MAAMC;IAC5C,MAAMC,SAAS;QAAE,GAAGF,IAAI;IAAC;IACzB,MAAM,EAAEG,aAAa,EAAEC,KAAK,EAAE,GAAGH;IACjC,MAAM,EAAEI,QAAQ,EAAEC,UAAU,EAAEC,QAAQ,EAAE,GAAGJ;IAC3C,MAAM,EAAEK,SAAS,EAAE,GAAGJ;IACtB,MAAMK,SAAUN,cAAc,MAAM,EAAE,CAACK,UAAmB,EAAE,SAAS,CAAC;IAEtE,IAAI,CAACN,OAAO,IAAI,EACdA,OAAO,IAAI,GAAG,EAAE;IAElB,MAAMQ,UAAUC,aAAaP;IAE7B,MAAM,EACJQ,UAAU,IAAI,EACdC,KAAK,EACLC,IAAI,EACJC,KAAK,EACLC,IAAI,EACJC,IAAI,EAEJC,IAAI,EACJC,IAAI,EACJC,OAAO,EACPC,GAAG,EACHC,GAAG,EACHC,GAAG,EACHC,UAAU,EAAE,EACZC,UAAU,EACVC,YAAY,CAAC,CAAC,EACf,GAAGjB;IAEJ,MAAMkB,YAAYC,mBAAmBF;IACrC,MAAMG,mBAAmBD,mBAAmB;QAC1C,MAAM;IACR;IAEA,MAAME,aAAa;QACjB,GAAIpB,UACA;YACE,OAAO;gBACLY;gBACAD;YACF;QACF,IACA;YACEC;YACAD;QACF,CAAC;QACLT;QACA,MAAMW,MAAM,QAAQ;QACpB,MAAMC;QACN,QAAQ;QACRL;QACA,MAAMI,MAAM,QAAQL;QACpBE;QACA,OAAO;YACL,OAAOW;YACP,SAASlB,OAAO;YAChB,cAAc,CAACmB;gBACb,IAAIC,aAAa7B,UAAU8B,gBAAgB9B,UAAU+B,cAAc/B,QACjE,OAAOgC,0BAA0BJ,OAAOP,YAAYC,WAAWC,WAAWE;gBAE5E,OAAOQ,mBAAmBL,OAAOP,YAAYC,WAAWC;YAC1D;YACA,OAAO;gBACL,MAAMd,OAAO;gBACb,OAAOA,OAAO;gBACd,UAAUA,OAAO;gBACjB,YAAYA,OAAO;YACrB;QACF;QACA,OAAO;YACL,SAASE,OAAO;YAChB,MAAMA,OAAO,aAAauB,iBAAiB/B,UAAUD,YAAYD,SAAS,CAAC;YAC3E,OAAO;gBACL,MAAMU,OAAO;gBACb,UAAUA,OAAO;gBACjB,YAAYA,OAAO;YACrB;QACF;QACA,MAAM;YACJ,SAASD,MAAM;YACf,UAAUA,MAAM;YAChB,QAAQA,MAAM;YACd,OAAO;gBACL,QAAQA,MAAM;YAChB;QACF;QACA,MAAM;YACJ,SAASE,MAAM;YACf,OAAO;gBACL,WAAWA,MAAM;gBACjB,QAAQA,MAAM;gBACd,UAAUA,MAAM;YAClB;QACF;QACA,YAAY;YACV,SAASC,MAAM;YACf,OAAO;gBACL,WAAWA,MAAM;gBACjB,QAAQA,MAAM;YAChB;QACF;QACA,aAAa;YACX,OAAOsB;QAET;IACF;IAEArC,OAAO,IAAI,GAAG;WAAIA,OAAO,IAAI;QAAE4B;KAAW;IAE1C,OAAO5B;AACT"}