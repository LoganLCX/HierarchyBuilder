{"version":3,"file":"pipeline/spec/chart/pipes/axes/xBand.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/axes/xBand.ts"],"sourcesContent":["import type { ICartesianBandAxisSpec, ISpec } from '@visactor/vchart'\nimport type { VChartSpecPipe, XBandAxis } from 'src/types'\nimport { defaultTitleText } from './title/defaultTitleText'\nimport { AXIS_LABEL_SPACE } from 'src/pipeline/utils'\nimport { MeasureId } from 'src/dataReshape'\nimport { isArray } from '@visactor/vutils'\n\nexport const xBand: VChartSpecPipe = (spec, context) => {\n  const result = { ...spec } as ISpec\n  const { advancedVSeed, vseed } = context\n  const { chartType } = vseed\n  const { measures, dimensions, encoding, datasetReshapeInfo, pivotAllDatasetReshapeInfo } = advancedVSeed\n  const config = (advancedVSeed.config?.[chartType as 'column']?.xAxis ?? {}) as XBandAxis\n\n  if (!result.axes) {\n    result.axes = []\n  }\n\n  const {\n    visible = true,\n    label,\n    tick,\n    title,\n    grid,\n    line,\n    labelAutoHide,\n    labelAutoHideGap,\n    labelAutoLimit,\n    labelAutoLimitLength = 80,\n    labelAutoRotate,\n    labelAutoRotateAngleRange,\n  } = config\n\n  const sampling = !(labelAutoHide || labelAutoRotate || labelAutoLimit)\n  const onlyMeasureId = (encoding.x || []).filter((v) => v !== MeasureId).length === 0\n\n  const bandAxis = {\n    visible,\n    type: 'band',\n    orient: 'bottom',\n    maxHeight: labelAutoLimitLength + 60,\n    sampling,\n    hover: true,\n    label: {\n      visible: label?.visible,\n      flush: true,\n      space: AXIS_LABEL_SPACE,\n      style: {\n        maxLineWidth: labelAutoLimitLength,\n        fill: label?.labelColor,\n        angle: label?.labelAngle,\n        fontSize: label?.labelFontSize,\n        fontWeight: label?.labelFontWeight,\n      },\n\n      // 防重叠相关\n      minGap: labelAutoHideGap,\n      autoHide: labelAutoHide,\n      autoHideMethod: 'greedy',\n      autoHideSeparation: labelAutoHideGap,\n      autoLimit: labelAutoLimit,\n      autoRotate: labelAutoRotate,\n      autoRotateAngle: labelAutoRotateAngleRange,\n      lastVisible: true,\n    },\n    title: {\n      visible: title?.visible,\n      text: title?.titleText || defaultTitleText(measures, dimensions, encoding.x as string[]),\n      style: {\n        fill: title?.titleColor,\n        fontSize: title?.titleFontSize,\n        fontWeight: title?.titleFontWeight,\n      },\n    },\n    tick: {\n      visible: tick?.visible,\n      tickSize: tick?.tickSize,\n      inside: tick?.tickInside,\n      style: {\n        stroke: tick?.tickColor,\n      },\n    },\n    grid: {\n      visible: grid?.visible,\n      style: {\n        lineWidth: grid?.gridWidth,\n        stroke: grid?.gridColor,\n        lineDash: grid?.gridLineDash,\n      },\n    },\n    domainLine: {\n      visible: line?.visible,\n      style: {\n        lineWidth: line?.lineWidth,\n        stroke: line?.lineColor,\n      },\n    },\n    paddingInner: [0.15, 0.1],\n    paddingOuter: [0.075, 0.1],\n  } as ICartesianBandAxisSpec\n  if (onlyMeasureId && bandAxis.label) {\n    const allDatasetReshapeInfo = pivotAllDatasetReshapeInfo || datasetReshapeInfo\n    const colorIdMap = allDatasetReshapeInfo.reduce<Record<string, { id: string; alias: string }>>((prev, cur) => {\n      return { ...prev, ...cur.unfoldInfo.colorIdMap }\n    }, {})\n\n    bandAxis.label.formatMethod = (text: string | string[]) => {\n      return isArray(text) ? text : (colorIdMap[String(text)]?.alias ?? text)\n    }\n  }\n\n  result.axes = [...result.axes, bandAxis] as ISpec['axes']\n  return result\n}\n"],"names":["xBand","spec","context","result","advancedVSeed","vseed","chartType","measures","dimensions","encoding","datasetReshapeInfo","pivotAllDatasetReshapeInfo","config","visible","label","tick","title","grid","line","labelAutoHide","labelAutoHideGap","labelAutoLimit","labelAutoLimitLength","labelAutoRotate","labelAutoRotateAngleRange","sampling","onlyMeasureId","v","MeasureId","bandAxis","AXIS_LABEL_SPACE","defaultTitleText","allDatasetReshapeInfo","colorIdMap","prev","cur","text","isArray","String"],"mappings":";;;;AAOO,MAAMA,QAAwB,CAACC,MAAMC;IAC1C,MAAMC,SAAS;QAAE,GAAGF,IAAI;IAAC;IACzB,MAAM,EAAEG,aAAa,EAAEC,KAAK,EAAE,GAAGH;IACjC,MAAM,EAAEI,SAAS,EAAE,GAAGD;IACtB,MAAM,EAAEE,QAAQ,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,kBAAkB,EAAEC,0BAA0B,EAAE,GAAGP;IAC3F,MAAMQ,SAAUR,cAAc,MAAM,EAAE,CAACE,UAAsB,EAAE,SAAS,CAAC;IAEzE,IAAI,CAACH,OAAO,IAAI,EACdA,OAAO,IAAI,GAAG,EAAE;IAGlB,MAAM,EACJU,UAAU,IAAI,EACdC,KAAK,EACLC,IAAI,EACJC,KAAK,EACLC,IAAI,EACJC,IAAI,EACJC,aAAa,EACbC,gBAAgB,EAChBC,cAAc,EACdC,uBAAuB,EAAE,EACzBC,eAAe,EACfC,yBAAyB,EAC1B,GAAGZ;IAEJ,MAAMa,WAAW,CAAEN,CAAAA,iBAAiBI,mBAAmBF,cAAa;IACpE,MAAMK,gBAAiBjB,AAA4D,MAA5DA,AAAAA,CAAAA,SAAS,CAAC,IAAI,EAAC,EAAG,MAAM,CAAC,CAACkB,IAAMA,MAAMC,WAAW,MAAM;IAE9E,MAAMC,WAAW;QACfhB;QACA,MAAM;QACN,QAAQ;QACR,WAAWS,uBAAuB;QAClCG;QACA,OAAO;QACP,OAAO;YACL,SAASX,OAAO;YAChB,OAAO;YACP,OAAOgB;YACP,OAAO;gBACL,cAAcR;gBACd,MAAMR,OAAO;gBACb,OAAOA,OAAO;gBACd,UAAUA,OAAO;gBACjB,YAAYA,OAAO;YACrB;YAGA,QAAQM;YACR,UAAUD;YACV,gBAAgB;YAChB,oBAAoBC;YACpB,WAAWC;YACX,YAAYE;YACZ,iBAAiBC;YACjB,aAAa;QACf;QACA,OAAO;YACL,SAASR,OAAO;YAChB,MAAMA,OAAO,aAAae,iBAAiBxB,UAAUC,YAAYC,SAAS,CAAC;YAC3E,OAAO;gBACL,MAAMO,OAAO;gBACb,UAAUA,OAAO;gBACjB,YAAYA,OAAO;YACrB;QACF;QACA,MAAM;YACJ,SAASD,MAAM;YACf,UAAUA,MAAM;YAChB,QAAQA,MAAM;YACd,OAAO;gBACL,QAAQA,MAAM;YAChB;QACF;QACA,MAAM;YACJ,SAASE,MAAM;YACf,OAAO;gBACL,WAAWA,MAAM;gBACjB,QAAQA,MAAM;gBACd,UAAUA,MAAM;YAClB;QACF;QACA,YAAY;YACV,SAASC,MAAM;YACf,OAAO;gBACL,WAAWA,MAAM;gBACjB,QAAQA,MAAM;YAChB;QACF;QACA,cAAc;YAAC;YAAM;SAAI;QACzB,cAAc;YAAC;YAAO;SAAI;IAC5B;IACA,IAAIQ,iBAAiBG,SAAS,KAAK,EAAE;QACnC,MAAMG,wBAAwBrB,8BAA8BD;QAC5D,MAAMuB,aAAaD,sBAAsB,MAAM,CAAgD,CAACE,MAAMC,MAC7F;gBAAE,GAAGD,IAAI;gBAAE,GAAGC,IAAI,UAAU,CAAC,UAAU;YAAC,IAC9C,CAAC;QAEJN,SAAS,KAAK,CAAC,YAAY,GAAG,CAACO,OACtBC,QAAQD,QAAQA,OAAQH,UAAU,CAACK,OAAOF,MAAM,EAAE,SAASA;IAEtE;IAEAjC,OAAO,IAAI,GAAG;WAAIA,OAAO,IAAI;QAAE0B;KAAS;IACxC,OAAO1B;AACT"}