{"version":3,"file":"pipeline/spec/chart/pipes/markStyle/barStyle.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/markStyle/barStyle.ts"],"sourcesContent":["import type { IBarChartSpec } from '@visactor/vchart'\nimport { selector } from '../../../../../dataSelector'\nimport type { BarStyle, Datum, VChartSpecPipe } from 'src/types'\nimport { isEmpty, isNullish } from 'remeda'\n\nexport const barStyle: VChartSpecPipe = (spec, context) => {\n  const { advancedVSeed } = context\n  const { markStyle, dataset = [] } = advancedVSeed\n  const { barStyle } = markStyle\n\n  const showStroke = dataset.length <= 100\n\n  const result = {\n    ...spec,\n    bar: {\n      style: {\n        visible: true,\n        fillOpacity: 1,\n        lineWidth: showStroke ? 1 : 0,\n      },\n      state: {\n        hover: {\n          fillOpacity: 0.6,\n        },\n      },\n    },\n  } as IBarChartSpec\n\n  if (isNullish(barStyle) || isEmpty(barStyle)) {\n    return result\n  }\n\n  const barStyles = (Array.isArray(barStyle) ? barStyle : [barStyle]) as BarStyle[]\n\n  const customMap = barStyles.reduce<object>((result, style, index) => {\n    const {\n      barBorderColor,\n      barBorderStyle,\n      barBorderWidth = 1,\n      barColor,\n      barColorOpacity,\n      barBorderOpacity,\n      barRadius,\n      barVisible = true,\n    } = style\n\n    const lineDash = barBorderStyle === 'dashed' ? [5, 2] : barBorderStyle === 'dotted' ? [2, 5] : [0, 0]\n    return {\n      ...result,\n      [`custom${index + 1}`]: {\n        // 优先级: 后者覆盖前者\n        level: index + 1,\n        filter: (datum: Datum) => {\n          if (selector(datum, style.selector)) {\n            return true\n          }\n          return false\n        },\n        style: {\n          visible: barVisible,\n          fill: barColor,\n          fillOpacity: barColorOpacity,\n          cornerRadius: barRadius,\n          lineWidth: barBorderWidth,\n          stroke: barBorderColor,\n          strokeOpacity: barBorderOpacity,\n          lineDash: lineDash,\n        },\n      },\n    }\n  }, {})\n\n  result.bar!.state = {\n    ...result.bar!.state,\n    ...customMap,\n  }\n\n  return result\n}\n"],"names":["barStyle","spec","context","advancedVSeed","markStyle","dataset","showStroke","result","isNullish","isEmpty","barStyles","Array","customMap","style","index","barBorderColor","barBorderStyle","barBorderWidth","barColor","barColorOpacity","barBorderOpacity","barRadius","barVisible","lineDash","datum","selector"],"mappings":";;AAKO,MAAMA,oBAA2B,CAACC,MAAMC;IAC7C,MAAM,EAAEC,aAAa,EAAE,GAAGD;IAC1B,MAAM,EAAEE,SAAS,EAAEC,UAAU,EAAE,EAAE,GAAGF;IACpC,MAAM,EAAEH,QAAQ,EAAE,GAAGI;IAErB,MAAME,aAAaD,QAAQ,MAAM,IAAI;IAErC,MAAME,SAAS;QACb,GAAGN,IAAI;QACP,KAAK;YACH,OAAO;gBACL,SAAS;gBACT,aAAa;gBACb,WAAWK,aAAa,IAAI;YAC9B;YACA,OAAO;gBACL,OAAO;oBACL,aAAa;gBACf;YACF;QACF;IACF;IAEA,IAAIE,UAAUR,aAAaS,QAAQT,WACjC,OAAOO;IAGT,MAAMG,YAAaC,MAAM,OAAO,CAACX,YAAYA,WAAW;QAACA;KAAS;IAElE,MAAMY,YAAYF,UAAU,MAAM,CAAS,CAACH,QAAQM,OAAOC;QACzD,MAAM,EACJC,cAAc,EACdC,cAAc,EACdC,iBAAiB,CAAC,EAClBC,QAAQ,EACRC,eAAe,EACfC,gBAAgB,EAChBC,SAAS,EACTC,aAAa,IAAI,EAClB,GAAGT;QAEJ,MAAMU,WAAWP,AAAmB,aAAnBA,iBAA8B;YAAC;YAAG;SAAE,GAAGA,AAAmB,aAAnBA,iBAA8B;YAAC;YAAG;SAAE,GAAG;YAAC;YAAG;SAAE;QACrG,OAAO;YACL,GAAGT,MAAM;YACT,CAAC,CAAC,MAAM,EAAEO,QAAQ,GAAG,CAAC,EAAE;gBAEtB,OAAOA,QAAQ;gBACf,QAAQ,CAACU;oBACP,IAAIC,SAASD,OAAOX,MAAM,QAAQ,GAChC,OAAO;oBAET,OAAO;gBACT;gBACA,OAAO;oBACL,SAASS;oBACT,MAAMJ;oBACN,aAAaC;oBACb,cAAcE;oBACd,WAAWJ;oBACX,QAAQF;oBACR,eAAeK;oBACf,UAAUG;gBACZ;YACF;QACF;IACF,GAAG,CAAC;IAEJhB,OAAO,GAAG,CAAE,KAAK,GAAG;QAClB,GAAGA,OAAO,GAAG,CAAE,KAAK;QACpB,GAAGK,SAAS;IACd;IAEA,OAAOL;AACT"}