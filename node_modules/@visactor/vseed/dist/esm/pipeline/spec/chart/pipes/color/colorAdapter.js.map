{"version":3,"file":"pipeline/spec/chart/pipes/color/colorAdapter.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/color/colorAdapter.ts"],"sourcesContent":["import { findAllMeasures } from 'src/pipeline/utils'\nimport type { AdvancedVSeed, PivotChartSpecPipe, VChartSpecPipe, VSeed, Pipe, SpecPipelineContext } from 'src/types'\n\nexport function colorAdapter(ordinalPipe: PivotChartSpecPipe, linearPipe: PivotChartSpecPipe): PivotChartSpecPipe\nexport function colorAdapter(ordinalPipe: VChartSpecPipe, linearPipe: VChartSpecPipe): VChartSpecPipe\nexport function colorAdapter<TSpec>(\n  ordinalPipe: Pipe<TSpec, SpecPipelineContext>,\n  linearPipe: Pipe<TSpec, SpecPipelineContext>,\n) {\n  return (spec: Partial<TSpec>, context: SpecPipelineContext) => {\n    const { advancedVSeed, vseed } = context\n    if (isLinearColor(advancedVSeed, vseed)) {\n      return linearPipe(spec, context)\n    }\n    return ordinalPipe(spec, context)\n  }\n}\n\nexport const isLinearColor = <T extends AdvancedVSeed, U extends VSeed>(advancedVSeed: T, vseed: U) => {\n  const { encoding } = advancedVSeed\n  const measures = vseed.measures || advancedVSeed.measures\n  const measureIdList = findAllMeasures(measures).map((measure) => measure.id)\n  const { color } = encoding\n  return color?.length === 1 && measureIdList.includes(color[0])\n}\n\nexport const getColorMeasureId = <T extends AdvancedVSeed, U extends VSeed>(\n  advancedVSeed: T,\n  vseed: U,\n): string | undefined => {\n  if (isLinearColor(advancedVSeed, vseed)) {\n    const { encoding } = advancedVSeed\n    const { color } = encoding\n    return color?.[0]\n  }\n  return undefined\n}\n"],"names":["colorAdapter","ordinalPipe","linearPipe","spec","context","advancedVSeed","vseed","isLinearColor","encoding","measures","measureIdList","findAllMeasures","measure","color","getColorMeasureId"],"mappings":";AAKO,SAASA,aACdC,WAA6C,EAC7CC,UAA4C;IAE5C,OAAO,CAACC,MAAsBC;QAC5B,MAAM,EAAEC,aAAa,EAAEC,KAAK,EAAE,GAAGF;QACjC,IAAIG,cAAcF,eAAeC,QAC/B,OAAOJ,WAAWC,MAAMC;QAE1B,OAAOH,YAAYE,MAAMC;IAC3B;AACF;AAEO,MAAMG,gBAAgB,CAA2CF,eAAkBC;IACxF,MAAM,EAAEE,QAAQ,EAAE,GAAGH;IACrB,MAAMI,WAAWH,MAAM,QAAQ,IAAID,cAAc,QAAQ;IACzD,MAAMK,gBAAgBC,gBAAgBF,UAAU,GAAG,CAAC,CAACG,UAAYA,QAAQ,EAAE;IAC3E,MAAM,EAAEC,KAAK,EAAE,GAAGL;IAClB,OAAOK,OAAO,WAAW,KAAKH,cAAc,QAAQ,CAACG,KAAK,CAAC,EAAE;AAC/D;AAEO,MAAMC,oBAAoB,CAC/BT,eACAC;IAEA,IAAIC,cAAcF,eAAeC,QAAQ;QACvC,MAAM,EAAEE,QAAQ,EAAE,GAAGH;QACrB,MAAM,EAAEQ,KAAK,EAAE,GAAGL;QAClB,OAAOK,OAAO,CAAC,EAAE;IACnB;AAEF"}