{"version":3,"file":"pipeline/spec/chart/pipes/axes/yLinearSecondary.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/axes/yLinearSecondary.ts"],"sourcesContent":["import type { ISpec } from '@visactor/vchart'\nimport { AXIS_LABEL_SPACE, LINEAR_AXIS_INNER_OFFSET_TOP } from '../../../../utils/constant'\nimport { createNumFormatter } from '../../../../utils'\nimport type { VChartSpecPipe, YLinearAxis } from 'src/types'\nimport { isEmpty, isNullish } from 'remeda'\nimport { createLinearFormat } from './format/linearFormat'\nimport { defaultTitleText } from './title/defaultTitleText'\n\nexport const yLinearSecondary: VChartSpecPipe = (spec, context) => {\n  const result = { ...spec } as ISpec\n  const { advancedVSeed, vseed } = context\n  const { chartType } = vseed\n  const { datasetReshapeInfo, measures, dimensions, encoding } = advancedVSeed\n  const { index, id: reshapeInfoId, foldInfoList } = datasetReshapeInfo[0]\n  // TODO: default config missing\n  const secondaryYAxis = advancedVSeed.config?.[chartType as 'dualAxis']?.secondaryYAxis as YLinearAxis | YLinearAxis[]\n  const yAxisConfig = Array.isArray(secondaryYAxis) ? secondaryYAxis[index] || secondaryYAxis[0] : secondaryYAxis\n  const alignTicks = advancedVSeed.config?.[chartType as 'dualAxis']?.alignTicks as boolean | boolean[]\n  const alignTicksConfig = Array.isArray(alignTicks) ? alignTicks[index] || alignTicks[0] : alignTicks\n\n  if (isNullish(foldInfoList?.[1])) {\n    return result\n  }\n\n  const isEmptySecondary = isEmpty(foldInfoList?.[1].foldMap)\n  const onlySecondary = isEmpty(foldInfoList?.[0].foldMap) && !isEmptySecondary\n\n  const sync = {\n    axisId: `${reshapeInfoId}-primary-axis`,\n    zeroAlign: true,\n  }\n\n  const id = `${reshapeInfoId}-secondary-axis`\n  const seriesIds = [`${reshapeInfoId}-primary-series`, `${reshapeInfoId}-secondary-series`]\n  const seriesId = alignTicksConfig ? seriesIds : seriesIds[1]\n  if (!result.axes) {\n    result.axes = []\n  }\n\n  const {\n    visible = true,\n    label,\n    tick,\n    title,\n    grid,\n    line,\n\n    zero,\n    nice,\n    inverse,\n    max,\n    min,\n    log,\n    logBase = 10,\n    numFormat = {},\n    autoFormat,\n  } = yAxisConfig ?? {}\n\n  const formatter = createNumFormatter(numFormat)\n\n  const linearAxis = {\n    visible: isEmptySecondary ? false : visible,\n    id,\n    seriesId,\n    sync,\n    type: log ? 'log' : 'linear',\n    base: logBase,\n    orient: 'right',\n    nice,\n    zero: log ? false : zero,\n    inverse,\n    max,\n    min,\n    label: {\n      space: AXIS_LABEL_SPACE,\n      visible: label?.visible,\n      formatMethod: (value: string) => {\n        return createLinearFormat(value, autoFormat, numFormat, formatter)\n      },\n      style: {\n        fill: label?.labelColor,\n        angle: label?.labelAngle,\n        fontSize: label?.labelFontSize,\n        fontWeight: label?.labelFontWeight,\n      },\n    },\n    title: {\n      visible: title?.visible,\n      text: title?.titleText || defaultTitleText(measures, dimensions, encoding.y as string[]),\n      style: {\n        fill: title?.titleColor,\n        fontSize: title?.titleFontSize,\n        fontWeight: title?.titleFontWeight,\n      },\n    },\n    tick: {\n      visible: tick?.visible,\n      tickSize: tick?.tickSize,\n      inside: tick?.tickInside,\n      style: {\n        stroke: tick?.tickColor,\n      },\n    },\n    grid: {\n      visible: onlySecondary ? true : grid?.visible,\n      style: {\n        lineWidth: grid?.gridWidth,\n        stroke: grid?.gridColor,\n        lineDash: grid?.gridLineDash,\n      },\n    },\n    domainLine: {\n      visible: line?.visible,\n      style: {\n        lineWidth: line?.lineWidth,\n        stroke: line?.lineColor,\n      },\n    },\n    innerOffset: {\n      top: LINEAR_AXIS_INNER_OFFSET_TOP,\n      // bottom: LINEAR_AXIS_INNER_OFFSET_TOP,\n    },\n  }\n\n  result.axes = [...result.axes, linearAxis] as ISpec['axes']\n\n  return result\n}\n"],"names":["yLinearSecondary","spec","context","result","advancedVSeed","vseed","chartType","datasetReshapeInfo","measures","dimensions","encoding","index","reshapeInfoId","foldInfoList","secondaryYAxis","yAxisConfig","Array","alignTicks","alignTicksConfig","isNullish","isEmptySecondary","isEmpty","onlySecondary","sync","id","seriesIds","seriesId","visible","label","tick","title","grid","line","zero","nice","inverse","max","min","log","logBase","numFormat","autoFormat","formatter","createNumFormatter","linearAxis","AXIS_LABEL_SPACE","value","createLinearFormat","defaultTitleText","LINEAR_AXIS_INNER_OFFSET_TOP"],"mappings":"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"}