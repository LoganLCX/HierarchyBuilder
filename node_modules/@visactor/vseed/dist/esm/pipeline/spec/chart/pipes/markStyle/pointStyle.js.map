{"version":3,"file":"pipeline/spec/chart/pipes/markStyle/pointStyle.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/markStyle/pointStyle.ts"],"sourcesContent":["import type { IAreaChartSpec } from '@visactor/vchart'\nimport { selector } from '../../../../../dataSelector'\nimport type { Datum, PointStyle, VChartSpecPipe } from 'src/types'\nimport { isEmpty, isNullish } from 'remeda'\n\nexport const pointStyle: VChartSpecPipe = (spec, context) => {\n  const { advancedVSeed } = context\n  const { markStyle } = advancedVSeed\n  const { pointStyle } = markStyle\n  const result = {\n    ...spec,\n    point: {\n      style: {},\n    },\n  } as IAreaChartSpec\n\n  if (isNullish(pointStyle) || isEmpty(pointStyle)) {\n    return result\n  }\n\n  const pointStyles = (Array.isArray(pointStyle) ? pointStyle : [pointStyle]) as PointStyle[]\n\n  const customMap = pointStyles.reduce<object>((result, style, index) => {\n    const {\n      pointBorderColor,\n      pointBorderStyle,\n      pointBorderWidth = 1,\n      pointColor,\n      pointColorOpacity,\n      pointSize,\n      pointVisible = true,\n    } = style\n\n    const lineDash = pointBorderStyle === 'dashed' ? [5, 2] : pointBorderStyle === 'dotted' ? [2, 5] : [0, 0]\n    return {\n      ...result,\n      [`custom${index + 1}`]: {\n        // 优先级: 后者覆盖前者\n        level: index + 1,\n        filter: (datum: Datum) => {\n          if (selector(datum, style.selector)) {\n            return true\n          }\n          return false\n        },\n        style: {\n          visible: pointVisible,\n          size: pointSize,\n          fill: pointColor,\n          fillOpacity: pointColorOpacity,\n          innerBorder: {\n            stroke: pointBorderColor,\n            lineWidth: pointBorderWidth,\n            distance: (pointBorderWidth || 0) / 2,\n            lineDash: lineDash,\n          },\n        },\n      },\n    }\n  }, {})\n\n  return {\n    ...result,\n    point: {\n      ...result.point,\n      state: {\n        ...customMap,\n      },\n    },\n  }\n}\n"],"names":["pointStyle","spec","context","advancedVSeed","markStyle","result","isNullish","isEmpty","pointStyles","Array","customMap","style","index","pointBorderColor","pointBorderStyle","pointBorderWidth","pointColor","pointColorOpacity","pointSize","pointVisible","lineDash","datum","selector"],"mappings":";;AAKO,MAAMA,wBAA6B,CAACC,MAAMC;IAC/C,MAAM,EAAEC,aAAa,EAAE,GAAGD;IAC1B,MAAM,EAAEE,SAAS,EAAE,GAAGD;IACtB,MAAM,EAAEH,UAAU,EAAE,GAAGI;IACvB,MAAMC,SAAS;QACb,GAAGJ,IAAI;QACP,OAAO;YACL,OAAO,CAAC;QACV;IACF;IAEA,IAAIK,UAAUN,eAAeO,QAAQP,aACnC,OAAOK;IAGT,MAAMG,cAAeC,MAAM,OAAO,CAACT,cAAcA,aAAa;QAACA;KAAW;IAE1E,MAAMU,YAAYF,YAAY,MAAM,CAAS,CAACH,QAAQM,OAAOC;QAC3D,MAAM,EACJC,gBAAgB,EAChBC,gBAAgB,EAChBC,mBAAmB,CAAC,EACpBC,UAAU,EACVC,iBAAiB,EACjBC,SAAS,EACTC,eAAe,IAAI,EACpB,GAAGR;QAEJ,MAAMS,WAAWN,AAAqB,aAArBA,mBAAgC;YAAC;YAAG;SAAE,GAAGA,AAAqB,aAArBA,mBAAgC;YAAC;YAAG;SAAE,GAAG;YAAC;YAAG;SAAE;QACzG,OAAO;YACL,GAAGT,MAAM;YACT,CAAC,CAAC,MAAM,EAAEO,QAAQ,GAAG,CAAC,EAAE;gBAEtB,OAAOA,QAAQ;gBACf,QAAQ,CAACS;oBACP,IAAIC,SAASD,OAAOV,MAAM,QAAQ,GAChC,OAAO;oBAET,OAAO;gBACT;gBACA,OAAO;oBACL,SAASQ;oBACT,MAAMD;oBACN,MAAMF;oBACN,aAAaC;oBACb,aAAa;wBACX,QAAQJ;wBACR,WAAWE;wBACX,UAAWA,AAAAA,CAAAA,oBAAoB,KAAK;wBACpC,UAAUK;oBACZ;gBACF;YACF;QACF;IACF,GAAG,CAAC;IAEJ,OAAO;QACL,GAAGf,MAAM;QACT,OAAO;YACL,GAAGA,OAAO,KAAK;YACf,OAAO;gBACL,GAAGK,SAAS;YACd;QACF;IACF;AACF"}