{"version":3,"file":"pipeline/spec/chart/pipes/dataset/datasetXY.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/dataset/datasetXY.ts"],"sourcesContent":["import type { ISpec } from '@visactor/vchart'\nimport { isPivotChart } from 'src/pipeline/utils'\nimport type { VChartSpecPipe } from 'src/types'\n\nexport const datasetXY: VChartSpecPipe = (spec, context) => {\n  const { advancedVSeed, vseed } = context\n  const { analysis, datasetReshapeInfo } = advancedVSeed\n  const { unfoldInfo } = datasetReshapeInfo[0]\n  const orderMapping = analysis?.orderMapping || {}\n  const angle = unfoldInfo.encodingAngle\n  const x = unfoldInfo.encodingX\n  const colorId = unfoldInfo.encodingColorId\n  const id = datasetReshapeInfo[0].id\n\n  const fields: Record<string, object> = {}\n  if (angle) {\n    fields[angle] = {\n      sortIndex: 0,\n    }\n  }\n  if (x) {\n    const order = orderMapping[x]\n    if (order) {\n      fields[x] = {\n        sortIndex: 0,\n        domain: order,\n        lockStatisticsByDomain: true,\n      }\n    } else {\n      fields[x] = {\n        sortIndex: 0,\n      }\n    }\n  }\n\n  if (colorId) {\n    const order = orderMapping[colorId]\n    if (order) {\n      fields[colorId] = {\n        sortIndex: 0,\n        domain: order,\n        lockStatisticsByDomain: true,\n      }\n    } else {\n      fields[colorId] = {\n        sortIndex: 0,\n      }\n    }\n  }\n\n  return {\n    ...spec,\n    data: {\n      id,\n      // 透视表不使用 dataValues\n      values: isPivotChart(vseed) ? undefined : advancedVSeed.dataset,\n      fields: fields,\n    },\n  } as ISpec\n}\n"],"names":["datasetXY","spec","context","advancedVSeed","vseed","analysis","datasetReshapeInfo","unfoldInfo","orderMapping","angle","x","colorId","id","fields","order","isPivotChart","undefined"],"mappings":";AAIO,MAAMA,YAA4B,CAACC,MAAMC;IAC9C,MAAM,EAAEC,aAAa,EAAEC,KAAK,EAAE,GAAGF;IACjC,MAAM,EAAEG,QAAQ,EAAEC,kBAAkB,EAAE,GAAGH;IACzC,MAAM,EAAEI,UAAU,EAAE,GAAGD,kBAAkB,CAAC,EAAE;IAC5C,MAAME,eAAeH,UAAU,gBAAgB,CAAC;IAChD,MAAMI,QAAQF,WAAW,aAAa;IACtC,MAAMG,IAAIH,WAAW,SAAS;IAC9B,MAAMI,UAAUJ,WAAW,eAAe;IAC1C,MAAMK,KAAKN,kBAAkB,CAAC,EAAE,CAAC,EAAE;IAEnC,MAAMO,SAAiC,CAAC;IACxC,IAAIJ,OACFI,MAAM,CAACJ,MAAM,GAAG;QACd,WAAW;IACb;IAEF,IAAIC,GAAG;QACL,MAAMI,QAAQN,YAAY,CAACE,EAAE;QAC7B,IAAII,OACFD,MAAM,CAACH,EAAE,GAAG;YACV,WAAW;YACX,QAAQI;YACR,wBAAwB;QAC1B;aAEAD,MAAM,CAACH,EAAE,GAAG;YACV,WAAW;QACb;IAEJ;IAEA,IAAIC,SAAS;QACX,MAAMG,QAAQN,YAAY,CAACG,QAAQ;QACnC,IAAIG,OACFD,MAAM,CAACF,QAAQ,GAAG;YAChB,WAAW;YACX,QAAQG;YACR,wBAAwB;QAC1B;aAEAD,MAAM,CAACF,QAAQ,GAAG;YAChB,WAAW;QACb;IAEJ;IAEA,OAAO;QACL,GAAGV,IAAI;QACP,MAAM;YACJW;YAEA,QAAQG,aAAaX,SAASY,SAAYb,cAAc,OAAO;YAC/D,QAAQU;QACV;IACF;AACF"}