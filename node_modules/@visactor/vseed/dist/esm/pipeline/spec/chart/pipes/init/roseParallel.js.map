{"version":3,"file":"pipeline/spec/chart/pipes/init/roseParallel.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/init/roseParallel.ts"],"sourcesContent":["import type { IRoseChartSpec } from '@visactor/vchart'\nimport { isDeepEqual } from 'remeda'\nimport { MeasureId } from 'src/dataReshape'\nimport type { VChartSpecPipe } from 'src/types'\n\nexport const initRoseParallel: VChartSpecPipe = (spec, context) => {\n  const result = { ...spec } as IRoseChartSpec\n  const { advancedVSeed } = context\n  const { datasetReshapeInfo, dataset, encoding } = advancedVSeed\n  const { unfoldInfo, foldInfo } = datasetReshapeInfo[0]\n\n  const sameDimensionsMode = isDeepEqual(encoding.angle, encoding.color)\n\n  result.type = 'rose'\n  result.angleField = [unfoldInfo.encodingAngle]\n\n  if (!sameDimensionsMode) {\n    result.angleField.push(unfoldInfo.encodingDetail)\n\n    if (encoding.detail?.[0] === MeasureId && encoding.radius?.length === 1) {\n      result.angleField.pop()\n    }\n  }\n\n  result.valueField = foldInfo.measureValue\n  result.seriesField = unfoldInfo.encodingColorId\n  result.padding = 0\n\n  result.outerRadius = 0.9\n  result.innerRadius = 0\n\n  const hasNegativeValue = dataset.flat().find((d) => d[foldInfo.measureValue] < 0)\n  if (hasNegativeValue) {\n    result.innerRadius = 0.05\n  }\n\n  result.rose = {\n    style: {\n      stroke: '#ffffff',\n      lineWidth: 1,\n    },\n    state: {\n      hover: {\n        lineWidth: 1,\n        fillOpacity: 0.6,\n      },\n    },\n  }\n  result.region = [\n    {\n      clip: true,\n    },\n  ]\n  result.animation = true\n\n  return result\n}\n"],"names":["initRoseParallel","spec","context","result","advancedVSeed","datasetReshapeInfo","dataset","encoding","unfoldInfo","foldInfo","sameDimensionsMode","isDeepEqual","MeasureId","hasNegativeValue","d"],"mappings":";;AAKO,MAAMA,mBAAmC,CAACC,MAAMC;IACrD,MAAMC,SAAS;QAAE,GAAGF,IAAI;IAAC;IACzB,MAAM,EAAEG,aAAa,EAAE,GAAGF;IAC1B,MAAM,EAAEG,kBAAkB,EAAEC,OAAO,EAAEC,QAAQ,EAAE,GAAGH;IAClD,MAAM,EAAEI,UAAU,EAAEC,QAAQ,EAAE,GAAGJ,kBAAkB,CAAC,EAAE;IAEtD,MAAMK,qBAAqBC,YAAYJ,SAAS,KAAK,EAAEA,SAAS,KAAK;IAErEJ,OAAO,IAAI,GAAG;IACdA,OAAO,UAAU,GAAG;QAACK,WAAW,aAAa;KAAC;IAE9C,IAAI,CAACE,oBAAoB;QACvBP,OAAO,UAAU,CAAC,IAAI,CAACK,WAAW,cAAc;QAEhD,IAAID,SAAS,MAAM,EAAE,CAAC,EAAE,KAAKK,aAAaL,SAAS,MAAM,EAAE,WAAW,GACpEJ,OAAO,UAAU,CAAC,GAAG;IAEzB;IAEAA,OAAO,UAAU,GAAGM,SAAS,YAAY;IACzCN,OAAO,WAAW,GAAGK,WAAW,eAAe;IAC/CL,OAAO,OAAO,GAAG;IAEjBA,OAAO,WAAW,GAAG;IACrBA,OAAO,WAAW,GAAG;IAErB,MAAMU,mBAAmBP,QAAQ,IAAI,GAAG,IAAI,CAAC,CAACQ,IAAMA,CAAC,CAACL,SAAS,YAAY,CAAC,GAAG;IAC/E,IAAII,kBACFV,OAAO,WAAW,GAAG;IAGvBA,OAAO,IAAI,GAAG;QACZ,OAAO;YACL,QAAQ;YACR,WAAW;QACb;QACA,OAAO;YACL,OAAO;gBACL,WAAW;gBACX,aAAa;YACf;QACF;IACF;IACAA,OAAO,MAAM,GAAG;QACd;YACE,MAAM;QACR;KACD;IACDA,OAAO,SAAS,GAAG;IAEnB,OAAOA;AACT"}