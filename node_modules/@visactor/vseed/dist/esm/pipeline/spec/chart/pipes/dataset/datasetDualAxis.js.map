{"version":3,"file":"pipeline/spec/chart/pipes/dataset/datasetDualAxis.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/dataset/datasetDualAxis.ts"],"sourcesContent":["import type { ISpec } from '@visactor/vchart'\nimport { isPivotChart } from 'src/pipeline/utils'\nimport type { VChartSpecPipe } from 'src/types'\n\nexport const datasetPrimary: VChartSpecPipe = (spec, context) => {\n  const { advancedVSeed, vseed } = context\n  const { analysis, datasetReshapeInfo } = advancedVSeed\n  const orderMapping = analysis?.orderMapping || {}\n\n  const { unfoldInfo } = datasetReshapeInfo[0]\n  const x = unfoldInfo.encodingX\n  const colorId = unfoldInfo.encodingColorId\n  const id = datasetReshapeInfo[0].id\n\n  const fields: Record<string, object> = {}\n\n  if (x) {\n    const order = orderMapping[x]\n    if (order) {\n      fields[x] = {\n        sortIndex: 0,\n        domain: order,\n        lockStatisticsByDomain: true,\n      }\n    } else {\n      fields[x] = {\n        sortIndex: 0,\n      }\n    }\n  }\n\n  if (colorId) {\n    const order = orderMapping[colorId]\n    if (order) {\n      fields[colorId] = {\n        sortIndex: 0,\n        domain: order,\n        lockStatisticsByDomain: true,\n      }\n    } else {\n      fields[colorId] = {\n        sortIndex: 0,\n      }\n    }\n  }\n\n  return {\n    ...spec,\n    data: {\n      id: `${id}-primary-dataset`,\n      // 透视表不使用 dataValues\n      values: isPivotChart(vseed) ? undefined : advancedVSeed.dataset,\n      fields: fields,\n    },\n  } as ISpec\n}\n\nexport const datasetSecondary: VChartSpecPipe = (spec, context) => {\n  const { advancedVSeed, vseed } = context\n  const { analysis, datasetReshapeInfo } = advancedVSeed\n  const orderMapping = analysis?.orderMapping || {}\n\n  const { unfoldInfo } = datasetReshapeInfo[0]\n  const x = unfoldInfo.encodingX\n  const colorId = unfoldInfo.encodingColorId\n  const id = datasetReshapeInfo[0].id\n\n  const fields: Record<string, object> = {}\n\n  if (x) {\n    const order = orderMapping[x]\n    if (order) {\n      fields[x] = {\n        sortIndex: 0,\n        domain: order,\n        lockStatisticsByDomain: true,\n      }\n    } else {\n      fields[x] = {\n        sortIndex: 0,\n      }\n    }\n  }\n\n  if (colorId) {\n    const order = orderMapping[colorId]\n    if (order) {\n      fields[colorId] = {\n        sortIndex: 0,\n        domain: order,\n        lockStatisticsByDomain: true,\n      }\n    } else {\n      fields[colorId] = {\n        sortIndex: 0,\n      }\n    }\n  }\n\n  return {\n    ...spec,\n    data: {\n      id: `${id}-secondary-dataset`,\n      // 透视表不使用 dataValues\n      values: isPivotChart(vseed) ? undefined : advancedVSeed.dataset,\n      fields: fields,\n    },\n  } as ISpec\n}\n"],"names":["datasetPrimary","spec","context","advancedVSeed","vseed","analysis","datasetReshapeInfo","orderMapping","unfoldInfo","x","colorId","id","fields","order","isPivotChart","undefined","datasetSecondary"],"mappings":";AAIO,MAAMA,iBAAiC,CAACC,MAAMC;IACnD,MAAM,EAAEC,aAAa,EAAEC,KAAK,EAAE,GAAGF;IACjC,MAAM,EAAEG,QAAQ,EAAEC,kBAAkB,EAAE,GAAGH;IACzC,MAAMI,eAAeF,UAAU,gBAAgB,CAAC;IAEhD,MAAM,EAAEG,UAAU,EAAE,GAAGF,kBAAkB,CAAC,EAAE;IAC5C,MAAMG,IAAID,WAAW,SAAS;IAC9B,MAAME,UAAUF,WAAW,eAAe;IAC1C,MAAMG,KAAKL,kBAAkB,CAAC,EAAE,CAAC,EAAE;IAEnC,MAAMM,SAAiC,CAAC;IAExC,IAAIH,GAAG;QACL,MAAMI,QAAQN,YAAY,CAACE,EAAE;QAC7B,IAAII,OACFD,MAAM,CAACH,EAAE,GAAG;YACV,WAAW;YACX,QAAQI;YACR,wBAAwB;QAC1B;aAEAD,MAAM,CAACH,EAAE,GAAG;YACV,WAAW;QACb;IAEJ;IAEA,IAAIC,SAAS;QACX,MAAMG,QAAQN,YAAY,CAACG,QAAQ;QACnC,IAAIG,OACFD,MAAM,CAACF,QAAQ,GAAG;YAChB,WAAW;YACX,QAAQG;YACR,wBAAwB;QAC1B;aAEAD,MAAM,CAACF,QAAQ,GAAG;YAChB,WAAW;QACb;IAEJ;IAEA,OAAO;QACL,GAAGT,IAAI;QACP,MAAM;YACJ,IAAI,GAAGU,GAAG,gBAAgB,CAAC;YAE3B,QAAQG,aAAaV,SAASW,SAAYZ,cAAc,OAAO;YAC/D,QAAQS;QACV;IACF;AACF;AAEO,MAAMI,mBAAmC,CAACf,MAAMC;IACrD,MAAM,EAAEC,aAAa,EAAEC,KAAK,EAAE,GAAGF;IACjC,MAAM,EAAEG,QAAQ,EAAEC,kBAAkB,EAAE,GAAGH;IACzC,MAAMI,eAAeF,UAAU,gBAAgB,CAAC;IAEhD,MAAM,EAAEG,UAAU,EAAE,GAAGF,kBAAkB,CAAC,EAAE;IAC5C,MAAMG,IAAID,WAAW,SAAS;IAC9B,MAAME,UAAUF,WAAW,eAAe;IAC1C,MAAMG,KAAKL,kBAAkB,CAAC,EAAE,CAAC,EAAE;IAEnC,MAAMM,SAAiC,CAAC;IAExC,IAAIH,GAAG;QACL,MAAMI,QAAQN,YAAY,CAACE,EAAE;QAC7B,IAAII,OACFD,MAAM,CAACH,EAAE,GAAG;YACV,WAAW;YACX,QAAQI;YACR,wBAAwB;QAC1B;aAEAD,MAAM,CAACH,EAAE,GAAG;YACV,WAAW;QACb;IAEJ;IAEA,IAAIC,SAAS;QACX,MAAMG,QAAQN,YAAY,CAACG,QAAQ;QACnC,IAAIG,OACFD,MAAM,CAACF,QAAQ,GAAG;YAChB,WAAW;YACX,QAAQG;YACR,wBAAwB;QAC1B;aAEAD,MAAM,CAACF,QAAQ,GAAG;YAChB,WAAW;QACb;IAEJ;IAEA,OAAO;QACL,GAAGT,IAAI;QACP,MAAM;YACJ,IAAI,GAAGU,GAAG,kBAAkB,CAAC;YAE7B,QAAQG,aAAaV,SAASW,SAAYZ,cAAc,OAAO;YAC/D,QAAQS;QACV;IACF;AACF"}