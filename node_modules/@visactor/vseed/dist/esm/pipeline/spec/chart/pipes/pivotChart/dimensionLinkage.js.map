{"version":3,"file":"pipeline/spec/chart/pipes/pivotChart/dimensionLinkage.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/pivotChart/dimensionLinkage.ts"],"sourcesContent":["import type { ICartesianCrosshairSpec, ILineChartSpec } from '@visactor/vchart'\nimport type { DimensionLinkage, PivotChartSpecPipe } from 'src/types'\n\nexport const dimensionLinkage: PivotChartSpecPipe = (spec, context) => {\n  const { advancedVSeed, vseed } = context\n  const { chartType } = vseed\n\n  const config = (advancedVSeed.config?.[chartType as 'line']?.dimensionLinkage ?? {}) as DimensionLinkage\n\n  if (config.enable === false) {\n    return spec\n  }\n\n  const indicators = spec.indicators\n  const labelHoverOnAxis = {}\n  const chartSpec = (indicators as any)?.[0]?.chartSpec as ILineChartSpec\n  const crosshair = chartSpec?.crosshair as ICartesianCrosshairSpec\n\n  if (crosshair?.xField) {\n    const labelFormat = crosshair.xField.label?.formatMethod\n    ;(labelHoverOnAxis as any).bottom = {\n      visible: config.showLabel ?? crosshair.xField.label?.visible ?? true,\n      background: crosshair.xField.label?.labelBackground,\n      textStyle: crosshair.xField.label?.style,\n      formatMethod: labelFormat\n        ? (text: string | string[] | number) => (text || text === 0 ? labelFormat(text) : null)\n        : undefined,\n    }\n  }\n  if (crosshair?.yField) {\n    const labelFormat = crosshair.yField.label?.formatMethod\n    ;(labelHoverOnAxis as any).left = {\n      visible: config.showLabel ?? crosshair.yField.label?.visible ?? true,\n      background: crosshair.yField.label?.labelBackground,\n      textStyle: crosshair.yField.label?.style,\n      formatMethod: labelFormat\n        ? (text: string | string[] | number) => (text || text === 0 ? labelFormat(text) : null)\n        : undefined,\n    }\n  }\n\n  if (indicators && indicators.length) {\n    indicators.forEach((ind) => {\n      const crosshair = (ind as any)?.chartSpec?.crosshair as ICartesianCrosshairSpec\n\n      if (crosshair?.xField) {\n        crosshair.xField.label = { visible: false }\n      }\n\n      if (crosshair?.yField) {\n        crosshair.yField.label = { visible: false }\n      }\n    })\n  }\n\n  spec.chartDimensionLinkage = {\n    showTooltip: config.showTooltip ?? (chartSpec?.tooltip?.dimension?.visible as boolean) ?? true,\n    heightLimitToShowTooltipForLastRow: 60,\n    widthLimitToShowTooltipForLastColumn: 90,\n    labelHoverOnAxis,\n  }\n\n  return spec\n}\n"],"names":["dimensionLinkage","spec","context","advancedVSeed","vseed","chartType","config","indicators","labelHoverOnAxis","chartSpec","crosshair","labelFormat","text","undefined","ind"],"mappings":"AAGO,MAAMA,mBAAuC,CAACC,MAAMC;IACzD,MAAM,EAAEC,aAAa,EAAEC,KAAK,EAAE,GAAGF;IACjC,MAAM,EAAEG,SAAS,EAAE,GAAGD;IAEtB,MAAME,SAAUH,cAAc,MAAM,EAAE,CAACE,UAAoB,EAAE,oBAAoB,CAAC;IAElF,IAAIC,AAAkB,UAAlBA,OAAO,MAAM,EACf,OAAOL;IAGT,MAAMM,aAAaN,KAAK,UAAU;IAClC,MAAMO,mBAAmB,CAAC;IAC1B,MAAMC,YAAaF,YAAoB,CAAC,EAAE,EAAE;IAC5C,MAAMG,YAAYD,WAAW;IAE7B,IAAIC,WAAW,QAAQ;QACrB,MAAMC,cAAcD,UAAU,MAAM,CAAC,KAAK,EAAE;QAC1CF,iBAAyB,MAAM,GAAG;YAClC,SAASF,OAAO,SAAS,IAAII,UAAU,MAAM,CAAC,KAAK,EAAE,WAAW;YAChE,YAAYA,UAAU,MAAM,CAAC,KAAK,EAAE;YACpC,WAAWA,UAAU,MAAM,CAAC,KAAK,EAAE;YACnC,cAAcC,cACV,CAACC,OAAsCA,QAAQA,AAAS,MAATA,OAAaD,YAAYC,QAAQ,OAChFC;QACN;IACF;IACA,IAAIH,WAAW,QAAQ;QACrB,MAAMC,cAAcD,UAAU,MAAM,CAAC,KAAK,EAAE;QAC1CF,iBAAyB,IAAI,GAAG;YAChC,SAASF,OAAO,SAAS,IAAII,UAAU,MAAM,CAAC,KAAK,EAAE,WAAW;YAChE,YAAYA,UAAU,MAAM,CAAC,KAAK,EAAE;YACpC,WAAWA,UAAU,MAAM,CAAC,KAAK,EAAE;YACnC,cAAcC,cACV,CAACC,OAAsCA,QAAQA,AAAS,MAATA,OAAaD,YAAYC,QAAQ,OAChFC;QACN;IACF;IAEA,IAAIN,cAAcA,WAAW,MAAM,EACjCA,WAAW,OAAO,CAAC,CAACO;QAClB,MAAMJ,YAAaI,KAAa,WAAW;QAE3C,IAAIJ,WAAW,QACbA,UAAU,MAAM,CAAC,KAAK,GAAG;YAAE,SAAS;QAAM;QAG5C,IAAIA,WAAW,QACbA,UAAU,MAAM,CAAC,KAAK,GAAG;YAAE,SAAS;QAAM;IAE9C;IAGFT,KAAK,qBAAqB,GAAG;QAC3B,aAAaK,OAAO,WAAW,IAAKG,WAAW,SAAS,WAAW,WAAuB;QAC1F,oCAAoC;QACpC,sCAAsC;QACtCD;IACF;IAEA,OAAOP;AACT"}