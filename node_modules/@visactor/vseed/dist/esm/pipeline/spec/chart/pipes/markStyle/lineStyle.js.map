{"version":3,"file":"pipeline/spec/chart/pipes/markStyle/lineStyle.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/markStyle/lineStyle.ts"],"sourcesContent":["import type { IAreaChartSpec } from '@visactor/vchart'\nimport { selector } from '../../../../../dataSelector'\nimport type { Datum, LineStyle, VChartSpecPipe } from 'src/types'\nimport { isEmpty, isNullish } from 'remeda'\nimport { getCurveTension, getCurveType } from './curve'\n\nexport const lineStyle: VChartSpecPipe = (spec, context) => {\n  const { advancedVSeed } = context\n  const { markStyle } = advancedVSeed\n  const { lineStyle } = markStyle\n  const result = {\n    ...spec,\n    line: {\n      style: {},\n    },\n  } as IAreaChartSpec\n\n  if (isNullish(lineStyle) || isEmpty(lineStyle)) {\n    return result\n  }\n\n  const lineStyles = (Array.isArray(lineStyle) ? lineStyle : [lineStyle]) as LineStyle[]\n\n  const customMap = lineStyles.reduce<object>((result, style, index) => {\n    const { lineColor, lineColorOpacity, lineSmooth, lineStyle, lineWidth = 2, lineVisible = true } = style\n\n    const dashSegment = lineWidth * 2\n    const dashGap = lineWidth\n\n    const lineDash =\n      lineStyle === 'dashed' ? [dashSegment, dashSegment] : lineStyle === 'dotted' ? [dashGap / 2, dashGap * 2] : [0, 0]\n\n    const curveType = getCurveType(context.vseed, lineSmooth)\n    const curveTension = getCurveTension(context.vseed, lineSmooth)\n\n    return {\n      ...result,\n      [`custom${index + 1}`]: {\n        // 优先级: 后者覆盖前者\n        level: index + 1,\n        filter: (\n          _: Datum,\n          node: {\n            renderNode: {\n              context: {\n                data: Datum[]\n              }\n            }\n          },\n        ) => {\n          const lineData = node.renderNode.context.data\n          for (const d of lineData) {\n            if (selector(d, style.selector)) {\n              return true\n            }\n          }\n          return false\n        },\n        style: {\n          visible: lineVisible,\n          curveType: curveType,\n          curveTension: curveTension,\n          strokeOpacity: lineColorOpacity,\n          stroke: lineColor,\n          lineWidth: lineWidth,\n          lineDash: lineDash,\n        },\n      },\n    }\n  }, {})\n\n  return {\n    ...result,\n    line: {\n      ...result.line,\n      state: {\n        ...customMap,\n      },\n    },\n  }\n}\n"],"names":["lineStyle","spec","context","advancedVSeed","markStyle","result","isNullish","isEmpty","lineStyles","Array","customMap","style","index","lineColor","lineColorOpacity","lineSmooth","lineWidth","lineVisible","dashSegment","dashGap","lineDash","curveType","getCurveType","curveTension","getCurveTension","_","node","lineData","d","selector"],"mappings":";;;AAMO,MAAMA,sBAA4B,CAACC,MAAMC;IAC9C,MAAM,EAAEC,aAAa,EAAE,GAAGD;IAC1B,MAAM,EAAEE,SAAS,EAAE,GAAGD;IACtB,MAAM,EAAEH,SAAS,EAAE,GAAGI;IACtB,MAAMC,SAAS;QACb,GAAGJ,IAAI;QACP,MAAM;YACJ,OAAO,CAAC;QACV;IACF;IAEA,IAAIK,UAAUN,cAAcO,QAAQP,YAClC,OAAOK;IAGT,MAAMG,aAAcC,MAAM,OAAO,CAACT,aAAaA,YAAY;QAACA;KAAU;IAEtE,MAAMU,YAAYF,WAAW,MAAM,CAAS,CAACH,QAAQM,OAAOC;QAC1D,MAAM,EAAEC,SAAS,EAAEC,gBAAgB,EAAEC,UAAU,EAAEf,SAAS,EAAEgB,YAAY,CAAC,EAAEC,cAAc,IAAI,EAAE,GAAGN;QAElG,MAAMO,cAAcF,AAAY,IAAZA;QACpB,MAAMG,UAAUH;QAEhB,MAAMI,WACJpB,AAAc,aAAdA,YAAyB;YAACkB;YAAaA;SAAY,GAAGlB,AAAc,aAAdA,YAAyB;YAACmB,UAAU;YAAa,IAAVA;SAAY,GAAG;YAAC;YAAG;SAAE;QAEpH,MAAME,YAAYC,aAAapB,QAAQ,KAAK,EAAEa;QAC9C,MAAMQ,eAAeC,gBAAgBtB,QAAQ,KAAK,EAAEa;QAEpD,OAAO;YACL,GAAGV,MAAM;YACT,CAAC,CAAC,MAAM,EAAEO,QAAQ,GAAG,CAAC,EAAE;gBAEtB,OAAOA,QAAQ;gBACf,QAAQ,CACNa,GACAC;oBAQA,MAAMC,WAAWD,KAAK,UAAU,CAAC,OAAO,CAAC,IAAI;oBAC7C,KAAK,MAAME,KAAKD,SACd,IAAIE,SAASD,GAAGjB,MAAM,QAAQ,GAC5B,OAAO;oBAGX,OAAO;gBACT;gBACA,OAAO;oBACL,SAASM;oBACT,WAAWI;oBACX,cAAcE;oBACd,eAAeT;oBACf,QAAQD;oBACR,WAAWG;oBACX,UAAUI;gBACZ;YACF;QACF;IACF,GAAG,CAAC;IAEJ,OAAO;QACL,GAAGf,MAAM;QACT,MAAM;YACJ,GAAGA,OAAO,IAAI;YACd,OAAO;gBACL,GAAGK,SAAS;YACd;QACF;IACF;AACF"}