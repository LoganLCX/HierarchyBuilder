{"version":3,"file":"pipeline/spec/chart/pipes/legend/pivotColorLegend.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/legend/pivotColorLegend.ts"],"sourcesContent":["import type { PivotChartConstructorOptions } from '@visactor/vtable'\nimport type { Color, Legend, PivotChartSpecPipe } from 'src/types'\n\nexport const pivotColorLegend: PivotChartSpecPipe = (spec, context) => {\n  const result = { ...spec } as PivotChartConstructorOptions\n  const { advancedVSeed } = context\n  const { chartType } = advancedVSeed\n  const baseConfig = advancedVSeed.config[chartType] as { legend: Legend; color: Color }\n\n  if (!baseConfig || !baseConfig.legend) {\n    return result\n  }\n\n  const { datasetReshapeInfo } = advancedVSeed\n  const max = Math.max(...datasetReshapeInfo.map((d) => d.foldInfo.statistics.colorMin))\n  const min = Math.min(...datasetReshapeInfo.map((d) => d.foldInfo.statistics.colorMax))\n  const { legend, color } = baseConfig\n  const { colorScheme, linearColorScheme } = color\n\n  const {\n    enable,\n    position = 'bottom',\n    labelFontColor,\n    labelColor,\n    labelFontSize = 12,\n    labelFontWeight = 400,\n  } = legend || {}\n\n  const orient = ['bottom', 'bottomLeft', 'bottomRight', 'bl', 'br'].includes(position)\n    ? 'bottom'\n    : ['top', 'topLeft', 'topRight', 'tl', 'tr'].includes(position)\n      ? 'top'\n      : ['left', 'leftTop', 'leftBottom', 'lt', 'lb'].includes(position)\n        ? 'left'\n        : 'right'\n\n  const legendPosition = ['topLeft', 'bottomLeft', 'leftTop', 'rightTop', 'lt', 'rt', 'tl', 'bl'].includes(position)\n    ? 'start'\n    : ['topRight', 'bottomRight', 'leftBottom', 'rightBottom', 'lb', 'rb', 'rt', 'br'].includes(position)\n      ? 'end'\n      : 'middle'\n\n  const legends = {\n    visible: enable,\n    type: 'color',\n    orient,\n    position: legendPosition,\n\n    colors: linearColorScheme || colorScheme || [],\n    value: [min, max],\n    min: min,\n    max: max,\n\n    maxWidth: '30%',\n    handlerText: {\n      visible: true,\n      style: {\n        fill: labelColor || labelFontColor,\n        fontSize: labelFontSize,\n        fontWeight: labelFontWeight,\n      },\n    },\n  } as unknown\n  return { ...result, legends } as Partial<PivotChartConstructorOptions>\n}\n"],"names":["pivotColorLegend","spec","context","result","advancedVSeed","chartType","baseConfig","datasetReshapeInfo","max","Math","d","min","legend","color","colorScheme","linearColorScheme","enable","position","labelFontColor","labelColor","labelFontSize","labelFontWeight","orient","legendPosition","legends"],"mappings":"AAGO,MAAMA,mBAAuC,CAACC,MAAMC;IACzD,MAAMC,SAAS;QAAE,GAAGF,IAAI;IAAC;IACzB,MAAM,EAAEG,aAAa,EAAE,GAAGF;IAC1B,MAAM,EAAEG,SAAS,EAAE,GAAGD;IACtB,MAAME,aAAaF,cAAc,MAAM,CAACC,UAAU;IAElD,IAAI,CAACC,cAAc,CAACA,WAAW,MAAM,EACnC,OAAOH;IAGT,MAAM,EAAEI,kBAAkB,EAAE,GAAGH;IAC/B,MAAMI,MAAMC,KAAK,GAAG,IAAIF,mBAAmB,GAAG,CAAC,CAACG,IAAMA,EAAE,QAAQ,CAAC,UAAU,CAAC,QAAQ;IACpF,MAAMC,MAAMF,KAAK,GAAG,IAAIF,mBAAmB,GAAG,CAAC,CAACG,IAAMA,EAAE,QAAQ,CAAC,UAAU,CAAC,QAAQ;IACpF,MAAM,EAAEE,MAAM,EAAEC,KAAK,EAAE,GAAGP;IAC1B,MAAM,EAAEQ,WAAW,EAAEC,iBAAiB,EAAE,GAAGF;IAE3C,MAAM,EACJG,MAAM,EACNC,WAAW,QAAQ,EACnBC,cAAc,EACdC,UAAU,EACVC,gBAAgB,EAAE,EAClBC,kBAAkB,GAAG,EACtB,GAAGT,UAAU,CAAC;IAEf,MAAMU,SAAS;QAAC;QAAU;QAAc;QAAe;QAAM;KAAK,CAAC,QAAQ,CAACL,YACxE,WACA;QAAC;QAAO;QAAW;QAAY;QAAM;KAAK,CAAC,QAAQ,CAACA,YAClD,QACA;QAAC;QAAQ;QAAW;QAAc;QAAM;KAAK,CAAC,QAAQ,CAACA,YACrD,SACA;IAER,MAAMM,iBAAiB;QAAC;QAAW;QAAc;QAAW;QAAY;QAAM;QAAM;QAAM;KAAK,CAAC,QAAQ,CAACN,YACrG,UACA;QAAC;QAAY;QAAe;QAAc;QAAe;QAAM;QAAM;QAAM;KAAK,CAAC,QAAQ,CAACA,YACxF,QACA;IAEN,MAAMO,UAAU;QACd,SAASR;QACT,MAAM;QACNM;QACA,UAAUC;QAEV,QAAQR,qBAAqBD,eAAe,EAAE;QAC9C,OAAO;YAACH;YAAKH;SAAI;QACjB,KAAKG;QACL,KAAKH;QAEL,UAAU;QACV,aAAa;YACX,SAAS;YACT,OAAO;gBACL,MAAMW,cAAcD;gBACpB,UAAUE;gBACV,YAAYC;YACd;QACF;IACF;IACA,OAAO;QAAE,GAAGlB,MAAM;QAAEqB;IAAQ;AAC9B"}