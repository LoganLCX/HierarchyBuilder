{"version":3,"file":"pipeline/spec/chart/pipes/markStyle/outlierStyle.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/markStyle/outlierStyle.ts"],"sourcesContent":["import type { IBoxPlotChartSpec } from '@visactor/vchart'\nimport { selector } from '../../../../../dataSelector'\nimport type { Datum, OutlierStyle, VChartSpecPipe } from 'src/types'\nimport { isEmpty, isNullish } from 'remeda'\n\nexport const outlierStyle: VChartSpecPipe = (spec, context) => {\n  const { advancedVSeed, vseed } = context\n  const { markStyle, config } = advancedVSeed\n  const { outlierStyle } = markStyle\n  const theme = config?.[vseed.chartType as 'boxPlot']?.outlierStyle\n  const result = {\n    ...spec,\n    outlier: {\n      style: {\n        fill: theme?.pointColor,\n      },\n    },\n  } as IBoxPlotChartSpec\n\n  if (isNullish(outlierStyle) || isEmpty(outlierStyle)) {\n    return result\n  }\n\n  const outlierStyles = (Array.isArray(outlierStyle) ? outlierStyle : [outlierStyle]) as OutlierStyle[]\n\n  const customMap = outlierStyles.reduce<object>((result, style, index) => {\n    const {\n      pointBorderColor,\n      pointBorderStyle,\n      pointBorderWidth = 1,\n      pointColor,\n      pointColorOpacity,\n      pointSize,\n      pointVisible = true,\n    } = style\n\n    const lineDash = pointBorderStyle === 'dashed' ? [5, 2] : pointBorderStyle === 'dotted' ? [2, 5] : [0, 0]\n    return {\n      ...result,\n      [`custom${index + 1}`]: {\n        // 优先级: 后者覆盖前者\n        level: index + 1,\n        filter: (datum: Datum) => {\n          if (selector(datum, style.selector)) {\n            return true\n          }\n          return false\n        },\n        style: {\n          visible: pointVisible,\n          size: pointSize,\n          fill: pointColor,\n          fillOpacity: pointColorOpacity,\n          innerBorder: {\n            stroke: pointBorderColor,\n            lineWidth: pointBorderWidth,\n            distance: (pointBorderWidth || 0) / 2,\n            lineDash: lineDash,\n          },\n        },\n      },\n    }\n  }, {})\n\n  return {\n    ...result,\n    outlier: {\n      ...result.outlier,\n      state: {\n        ...customMap,\n      },\n    },\n  }\n}\n"],"names":["outlierStyle","spec","context","advancedVSeed","vseed","markStyle","config","theme","result","isNullish","isEmpty","outlierStyles","Array","customMap","style","index","pointBorderColor","pointBorderStyle","pointBorderWidth","pointColor","pointColorOpacity","pointSize","pointVisible","lineDash","datum","selector"],"mappings":";;AAKO,MAAMA,4BAA+B,CAACC,MAAMC;IACjD,MAAM,EAAEC,aAAa,EAAEC,KAAK,EAAE,GAAGF;IACjC,MAAM,EAAEG,SAAS,EAAEC,MAAM,EAAE,GAAGH;IAC9B,MAAM,EAAEH,YAAY,EAAE,GAAGK;IACzB,MAAME,QAAQD,QAAQ,CAACF,MAAM,SAAS,CAAc,EAAE;IACtD,MAAMI,SAAS;QACb,GAAGP,IAAI;QACP,SAAS;YACP,OAAO;gBACL,MAAMM,OAAO;YACf;QACF;IACF;IAEA,IAAIE,UAAUT,iBAAiBU,QAAQV,eACrC,OAAOQ;IAGT,MAAMG,gBAAiBC,MAAM,OAAO,CAACZ,gBAAgBA,eAAe;QAACA;KAAa;IAElF,MAAMa,YAAYF,cAAc,MAAM,CAAS,CAACH,QAAQM,OAAOC;QAC7D,MAAM,EACJC,gBAAgB,EAChBC,gBAAgB,EAChBC,mBAAmB,CAAC,EACpBC,UAAU,EACVC,iBAAiB,EACjBC,SAAS,EACTC,eAAe,IAAI,EACpB,GAAGR;QAEJ,MAAMS,WAAWN,AAAqB,aAArBA,mBAAgC;YAAC;YAAG;SAAE,GAAGA,AAAqB,aAArBA,mBAAgC;YAAC;YAAG;SAAE,GAAG;YAAC;YAAG;SAAE;QACzG,OAAO;YACL,GAAGT,MAAM;YACT,CAAC,CAAC,MAAM,EAAEO,QAAQ,GAAG,CAAC,EAAE;gBAEtB,OAAOA,QAAQ;gBACf,QAAQ,CAACS;oBACP,IAAIC,SAASD,OAAOV,MAAM,QAAQ,GAChC,OAAO;oBAET,OAAO;gBACT;gBACA,OAAO;oBACL,SAASQ;oBACT,MAAMD;oBACN,MAAMF;oBACN,aAAaC;oBACb,aAAa;wBACX,QAAQJ;wBACR,WAAWE;wBACX,UAAWA,AAAAA,CAAAA,oBAAoB,KAAK;wBACpC,UAAUK;oBACZ;gBACF;YACF;QACF;IACF,GAAG,CAAC;IAEJ,OAAO;QACL,GAAGf,MAAM;QACT,SAAS;YACP,GAAGA,OAAO,OAAO;YACjB,OAAO;gBACL,GAAGK,SAAS;YACd;QACF;IACF;AACF"}