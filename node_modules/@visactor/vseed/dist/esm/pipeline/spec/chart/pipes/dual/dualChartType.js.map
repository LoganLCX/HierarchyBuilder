{"version":3,"file":"pipeline/spec/chart/pipes/dual/dualChartType.js","sources":["../../../../../../../src/pipeline/spec/chart/pipes/dual/dualChartType.ts"],"sourcesContent":["import type { IBarSeriesSpec, ISeriesSpec } from '@visactor/vchart'\nimport { DUAL_AXIS_CHART_COLUMN_Z_INDEX, DUAL_AXIS_CHART_NON_COLUMN_Z_INDEX } from 'src/pipeline/utils/constant'\nimport type { DualChartType, VChartSpecPipe } from 'src/types'\n\nexport const dualChartTypePrimary: VChartSpecPipe = (spec, context) => {\n  const result = { ...spec, zIndex: DUAL_AXIS_CHART_NON_COLUMN_Z_INDEX } as ISeriesSpec\n  const { advancedVSeed, vseed } = context\n  const { chartType } = vseed\n  const { datasetReshapeInfo } = advancedVSeed\n  const index = datasetReshapeInfo[0].index\n\n  const config =\n    advancedVSeed.config?.[chartType as 'dualAxis']?.dualChartType ||\n    ({\n      primary: 'column',\n      secondary: 'line',\n    } as DualChartType)\n\n  const primary = Array.isArray(config) ? config[index].primary || config[0].primary : config.primary\n  const secondary = Array.isArray(config) ? config[index].secondary || config[0].secondary : config.secondary\n  const bothColumn = primary === 'column' && secondary === 'column'\n  const type = bothColumn ? 'columnParallel' : primary\n  switch (type) {\n    case 'line': {\n      result.type = 'line'\n      break\n    }\n    case 'column': {\n      result.type = 'bar'\n      result.zIndex = DUAL_AXIS_CHART_COLUMN_Z_INDEX\n      break\n    }\n    case 'columnParallel': {\n      const columnSpec = result as IBarSeriesSpec\n      if (Array.isArray(columnSpec.xField)) {\n        columnSpec.xField.push(datasetReshapeInfo[0].unfoldInfo.encodingDetail)\n      } else if (columnSpec.xField) {\n        columnSpec.xField = [columnSpec.xField, datasetReshapeInfo[0].unfoldInfo.encodingDetail]\n      }\n      columnSpec.type = 'bar'\n      result.zIndex = DUAL_AXIS_CHART_COLUMN_Z_INDEX\n      break\n    }\n    // @ts-expect-error  'columnPercent' 和 'areaPercent' 会改变轴值域为[0,1], VTable不支持.\n    case 'columnPercent': {\n      result.type = 'bar'\n      result.percent = true\n      result.zIndex = DUAL_AXIS_CHART_COLUMN_Z_INDEX\n      break\n    }\n    case 'area': {\n      result.type = 'area'\n      break\n    }\n    // @ts-expect-error  'columnPercent' 和 'areaPercent' 会改变轴值域为[0,1], VTable不支持.\n    case 'areaPercent': {\n      result.type = 'area'\n      result.percent = true\n      break\n    }\n    case 'scatter': {\n      result.type = 'scatter'\n      break\n    }\n    default:\n      result.type = primary\n  }\n\n  return result\n}\n\nexport const dualChartTypeSecondary: VChartSpecPipe = (spec, context) => {\n  const result = { ...spec, zIndex: DUAL_AXIS_CHART_NON_COLUMN_Z_INDEX } as ISeriesSpec\n  const { advancedVSeed, vseed } = context\n  const { chartType } = vseed\n  const { datasetReshapeInfo } = advancedVSeed\n  const config =\n    advancedVSeed.config?.[chartType as 'dualAxis']?.dualChartType ||\n    ({\n      primary: 'column',\n      secondary: 'line',\n    } as DualChartType)\n\n  const index = datasetReshapeInfo[0].index\n  const primary = Array.isArray(config) ? config[index].primary || config[0].primary : config.primary\n  const secondary = Array.isArray(config) ? config[index].secondary || config[0].secondary : config.secondary\n  const bothColumn = primary === 'column' && secondary === 'column'\n  const type = bothColumn ? 'columnParallel' : secondary\n\n  switch (type) {\n    case 'line': {\n      result.type = 'line'\n      break\n    }\n    case 'column': {\n      result.type = 'bar'\n      result.zIndex = DUAL_AXIS_CHART_COLUMN_Z_INDEX\n      break\n    }\n    case 'columnParallel': {\n      const columnSpec = result as IBarSeriesSpec\n      if (Array.isArray(columnSpec.xField)) {\n        columnSpec.xField.push(datasetReshapeInfo[0].unfoldInfo.encodingDetail)\n      } else if (columnSpec.xField) {\n        columnSpec.xField = [columnSpec.xField, datasetReshapeInfo[0].unfoldInfo.encodingDetail]\n      }\n      columnSpec.type = 'bar'\n      result.zIndex = DUAL_AXIS_CHART_COLUMN_Z_INDEX\n      break\n    }\n    // @ts-expect-error  'columnPercent' 和 'areaPercent' 会改变轴值域为[0,1], VTable不支持.\n    case 'columnPercent': {\n      result.type = 'bar'\n      result.percent = true\n      result.zIndex = DUAL_AXIS_CHART_COLUMN_Z_INDEX\n      break\n    }\n    case 'area': {\n      result.type = 'area'\n      break\n    }\n    // @ts-expect-error  'columnPercent' 和 'areaPercent' 会改变轴值域为[0,1], VTable不支持.\n    case 'areaPercent': {\n      result.type = 'area'\n      result.percent = true\n      break\n    }\n    case 'scatter': {\n      result.type = 'scatter'\n      break\n    }\n    default:\n      result.type = secondary\n  }\n\n  return result\n}\n"],"names":["dualChartTypePrimary","spec","context","result","DUAL_AXIS_CHART_NON_COLUMN_Z_INDEX","advancedVSeed","vseed","chartType","datasetReshapeInfo","index","config","primary","Array","secondary","bothColumn","type","DUAL_AXIS_CHART_COLUMN_Z_INDEX","columnSpec","dualChartTypeSecondary"],"mappings":"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"}