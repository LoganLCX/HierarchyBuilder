{"version":3,"sources":["../src/component/data-zoom/util.ts"],"names":[],"mappings":"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","file":"util.js","sourcesContent":["import { isArray, isValid, last } from '@visactor/vutils';\nimport { array, isNil } from '../../util';\nimport type { DataView } from '@visactor/vdataset';\nimport type { IBandLikeScale, IBaseScale } from '@visactor/vscale';\nimport { isContinuous } from '@visactor/vscale';\nimport type { CartesianAxis, ICartesianBandAxisSpec } from '../axis/cartesian';\nexport interface IDataFilterWithNewDomainOption {\n  getNewDomain: () => any[];\n  isContinuous: () => boolean;\n  field: () => string;\n}\n\nexport const lockStatisticsFilter = (\n  statisticsData: any,\n  op: IDataFilterWithNewDomainOption & {\n    originalFields: () => Record<string, any>;\n  }\n) => {\n  const { getNewDomain, isContinuous, field, originalFields } = op;\n\n  const datumField = field();\n  const newDomain = getNewDomain();\n  if (isNil(newDomain) || isNil(datumField)) {\n    return statisticsData;\n  }\n  const fields = originalFields();\n  const realField = isArray(datumField) ? datumField[0] : datumField;\n\n  if (\n    statisticsData[realField] &&\n    fields &&\n    fields[realField] &&\n    fields[realField].lockStatisticsByDomain &&\n    !isContinuous()\n  ) {\n    statisticsData[realField].values = newDomain;\n  }\n\n  return statisticsData;\n};\n\n/**\n * 保证数据筛选的结果全都在坐标轴的新domain范围中，防止出现point数据因为超出domain范围而绘制在原点的情况\n */\nexport const dataFilterWithNewDomain = (data: Array<any>, op: IDataFilterWithNewDomainOption) => {\n  const { getNewDomain, isContinuous, field } = op;\n  const datumField = field();\n  const newDomain = getNewDomain();\n  if (isNil(newDomain) || isNil(datumField)) {\n    return data;\n  }\n  if (newDomain.length === 0) {\n    return [];\n  }\n\n  // 使用map代替indexOf查找，提升性能\n  const domainMap = {};\n  newDomain.forEach(d => {\n    if (!domainMap[d]) {\n      domainMap[d] = 1;\n    }\n  });\n\n  let filter = null;\n  if (isContinuous()) {\n    filter = (d: any) => {\n      let flag = false;\n      array(datumField).every(field => {\n        if (d[field] >= newDomain[0] && d[field] <= last(newDomain)) {\n          flag = true;\n        }\n        return;\n      });\n      return flag;\n    };\n  } else {\n    filter = (d: any) => {\n      let flag = false;\n      array(datumField).every(field => {\n        // 这里d[f] + ''的原因是：数据是number类型的，但轴声明为band轴，domain会强制将number => string，所以filter的时候要将data中的number => string\n        if (domainMap[d[field] + ''] || domainMap[d[field]]) {\n          flag = true;\n        }\n        return;\n      });\n      return flag;\n    };\n  }\n\n  return data.filter(filter);\n};\n\nexport interface IDataFilterComputeDomainOption {\n  input: {\n    dataCollection: any[];\n    stateFields: string[];\n    valueFields: string[];\n    isCategoryState?: boolean;\n    seriesCollection: any[];\n    method: 'sum'; // todo: 也许可以提供多种数据统计方法 @chensiji\n  };\n  output: {\n    stateField: string;\n    valueField: string;\n  };\n}\n\nexport const dataFilterComputeDomain = (data: Array<any>, op: IDataFilterComputeDomainOption) => {\n  const { stateFields, valueFields, dataCollection, isCategoryState, seriesCollection } = op.input;\n  const { stateField, valueField } = op.output;\n  const resultObj: any = {};\n  const resultKeys: any[] = [];\n  const resultData: any[] = [];\n  const stateValues: any[] = [];\n  let hasLockDomain = false;\n  let isAllLinearValue = false;\n  dataCollection.forEach((dv: DataView, i) => {\n    if (isNil(stateFields[i])) {\n      return;\n    }\n    const series = seriesCollection[i];\n    if (series) {\n      const statistics = series.getRawDataStatisticsByField(stateFields[i]);\n      if (isValid(statistics?.max) && isValid(statistics?.min)) {\n        isAllLinearValue = true;\n      }\n    }\n    // 按照用户指定的domain进行排序(这里不通过getRawDataStatistics来取是因为时机不对，此时getRawDataStatistics还没有正确结果)\n    const stateFieldInfo = dv.getFields()?.[stateFields[i]];\n    if (stateFieldInfo && stateFieldInfo.lockStatisticsByDomain) {\n      hasLockDomain = true;\n      stateFieldInfo.domain.forEach((d: any) => {\n        if (isNil(resultObj[d])) {\n          stateValues.push(d);\n          resultObj[d] = 0;\n          resultKeys.push(d);\n        }\n      });\n    }\n    dv.latestData.forEach((d: any) => {\n      // 针对rangeColumn等xField为数组形式的图表，需要将xField的所有value都记录下来\n      array(stateFields[i]).forEach(state => {\n        if (!isNil(d[state])) {\n          if (isNil(resultObj[d[state]])) {\n            stateValues.push(d[state]);\n            resultObj[d[state]] = 0;\n            resultKeys.push(d[state]);\n          }\n          if (!isNil(valueFields[i])) {\n            // 传进来的d[yFields[i]]可能是stringnumber\n            // 传进来的d[yFields[i]]可能是普通的字符串，这时计数按1计算（其实相当于计算数据条数）\n            resultObj[d[state]] += isNaN(parseFloat(d[valueFields[i]])) ? 1 : parseFloat(d[valueFields[i]]);\n          }\n        }\n      });\n    });\n  });\n\n  const sortedStateValues = hasLockDomain\n    ? stateValues\n    : isCategoryState === false || isAllLinearValue\n    ? stateValues.sort((a, b) => a - b)\n    : resultKeys;\n\n  sortedStateValues.forEach(state => {\n    const res = { [stateField]: state };\n\n    if (valueField) {\n      res[valueField] = resultObj[state];\n    }\n\n    resultData.push(res);\n  });\n\n  return resultData;\n};\n\nexport const statePointToData = (state: number, scale: IBaseScale, reverse: boolean) => {\n  const domain = scale.domain();\n\n  // continuous scale: 本来可以用scale invert，但scale invert在大数据场景下性能不太好，所以这里自行计算\n  if (isContinuous(scale.type)) {\n    if (reverse) {\n      return domain[0] + (last(domain) - domain[0]) * (1 - state);\n    }\n    return domain[0] + (last(domain) - domain[0]) * state;\n  }\n\n  // discete scale: 根据bandSize计算不准确, bandSize不是最新的, 导致index计算错误, 所以仍然使用invert\n  let range = scale.range();\n  if (reverse) {\n    range = range.slice().reverse();\n  }\n  const posInRange: number = range[0] + (last(range) - range[0]) * state;\n  return scale.invert(posInRange);\n};\n\nexport const dataToStatePoint = (data: number | string, scale: IBaseScale, isHorizontal: boolean) => {\n  const pos = scale.scale(data);\n  let range = scale.range();\n\n  if (!isHorizontal && isContinuous(scale.type)) {\n    range = range.slice().reverse();\n  }\n\n  return Math.max(0, Math.min(1, (pos - range[0]) / (last(range) - range[0])));\n};\n\nexport const isReverse = (axisComponent: CartesianAxis<any>, isHorizontal: boolean) => {\n  const axis = axisComponent;\n  if (!axis) {\n    return false;\n  }\n  const axisScale = axis.getScale() as IBandLikeScale;\n  return axisScale.range()[0] > axisScale.range()[1] && (!axis.getInverse() || isHorizontal);\n};\n\nexport const getAxisBandSize = (axisSpec?: ICartesianBandAxisSpec) => {\n  const bandSize = axisSpec?.bandSize;\n  const maxBandSize = axisSpec?.maxBandSize;\n  const minBandSize = axisSpec?.minBandSize;\n  if (bandSize || minBandSize || maxBandSize) {\n    return { bandSize, maxBandSize, minBandSize };\n  }\n  return undefined;\n};\n\nexport const modeCheck = (statePoint: 'start' | 'end', mode: string, spec: any): any => {\n  if (statePoint === 'start') {\n    return (mode === 'percent' && isValid(spec.start)) || (mode === 'value' && isValid(spec.startValue));\n  }\n  return (mode === 'percent' && isValid(spec.end)) || (mode === 'value' && isValid(spec.endValue));\n};\n\nexport const parseDomainFromState = (startValue: number | string, endValue: number | string, scale: IBaseScale) => {\n  if (isContinuous(scale.type)) {\n    return [Math.min(endValue as number, startValue as number), Math.max(endValue as number, startValue as number)];\n  }\n  const allDomain = scale.domain();\n  const startIndex = allDomain.indexOf(startValue);\n  const endIndex = allDomain.indexOf(endValue);\n  return allDomain.slice(Math.min(startIndex, endIndex), Math.max(startIndex, endIndex) + 1);\n};\n\nexport const parseDomainFromStateAndValue = (\n  start: number,\n  startValue: number | string,\n  end: number,\n  endValue: number | string,\n  scale: IBaseScale\n) => {\n  if (isContinuous(scale.type)) {\n    const domain = scale.domain();\n    const min = domain[0];\n    const total = last(domain) - min;\n    const resultStart = isValid(start) ? min + total * start : +startValue;\n    const resultEnd = isValid(end) ? min + total * end : +endValue;\n    return [Math.min(resultEnd, resultStart), Math.max(resultEnd, resultStart)];\n  }\n  const allDomain = scale.domain();\n  const range = scale.range();\n  const rangeSize = range[range.length - 1] - range[0];\n  const startIndex = isValid(start)\n    ? allDomain.indexOf(scale.invert(rangeSize * start + range[0]))\n    : allDomain.indexOf(startValue);\n  const endIndex = isValid(end)\n    ? allDomain.indexOf(scale.invert(rangeSize * end + range[0]))\n    : allDomain.indexOf(endValue);\n  return allDomain.slice(Math.min(startIndex, endIndex), Math.max(startIndex, endIndex) + 1);\n};\n"]}