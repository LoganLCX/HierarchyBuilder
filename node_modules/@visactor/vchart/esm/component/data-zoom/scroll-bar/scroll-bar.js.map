{"version":3,"sources":["../src/component/data-zoom/scroll-bar/scroll-bar.ts"],"names":[],"mappings":"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","file":"scroll-bar.js","sourcesContent":["import { isEmpty, isFunction, isNil, isNumber, isValid } from '@visactor/vutils';\nimport type { IComponentOption } from '../../interface';\n// eslint-disable-next-line no-duplicate-imports\nimport { ComponentTypeEnum } from '../../interface/type';\nimport { DataFilterBaseComponent } from '../data-filter-base-component';\nimport type { ScrollBarAttributes } from '@visactor/vrender-components';\n// eslint-disable-next-line no-duplicate-imports\nimport { ScrollBar as ScrollBarComponent } from '@visactor/vrender-components';\nimport { transformToGraphic } from '../../../util/style';\nimport type { IRectGraphicAttribute, INode, IGroup, IGraphic } from '@visactor/vrender-core';\nimport { LayoutLevel, LayoutZIndex } from '../../../constant/layout';\nimport { ChartEvent } from '../../../constant/event';\nimport { SCROLL_BAR_DEFAULT_SIZE } from '../../../constant/scroll-bar';\nimport type { IScrollBarSpec } from './interface';\nimport { Factory } from '../../../core/factory';\nimport type { ILayoutType } from '../../../typings/layout';\nimport { isClose } from '../../../util';\nimport { scrollBar } from '../../../theme/builtin/common/component/scroll-bar';\nimport { statePointToData } from '../util';\n// import { SCROLLBAR_EVENT, SCROLLBAR_END_EVENT } from '@visactor/vrender-components/es/constant';\n\n// 由vrender透出, 接入新版本后需修改\nconst SCROLLBAR_EVENT = 'scrollDrag';\nconst SCROLLBAR_END_EVENT = 'scrollUp';\n\nexport class ScrollBar<T extends IScrollBarSpec = IScrollBarSpec> extends DataFilterBaseComponent<T> {\n  static type = ComponentTypeEnum.scrollBar;\n  type = ComponentTypeEnum.scrollBar;\n  name: string = ComponentTypeEnum.scrollBar;\n\n  static readonly builtInTheme = {\n    scrollBar\n  };\n  static specKey = 'scrollBar';\n  specKey = 'scrollBar';\n\n  layoutZIndex: number = LayoutZIndex.DataZoom;\n  layoutLevel: number = LayoutLevel.DataZoom;\n  layoutType: ILayoutType = 'region-relative';\n\n  // scrollbar组件\n  protected _component!: ScrollBarComponent;\n\n  constructor(spec: T, options: IComponentOption) {\n    super(spec as any, options);\n    this._filterMode = spec.filterMode ?? 'axis';\n  }\n\n  /*** start: init event and event dispatch ***/\n  protected _handleChange(start: number, end: number, updateComponent?: boolean) {\n    super._handleChange(start, end, updateComponent);\n    // filter out scroll event with same scroll value\n    const isSameScrollValue = isClose(this._start, start) && isClose(this._end, end);\n    // realTime为false时，start和end始终没有变化过, 但是需要触发change事件\n    if (this._shouldChange && (!isSameScrollValue || this._spec.realTime === false)) {\n      if (updateComponent && this._component) {\n        this._component.setAttribute('range', [start, end]);\n      }\n\n      this._start = start;\n      this._end = end;\n      const startValue = statePointToData(start, this._stateScale, false);\n      const endValue = statePointToData(end, this._stateScale, false);\n      const hasChange = isFunction(this._spec.updateDataAfterChange)\n        ? this._spec.updateDataAfterChange(start, end, startValue, endValue)\n        : this._handleStateChange(startValue, endValue);\n      if (hasChange) {\n        this.event.emit(ChartEvent.scrollBarChange, {\n          model: this,\n          value: {\n            filterData: this._filterMode !== 'axis',\n            start: this._start,\n            end: this._end,\n            startValue: this._startValue,\n            endValue: this._endValue,\n            newDomain: this._newDomain\n          }\n        });\n      }\n    }\n  }\n\n  protected _handleDataCollectionChange() {\n    if (this._spec.auto) {\n      const data = this._data.getDataView();\n      data.reRunAllTransform();\n    }\n  }\n  /*** end: init event and event dispatch ***/\n\n  /*** start: component lifecycle ***/\n\n  protected _beforeLayoutEnd() {\n    super._beforeLayoutEnd();\n    this.effect.onZoomChange?.();\n  }\n\n  onLayoutEnd(): void {\n    // 保证自己的宽高正确\n    this._updateComponentBounds();\n    super.onLayoutEnd();\n  }\n  /*** end: component lifecycle ***/\n\n  /*** start: scale ***/\n  protected _updateScaleRange() {\n    // do nothing\n  }\n\n  protected _updateComponentBounds() {\n    if (this._component) {\n      this._component.setAttributes({\n        x: this.getLayoutStartPoint().x,\n        y: this.getLayoutStartPoint().y,\n        width: this.getLayoutRect().width,\n        height: this.getLayoutRect().height\n      });\n    }\n  }\n\n  /*** end: scale ***/\n\n  /** start: component layout attr ***/\n  protected _computeWidth(): number {\n    if (this._visible === false) {\n      return 0;\n    }\n    if (isNumber(this._spec.width)) {\n      return this._spec.width;\n    }\n\n    if (this._isHorizontal) {\n      return this.getLayoutRect().width;\n    }\n    // default value\n    return SCROLL_BAR_DEFAULT_SIZE;\n  }\n\n  protected _computeHeight(): number {\n    if (this._visible === false) {\n      return 0;\n    }\n    if (isNumber(this._spec.height)) {\n      return this._spec.height;\n    }\n\n    // default value\n    if (!this._isHorizontal) {\n      return this.getLayoutRect().height;\n    }\n\n    return SCROLL_BAR_DEFAULT_SIZE;\n  }\n  /** end: component layout attr ***/\n\n  /** start: scrollbar component attr ***/\n  private _getAttrs() {\n    return {\n      zIndex: this.layoutZIndex,\n      x: this.getLayoutStartPoint().x,\n      y: this.getLayoutStartPoint().y,\n      width: this.getLayoutRect().width,\n      height: this.getLayoutRect().height,\n      range: [this._start, this._end],\n      direction: this._isHorizontal ? 'horizontal' : 'vertical',\n      delayType: this._spec?.delayType,\n      delayTime: isValid(this._spec?.delayType) ? (this._spec?.delayTime ?? 30) : 0,\n      realTime: this._spec?.realTime ?? true,\n      ...this._getComponentAttrs()\n    } as ScrollBarAttributes;\n  }\n\n  protected _createOrUpdateComponent() {\n    const attrs = this._getAttrs();\n    if (this._component) {\n      this._component.setAttributes(attrs);\n    } else {\n      const container = this.getContainer();\n      this._component = new ScrollBarComponent(attrs);\n      // 绑定事件，防抖，防止频繁触发\n      this._component.addEventListener(SCROLLBAR_EVENT, (e: any) => {\n        const value = e.detail.value;\n        this._handleChange(value[0], value[1]);\n      });\n      this._component.addEventListener(SCROLLBAR_END_EVENT, (e: any) => {\n        const value = e.detail.value;\n        this._handleChange(value[0], value[1]);\n      });\n      container.add(this._component as unknown as INode);\n    }\n  }\n\n  protected _getComponentAttrs() {\n    const { rail, slider, innerPadding } = this._spec;\n    const attrs: Partial<ScrollBarAttributes> = {};\n\n    if (!isNil(innerPadding)) {\n      attrs.padding = innerPadding;\n    }\n\n    if (!isEmpty(rail?.style)) {\n      attrs.railStyle = transformToGraphic(rail.style) as unknown as IRectGraphicAttribute;\n    }\n    if (!isEmpty(slider?.style)) {\n      attrs.sliderStyle = transformToGraphic(slider.style) as unknown as IRectGraphicAttribute;\n    }\n    attrs.disableTriggerEvent = this._option.disableTriggerEvent;\n    return attrs;\n  }\n  /** end: scrollbar component attr ***/\n\n  protected _getNeedClearVRenderComponents(): IGraphic[] {\n    return [this._component] as unknown as IGroup[];\n  }\n}\n\nexport const registerScrollBar = () => {\n  Factory.registerComponent(ScrollBar.type, ScrollBar);\n};\n"]}