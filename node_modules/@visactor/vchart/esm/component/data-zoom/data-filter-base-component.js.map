{"version":3,"sources":["../src/component/data-zoom/data-filter-base-component.ts"],"names":[],"mappings":"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","file":"data-filter-base-component.js","sourcesContent":["import type { ICartesianSeries, IPolarSeries, ISeries } from '../../series/interface';\nimport { eachSeries } from '../../util/model';\nimport { BaseComponent } from '../base/base-component';\nimport type { IEffect, IModelInitOption } from '../../model/interface';\nimport { ComponentTypeEnum, type IComponent, type IComponentOption } from '../interface';\nimport {\n  dataFilterComputeDomain,\n  dataFilterWithNewDomain,\n  dataToStatePoint,\n  getAxisBandSize,\n  isReverse,\n  lockStatisticsFilter,\n  modeCheck,\n  parseDomainFromStateAndValue,\n  parseDomainFromState,\n  statePointToData\n} from './util';\nimport type {\n  AdaptiveSpec,\n  ILayoutPoint,\n  ILayoutRect,\n  ILayoutType,\n  IOrientType,\n  IRect,\n  StringOrNumber\n} from '../../typings';\nimport { registerDataSetInstanceParser, registerDataSetInstanceTransform } from '../../data/register';\nimport type { IContinuousScale } from '@visactor/vscale';\nimport {\n  BandScale,\n  isContinuous,\n  isDiscrete,\n  LinearScale,\n  type IBandLikeScale,\n  type IBaseScale\n} from '@visactor/vscale';\nimport { Direction } from '../../typings/space';\nimport type { CartesianAxis, ICartesianBandAxisSpec } from '../axis/cartesian';\nimport type { IAxis } from '../axis';\nimport { getDirectionByOrient, getOrient } from '../axis/cartesian/util/common';\nimport {\n  mixin,\n  isNil,\n  isEqual,\n  isValid,\n  array,\n  minInArray,\n  maxInArray,\n  last,\n  type IBoundsLike,\n  isValidNumber\n} from '@visactor/vutils';\nimport type { IDataFilterComponent, IDataFilterComponentSpec, IFilterMode } from './interface';\nimport { dataViewParser, DataView } from '@visactor/vdataset';\nimport { CompilableData } from '../../compile/data/compilable-data';\nimport { Zoomable } from '../../interaction/zoom/zoomable';\nimport type { AbstractComponent, DataZoom as DataZoomComponent } from '@visactor/vrender-components';\nimport { TransformLevel } from '../../data/initialize';\nimport type { IDataZoomSpec } from './data-zoom/interface';\nimport type { IGraphic, IGroup } from '@visactor/vrender-core';\nimport { AttributeLevel } from '../../constant/attribute';\nimport type { IGroupMark } from '../../mark/interface/mark';\nimport { DataFilterEvent } from './data-filter-event';\nimport { ChartEvent } from '../../constant/event';\n\nexport abstract class DataFilterBaseComponent<T extends IDataFilterComponentSpec = IDataFilterComponentSpec>\n  extends BaseComponent<AdaptiveSpec<T, 'width' | 'height'>>\n  implements IDataFilterComponent\n{\n  protected _dataFilterEvent: DataFilterEvent;\n  layoutType: ILayoutType | 'none' = 'none';\n\n  protected _component: AbstractComponent;\n\n  protected _orient: IOrientType = 'left';\n  protected _isHorizontal: boolean;\n  get isHorizontal() {\n    return this._isHorizontal;\n  }\n\n  // 是否为自动模式\n  protected _auto?: boolean;\n  protected _fixedBandSize?: number;\n  protected _cacheRect?: ILayoutRect;\n  protected _cacheLayoutStartPoint?: ILayoutPoint;\n  protected _cacheVisibility?: boolean = undefined;\n  protected _dataUpdating: boolean = false;\n\n  // 数据\n  protected _stateScale: IBaseScale;\n  get stateScale() {\n    return this._stateScale;\n  }\n  protected _hasInitStateScale: boolean = false;\n\n  // 与系列的关联关系\n  // 优先级：id > index\n  // 最终结果：series & region取交集\n  protected _seriesUserId?: StringOrNumber[];\n  protected _seriesIndex?: number[];\n  protected _regionUserId!: string[];\n  protected _regionIndex!: number[];\n  protected _newDomain: any[];\n  protected _relatedAxisComponent!: IComponent;\n  get relatedAxisComponent() {\n    return this._relatedAxisComponent;\n  }\n  protected _originalStateFields: Record<number, string | number>;\n\n  // 起点数据\n  protected _startValue!: number | string;\n  // 终点数据\n  protected _endValue!: number | string;\n  // 开始值，百分比值，0 - 1\n  protected _start!: number;\n  // 结束值，百分比值，0 - 1\n  protected _end!: number;\n  // 最小窗口范围\n  protected _minSpan!: number;\n  // 最大窗口范围\n  protected _maxSpan!: number;\n  // 窗口范围缓存\n  protected _spanCache!: number;\n  protected _shouldChange: boolean = true;\n\n  protected _domainCache!: any;\n\n  protected _field!: string | undefined;\n  protected _stateField: string = 'x';\n  protected _valueField?: string;\n\n  protected _width!: number;\n  protected _height!: number;\n\n  protected _filterMode!: IFilterMode;\n\n  /*** start: public function ***/\n  /**\n   * 外部可以通过此方法强制改变datazoom的start和end，达到聚焦定位的效果\n   * @param start datazoom起点所在的相对位置\n   * @param end datazoom终点所在的相对位置\n   * @returns\n   */\n  setStartAndEnd(\n    start: number | string,\n    end: number | string,\n    rangeMode: ['percent' | 'value', 'percent' | 'value'] = ['percent', 'percent']\n  ) {\n    const [startMode = 'percent', endMode = 'percent'] = rangeMode;\n\n    const startPercent = (\n      startMode === 'percent' ? start : dataToStatePoint(start, this._stateScale, this._isHorizontal)\n    ) as number;\n    const endPercent = (\n      endMode === 'percent' ? end : dataToStatePoint(end, this._stateScale, this._isHorizontal)\n    ) as number;\n    this._handleChange(startPercent, endPercent, true);\n  }\n  enableInteraction() {\n    this._dataFilterEvent.enableInteraction();\n  }\n  disableInteraction() {\n    this._dataFilterEvent.disableInteraction();\n  }\n  zoomIn(location?: { x: number; y: number }) {\n    this._dataFilterEvent.zoomIn(location);\n  }\n  zoomOut(location?: { x: number; y: number }) {\n    this._dataFilterEvent.zoomOut(location);\n  }\n  /*** end: public function ***/\n\n  protected abstract _createOrUpdateComponent(): void;\n  protected abstract _computeWidth(): number;\n  protected abstract _computeHeight(): number;\n  protected abstract _handleDataCollectionChange(): void;\n  protected abstract _updateScaleRange(): void;\n\n  /*** start: init event and event dispatch ***/\n  protected _initEvent() {\n    this._dataFilterEvent.initZoomEvent();\n\n    this._relatedAxisComponent?.event.on(ChartEvent.scaleRawDomainUpdate, ({ model }) => {\n      // eslint-disable-next-line no-console\n      console.log('scaleRawDomainUpdate', (model as unknown as { getRawDomain: () => any }).getRawDomain());\n    });\n  }\n  protected _handleChange(start: number, end: number, updateComponent?: boolean) {\n    const zoomLock = this._spec?.zoomLock ?? false;\n    if (\n      zoomLock ||\n      // 拖拽两端的handler, 而非拖拽中间handler\n      (end - start !== this._spanCache &&\n        // 拖拽后超出限制范围\n        (end - start < this._minSpan || end - start > this._maxSpan))\n    ) {\n      this._shouldChange = false;\n    } else {\n      this._shouldChange = true;\n      this._spanCache = end - start;\n    }\n  }\n\n  protected _updateRangeFactor(tag?: 'startHandler' | 'endHandler') {\n    // 轴的range有时是相反的\n    // 比如相同的region范围, 有的场景range为[0, 500], 有的场景range为[500, 0]\n    // 而datazoom/scrollbar的range是根据布局强制转化为[0, 500]\n    // 所以这里在转换时进行判断并做转置, 有待优化\n    // 轴在inverse时，也要做转置处理\n    const axis = this._relatedAxisComponent as CartesianAxis<any>;\n    const axisScale = axis.getScale() as IBandLikeScale;\n    const reverse = isReverse(axis, this._isHorizontal);\n    const newRangeFactor: [number, number] = reverse ? [1 - this._end, 1 - this._start] : [this._start, this._end];\n\n    if (reverse) {\n      switch (tag) {\n        case 'startHandler':\n          axis.scaleRangeFactorEnd(newRangeFactor[1]);\n          break;\n        case 'endHandler':\n          axis.scaleRangeFactorStart(newRangeFactor[0]);\n          break;\n        default:\n          axis.scaleRangeFactorStart(newRangeFactor[0], true);\n          axis.scaleRangeFactorEnd(newRangeFactor[1]); // end 保证为准确值\n      }\n    } else {\n      switch (tag) {\n        case 'startHandler':\n          axis.scaleRangeFactorStart(newRangeFactor[0]);\n          break;\n        case 'endHandler':\n          axis.scaleRangeFactorEnd(newRangeFactor[1]);\n          break;\n        default:\n          axis.scaleRangeFactorEnd(newRangeFactor[1], true);\n          axis.scaleRangeFactorStart(newRangeFactor[0]); // start 保证为准确值\n      }\n    }\n\n    const newFactor = axisScale.rangeFactor();\n    if (newFactor) {\n      this._start = reverse ? 1 - newFactor[1] : newFactor[0];\n      this._end = reverse ? 1 - newFactor[0] : newFactor[1];\n    } else {\n      this._start = 0;\n      this._end = 1;\n    }\n  }\n\n  protected _handleStateChange = (startValue: number, endValue: number, tag?: string) => {\n    this._startValue = startValue;\n    this._endValue = endValue;\n    this._newDomain = parseDomainFromState(this._startValue, this._endValue, this._stateScale);\n    this.effect.onZoomChange?.(tag);\n    return true;\n  };\n\n  effect: IEffect = {\n    onZoomChange: (tag?: 'startHandler' | 'endHandler') => {\n      const axis = this._relatedAxisComponent as CartesianAxis<any>;\n      if (axis && this._filterMode === 'axis') {\n        const axisScale = axis.getScale() as IBandLikeScale;\n        const axisSpec = axis.getSpec() as ICartesianBandAxisSpec;\n        // 判断是否允许自由更改轴 bandSize\n        if (this._auto && getAxisBandSize(axisSpec) && (this._spec as IDataZoomSpec).ignoreBandSize) {\n          axisScale.bandwidth('auto');\n          axisScale.maxBandwidth('auto');\n          axisScale.minBandwidth('auto');\n        }\n\n        this._updateRangeFactor(tag);\n        if (this._auto) {\n          // tag\n          (this._component as DataZoomComponent)?.setStartAndEnd?.(this._start, this._end);\n        }\n\n        // 强制更新视图, 不管/component/axis/base-axis.ts computeData中的tickData判断\n        axis.effect.scaleUpdate({\n          value: 'force'\n        });\n      } else {\n        eachSeries(\n          this._regions,\n          s => {\n            s.getViewData()?.markRunning();\n          },\n          {\n            userId: this._seriesUserId,\n            specIndex: this._seriesIndex\n          }\n        );\n        eachSeries(\n          this._regions,\n          s => {\n            s.reFilterViewData();\n          },\n          {\n            userId: this._seriesUserId,\n            specIndex: this._seriesIndex\n          }\n        );\n      }\n    }\n  };\n  /*** end: init event and event dispatch ***/\n\n  protected _visible: boolean = true;\n  get visible() {\n    return this._visible;\n  }\n\n  constructor(spec: T, options: IComponentOption) {\n    super(spec as any, options);\n    this._orient = getOrient(spec as any);\n    this._isHorizontal = getDirectionByOrient(this._orient) === Direction.horizontal;\n    this._dataFilterEvent = new DataFilterEvent(\n      (this as any).type,\n      this._spec,\n      this._handleChange.bind(this),\n      this.getLayoutRect.bind(this),\n      () => {\n        return {\n          start: this._start,\n          end: this._end\n        };\n      },\n      () => this._regions,\n      (() => this._option).bind(this),\n      () => this.event\n    );\n  }\n\n  /*** start: component lifecycle ***/\n  created() {\n    super.created();\n    this._setAxisFromSpec();\n    this._setRegionsFromSpec();\n    this._initEvent();\n    this._initData();\n    this._initStateScale();\n    this._setStateFromSpec();\n  }\n\n  initLayout(): void {\n    super.initLayout();\n    this._layout && (this._layout.layoutOrient = this._orient);\n  }\n\n  init(option: IModelInitOption): void {\n    super.init(option);\n    this._addTransformToSeries();\n    // 初始化轴的 domain 这样在轴初次布局时，能正确的获取展示标签\n    if (this._start !== 0 || this._end !== 1) {\n      this.effect.onZoomChange();\n    }\n  }\n\n  _compareSpec(spec: AdaptiveSpec<T, 'width' | 'height'>, prevSpec: AdaptiveSpec<T, 'width' | 'height'>) {\n    const result = super._compareSpec(spec, prevSpec);\n    if (!result.reMake && !isEqual(prevSpec, spec)) {\n      result.reRender = true;\n      result.reMake = true;\n    }\n\n    return result;\n  }\n\n  reInit(spec?: AdaptiveSpec<T, 'width' | 'height'>) {\n    super.reInit(spec);\n\n    this._marks.forEach(g => {\n      (<IGroupMark>g).getMarks().forEach(m => {\n        this.initMarkStyleWithSpec(m, (this._spec as any)[m.name]);\n      });\n    });\n  }\n\n  onLayoutStart(layoutRect: IRect, viewRect: ILayoutRect): void {\n    super.onLayoutStart(layoutRect, viewRect);\n    const isShown = this._autoUpdate(layoutRect);\n    this._autoVisible(isShown);\n    this._dataUpdating = false;\n  }\n\n  updateLayoutAttribute(): void {\n    this._visible && this._createOrUpdateComponent();\n\n    // 第一次渲染, 根据配置强制触发start和end变更\n    if (!this._hasInitStateScale) {\n      if (this._start !== 0 || this._end !== 1) {\n        this._newDomain = parseDomainFromStateAndValue(\n          this._spec.start,\n          this._startValue,\n          this._spec.end,\n          this._endValue,\n          this._stateScale\n        );\n        this.effect.onZoomChange();\n      }\n      this._hasInitStateScale = true;\n    }\n  }\n\n  protected _initAfterLayout() {\n    // clear stateScale, 避免在_initStateScale中使用到旧的scale domain\n    this._stateScale = null;\n    this._initStateScale();\n    // 这时轴的 scale range 是对的\n    this._updateScaleRange();\n    this._setStateFromAxis();\n  }\n\n  protected _beforeLayoutEnd() {\n    if (!this._hasInitStateScale) {\n      this._initAfterLayout();\n    } else {\n      this._updateScaleRange();\n    }\n  }\n\n  onLayoutEnd(): void {\n    this._beforeLayoutEnd();\n    // 布局结束后, start和end会发生变化, 因此需要再次更新visible\n    const isShown = !(this._start === 0 && this._end === 1);\n    this._autoVisible(isShown);\n    // onLayoutEnd 做的事情\n    // updateLayoutAttribute\n    // 更新 _newDomain\n    // 创建 更新vrender组件属性\n    super.onLayoutEnd();\n    // 这里修改了轴的scaleRange, 因此需要更新轴的视图\n    (this._relatedAxisComponent as IAxis)?.updateScaleRange();\n  }\n\n  /**\n   * bounds预计算\n   * @param rect\n   * @returns\n   */\n  getBoundsInRect(rect: ILayoutRect): IBoundsLike {\n    const result: IBoundsLike = { x1: this.getLayoutStartPoint().x, y1: this.getLayoutStartPoint().y, x2: 0, y2: 0 };\n\n    if (this._isHorizontal) {\n      result.y2 = result.y1 + this._height;\n      result.x2 = result.x1 + rect.width;\n    } else {\n      result.x2 = result.x1 + this._width;\n      result.y2 = result.y1 + rect.height;\n    }\n    return result;\n  }\n  /*** end: component lifecycle **/\n\n  /*** start: set attributes & bind related axis and region ***/\n  setAttrFromSpec() {\n    super.setAttrFromSpec();\n    // interaction相关\n    this._dataFilterEvent.setEventAttrFromSpec();\n    // style相关\n    this._field = this._spec.field;\n    this._width = this._computeWidth();\n    this._height = this._computeHeight();\n    this._visible = this._spec.visible ?? true;\n  }\n  protected _setAxisFromSpec() {\n    if (isValid(this._spec.axisId)) {\n      this._relatedAxisComponent = this._option.getComponentByUserId(this._spec.axisId);\n    } else if (isValid(this._spec.axisIndex)) {\n      this._relatedAxisComponent = this._option.getComponentByIndex('axes', this._spec.axisIndex);\n    }\n\n    // 如果用户没有配置关联轴 或 用户配置的关联轴和datazoom方向不一致\n    // 则 使用与datazoom的方向相同的第一个axis作为关联轴\n    if (isNil(this._spec.field) && !this._relatedAxisComponent) {\n      const axes = this._option.getComponentsByKey('axes');\n      const sameOrientAxis = axes.find(\n        (cm: any) => getDirectionByOrient((cm as any)._orient) === getDirectionByOrient(this._orient)\n      );\n\n      if (sameOrientAxis) {\n        this._relatedAxisComponent = sameOrientAxis;\n      } else {\n        const bandAxis = axes.find((cm: any) => !isContinuous((cm as any).getScale().type));\n\n        this._relatedAxisComponent = bandAxis;\n      }\n    }\n    if (this._relatedAxisComponent && this._filterMode === 'axis') {\n      (this._relatedAxisComponent as CartesianAxis<any>).autoIndentOnce = true;\n    }\n  }\n\n  protected _setRegionsFromSpec() {\n    // 从axis中获取关联的regions\n    this._regions = this._relatedAxisComponent ? this._relatedAxisComponent.getRegions() : this._option.getAllRegions();\n    // 默认使用关联轴的系列绑定关系\n    const bindSeriesFilter = this._relatedAxisComponent ? this._relatedAxisComponent.getBindSeriesFilter?.() : null;\n    if (isValid(bindSeriesFilter)) {\n      isValid(bindSeriesFilter.userId) && (this._seriesUserId = array(bindSeriesFilter.userId));\n      isValid(bindSeriesFilter.specIndex) && (this._seriesIndex = array(bindSeriesFilter.specIndex));\n    }\n    // spec中的系列绑定关系 取交集\n    if (isValid(this._spec.seriesId)) {\n      const specSeriesId = array(this._spec.seriesId);\n      if (this._seriesUserId) {\n        this._seriesUserId = this._seriesUserId.filter(s => specSeriesId.includes(s));\n      } else {\n        this._seriesUserId = specSeriesId;\n      }\n    }\n    if (isValid(this._spec.seriesIndex)) {\n      const specSeriesIndex = array(this._spec.seriesIndex);\n      if (this._seriesIndex) {\n        this._seriesIndex = this._seriesIndex.filter(s => specSeriesIndex.includes(s));\n      } else {\n        this._seriesIndex = specSeriesIndex;\n      }\n    }\n    if (isValid(this._spec.regionIndex)) {\n      const regionsFromSpec = this._option.getRegionsInIndex(array(this._spec.regionIndex));\n      // 如果用户配置了region就取 axis关联 和 用户配置 的交集\n      this._regions = this._regions.filter(r => regionsFromSpec.includes(r));\n      return;\n    }\n    if (isValid(this._spec.regionId)) {\n      const ids = array(this._spec.regionId);\n      // 如果用户配置了region就取 axis关联 和 用户配置 的交集\n      this._regions = ids.length ? this._regions.filter(r => ids.includes(r.id)) : [];\n      return;\n    }\n    return;\n  }\n\n  /*** end: set attributes & bind related axis and region ***/\n\n  /*** start: data change and reset view  ***/\n  protected _initData() {\n    const dataCollection: any[] = [];\n    const seriesCollection: any[] = [];\n    const stateFields: string[] = [];\n    const valueFields: string[] = [];\n    let isCategoryState: boolean;\n    if (this._relatedAxisComponent) {\n      const originalStateFields = {};\n      eachSeries(\n        this._regions,\n        s => {\n          // 如果副轴的类型是time或band，则无法进行数据统计\n          const xAxisHelper =\n            s.coordinate === 'cartesian'\n              ? (s as ICartesianSeries).getXAxisHelper()\n              : s.coordinate === 'polar'\n                ? (s as IPolarSeries).angleAxisHelper\n                : null;\n          const yAxisHelper =\n            s.coordinate === 'cartesian'\n              ? (s as ICartesianSeries).getYAxisHelper()\n              : s.coordinate === 'polar'\n                ? (s as IPolarSeries).radiusAxisHelper\n                : null;\n          if (!xAxisHelper || !yAxisHelper) {\n            return;\n          }\n          const stateAxisHelper =\n            xAxisHelper.getAxisId() === this._relatedAxisComponent.id\n              ? xAxisHelper\n              : yAxisHelper.getAxisId() === this._relatedAxisComponent.id\n                ? yAxisHelper\n                : this._isHorizontal\n                  ? xAxisHelper\n                  : yAxisHelper;\n          const valueAxisHelper = stateAxisHelper === xAxisHelper ? yAxisHelper : xAxisHelper;\n          const isValidateValueAxis = isContinuous(valueAxisHelper.getScale(0).type);\n          const isValidateStateAxis = isContinuous(stateAxisHelper.getScale(0).type);\n\n          dataCollection.push(s.getRawData());\n          // 这里获取原始的spec中的xField和yField，而非经过stack处理后的fieldX和fieldY，原因如下:\n          // 1. dataFilterComputeDomain处理时拿到的viewData中没有__VCHART_STACK_START等属性，也就是还没处理\n          // 2. datazoom计算的是原始的value值，如果要根据stack后的数据来算，则需要__VCHART_STACK_END - __VCHART_STACK_START\n          const seriesSpec = s.getSpec();\n\n          const xField =\n            s.coordinate === 'cartesian'\n              ? array(seriesSpec.xField)\n              : array(seriesSpec.angleField ?? seriesSpec.categoryField);\n          const yField =\n            s.coordinate === 'cartesian'\n              ? array(seriesSpec.yField)\n              : array(seriesSpec.radiusField ?? seriesSpec.valueField);\n\n          originalStateFields[s.id] =\n            s.type === 'link' ? ['from_xField'] : stateAxisHelper === xAxisHelper ? xField : yField;\n\n          if (isValidateStateAxis) {\n            isCategoryState = false;\n            stateFields.push(originalStateFields[s.id]);\n          } else {\n            isCategoryState = true;\n            stateFields.push(originalStateFields[s.id][0]);\n          }\n\n          if (this._valueField) {\n            const valueField = s.type === 'link' ? ['from_yField'] : valueAxisHelper === xAxisHelper ? xField : yField;\n            if (isValidateValueAxis) {\n              valueFields.push(...valueField);\n            }\n          }\n        },\n        {\n          userId: this._seriesUserId,\n          specIndex: this._seriesIndex\n        }\n      );\n\n      this._originalStateFields = originalStateFields;\n    } else {\n      eachSeries(\n        this._regions,\n        s => {\n          dataCollection.push(s.getRawData());\n          seriesCollection.push(s);\n\n          stateFields.push(this._field);\n          if (this._valueField) {\n            valueFields.push(this._spec.valueField);\n          }\n        },\n        {\n          userId: this._seriesUserId,\n          specIndex: this._seriesIndex\n        }\n      );\n    }\n    const { dataSet } = this._option;\n    registerDataSetInstanceParser(dataSet, 'dataview', dataViewParser);\n    registerDataSetInstanceTransform(dataSet, 'dataFilterComputeDomain', dataFilterComputeDomain);\n    const data = new DataView(dataSet, { name: `${this.type}_${this.id}_data` });\n    data.transform(\n      {\n        type: 'dataFilterComputeDomain',\n        options: {\n          input: {\n            dataCollection: dataCollection,\n            seriesCollection,\n            stateFields,\n            valueFields,\n            isCategoryState\n          },\n          output: {\n            stateField: this._stateField,\n            valueField: this._valueField\n          }\n        }\n      },\n      false\n    );\n\n    // todo 似乎没必要创建\n    this._data = new CompilableData(this._option, data);\n    data.reRunAllTransform();\n    dataSet.multipleDataViewAddListener(dataCollection, 'change', this._handleDataCollectionChange.bind(this));\n  }\n  protected _addTransformToSeries() {\n    if (!this._relatedAxisComponent || this._filterMode !== 'axis') {\n      registerDataSetInstanceTransform(this._option.dataSet, 'dataFilterWithNewDomain', dataFilterWithNewDomain);\n      registerDataSetInstanceTransform(this._option.dataSet, 'lockStatisticsFilter', lockStatisticsFilter);\n\n      eachSeries(\n        this._regions,\n        s => {\n          s.getViewDataStatistics().transform(\n            {\n              type: 'lockStatisticsFilter',\n              options: {\n                originalFields: () => {\n                  return s.getViewDataStatistics().getFields();\n                },\n                getNewDomain: () => this._newDomain,\n                field: () => {\n                  return this._field ?? this._parseFieldOfSeries(s);\n                },\n                isContinuous: () => isContinuous(this._stateScale.type)\n              },\n              level: 1\n            },\n            false\n          );\n\n          s.addViewDataFilter({\n            type: 'dataFilterWithNewDomain',\n            options: {\n              getNewDomain: () => this._newDomain,\n              field: () => {\n                return this._field ?? this._parseFieldOfSeries(s);\n              },\n              isContinuous: () => isContinuous(this._stateScale.type)\n            },\n            level: TransformLevel.dataZoomFilter\n          });\n        },\n        {\n          userId: this._seriesUserId,\n          specIndex: this._seriesIndex\n        }\n      );\n    }\n  }\n  onDataUpdate(): void {\n    const domain = this._computeDomainOfStateScale(isContinuous(this._stateScale.type));\n    this._stateScale.domain(domain, false);\n    this._handleChange(this._start, this._end, true);\n    // auto 模式下需要重新布局\n    if (this._spec.auto && !isEqual(this._domainCache, domain)) {\n      this._domainCache = domain;\n      this._dataUpdating = true;\n      this.getChart()?.setLayoutTag(true, null, false);\n    }\n  }\n  private _parseFieldOfSeries(s: ISeries) {\n    return this._originalStateFields?.[s.id];\n  }\n  /*** end: data change and reset view  ***/\n\n  /*** start: scale of filter ***/\n\n  protected _setStateFromSpec() {\n    this._auto = !!this._spec.auto;\n\n    let start;\n    let end;\n    if (this._spec.rangeMode) {\n      const [startMode, endMode] = this._spec.rangeMode;\n      // 只有mode与配置相符时，才会生效\n      // 比如rangeMode为['value', 'percent'],那么start为dataValue, end为[0, 1]\n      if (modeCheck('start', startMode, this._spec) && modeCheck('end', endMode, this._spec)) {\n        start =\n          startMode === 'percent'\n            ? this._spec.start\n            : dataToStatePoint(this._spec.startValue, this._stateScale, this._isHorizontal);\n        end =\n          endMode === 'percent'\n            ? this._spec.end\n            : dataToStatePoint(this._spec.endValue, this._stateScale, this._isHorizontal);\n      }\n    } else {\n      start = this._spec.start\n        ? this._spec.start\n        : this._spec.startValue\n          ? dataToStatePoint(this._spec.startValue, this._stateScale, this._isHorizontal)\n          : 0;\n      end = this._spec.end\n        ? this._spec.end\n        : this._spec.endValue\n          ? dataToStatePoint(this._spec.endValue, this._stateScale, this._isHorizontal)\n          : 1;\n    }\n    this._start = Math.max(0, Math.min(1, start));\n    this._end = Math.max(0, Math.min(1, end));\n  }\n  protected _setStateFromAxis() {\n    // 此时 state scale 进行了更新，stateFromSpec 中补分逻辑需要使用scale计算，重新获取一遍\n    this._setStateFromSpec();\n    const axis = this._relatedAxisComponent as CartesianAxis<any>;\n    this._startValue = statePointToData(this._start, this._stateScale, isReverse(axis, this._isHorizontal));\n    this._endValue = statePointToData(this._end, this._stateScale, isReverse(axis, this._isHorizontal));\n    this._minSpan = this._spec.minSpan ?? 0;\n    this._maxSpan = this._spec.maxSpan ?? 1;\n    if (isContinuous(this._stateScale.type) && this._stateScale.domain()[0] !== last(this._stateScale.domain())) {\n      if (this._spec.minValueSpan) {\n        this._minSpan = this._spec.minValueSpan / (last(this._stateScale.domain()) - this._stateScale.domain()[0]);\n      }\n      if (this._spec.maxValueSpan) {\n        this._maxSpan = this._spec.maxValueSpan / (last(this._stateScale.domain()) - this._stateScale.domain()[0]);\n      }\n    }\n    this._minSpan = Math.max(0, this._minSpan);\n    this._maxSpan = Math.min(this._maxSpan, 1);\n    if (!axis) {\n      return;\n    }\n    // eslint-disable-next-line max-len\n    if ((!axis || this._filterMode !== 'axis') && (this._start !== 0 || this._end !== 1)) {\n      this._newDomain = parseDomainFromState(this._startValue, this._endValue, this._stateScale);\n    }\n  }\n  protected _initStateScale() {\n    const defaultRange = [0, 1];\n    if (this._relatedAxisComponent) {\n      const scale = (this._relatedAxisComponent as CartesianAxis<any>).getScale().clone() as\n        | IContinuousScale\n        | IBandLikeScale;\n      // 需要清除rangeFactor 缓存，否则会导致计算错误\n      this._stateScale = scale;\n      (scale as IBandLikeScale).maxBandwidth?.('auto', true);\n      (scale as IBandLikeScale).minBandwidth?.('auto', true);\n      (scale as IBandLikeScale).bandwidth?.('auto', true);\n      scale.rangeFactor(defaultRange as [number, number], true).range(defaultRange);\n    } else {\n      let fieldLinear = true;\n      if (this._field) {\n        eachSeries(\n          this._regions,\n          s => {\n            const stats = s.getRawDataStatisticsByField(this._field);\n            if (!isValidNumber(stats?.min) || !isValidNumber(stats?.max)) {\n              fieldLinear = false;\n            }\n          },\n          {\n            userId: this._seriesUserId,\n            specIndex: this._seriesIndex\n          }\n        );\n      }\n\n      this._stateScale = fieldLinear ? new LinearScale() : new BandScale();\n      this._stateScale.domain(this._computeDomainOfStateScale(fieldLinear), true).range(defaultRange);\n    }\n  }\n\n  protected _computeDomainOfStateScale(isContinuous?: boolean) {\n    if ((this._spec as IDataZoomSpec).customDomain) {\n      return (this._spec as IDataZoomSpec).customDomain;\n    }\n    const domain = this._data.getLatestData().map((d: any) => d[this._stateField]);\n    if (isContinuous) {\n      const domainNum = domain.map((n: any) => n * 1);\n      return domain.length ? [minInArray(domainNum), maxInArray(domainNum)] : [-Infinity, Infinity];\n    }\n\n    return domain;\n  }\n  /*** end: scale of filter ***/\n\n  /*** start: auto model process  ***/\n  protected _autoVisible(isShown: boolean) {\n    if (!this._auto) {\n      return;\n    }\n    if (isShown) {\n      this.show();\n    } else {\n      this.hide();\n    }\n    const sizeKey = this._isHorizontal ? 'height' : 'width';\n    this.layout.setLayoutRect(\n      {\n        [sizeKey]: isShown ? this[`_${sizeKey}`] : 0\n      },\n      {\n        [sizeKey]: AttributeLevel.Built_In\n      }\n    );\n  }\n  hide() {\n    this._component?.hideAll();\n  }\n\n  show() {\n    this._component?.showAll();\n  }\n\n  protected _autoUpdate(rect?: ILayoutRect): boolean {\n    if (!this._auto) {\n      this._cacheVisibility = undefined;\n      return true;\n    }\n\n    const axis = this._relatedAxisComponent as CartesianAxis<any>;\n    const axisSpec = axis?.getSpec() as ICartesianBandAxisSpec | undefined;\n    const axisScale = axis?.getScale() as IBandLikeScale;\n    const bandSizeResult = getAxisBandSize(axisSpec);\n\n    if (\n      !this._dataUpdating &&\n      isDiscrete(axisScale.type) &&\n      rect?.height === this._cacheRect?.height &&\n      rect?.width === this._cacheRect?.width &&\n      this._fixedBandSize === bandSizeResult?.bandSize\n    ) {\n      return this._cacheVisibility;\n    }\n\n    let isShown = true;\n    if (this._isHorizontal && rect?.width !== this._cacheRect?.width) {\n      axisScale.range(axis.getInverse() ? [rect.width, 0] : [0, rect.width]);\n    } else if (rect?.height !== this._cacheRect?.height) {\n      axisScale.range(axis.getInverse() ? [0, rect.height] : [rect.height, 0]);\n    }\n\n    this._cacheRect = {\n      width: rect?.width,\n      height: rect?.height\n    };\n    this._fixedBandSize = bandSizeResult?.bandSize;\n\n    if (isDiscrete(axisScale.type)) {\n      if (bandSizeResult && (this._start || this._end)) {\n        if (this.type === ComponentTypeEnum.scrollBar) {\n          this._start = 0;\n          this._end = 1;\n        }\n        this._updateRangeFactor();\n      }\n      const [start, end] = axisScale.rangeFactor() ?? [];\n      if (isNil(start) && isNil(end)) {\n        isShown = false;\n      } else {\n        isShown = !(start === 0 && end === 1);\n      }\n    } else {\n      const [start, end] = axisScale.rangeFactor() ?? [this._start, this._end];\n      isShown = !(start === 0 && end === 1);\n    }\n    this.setStartAndEnd(this._start, this._end);\n    this._cacheVisibility = isShown;\n    return isShown;\n  }\n  /*** end: auto model process  ***/\n\n  protected _getNeedClearVRenderComponents(): IGraphic[] {\n    return [this._component] as unknown as IGroup[];\n  }\n}\n\nmixin(DataFilterBaseComponent, Zoomable);\n"]}